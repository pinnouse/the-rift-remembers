var Cf=Object.defineProperty;var Pf=(t,e,n)=>e in t?Cf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var q=(t,e,n)=>Pf(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();var Df=Object.defineProperty,u=(t,e)=>Df(t,"name",{value:e,configurable:!0}),Bf=(()=>{for(var t=new Uint8Array(128),e=0;e<64;e++)t[e<26?e+65:e<52?e+71:e<62?e-4:e*4-205]=e;return n=>{for(var r=n.length,s=new Uint8Array((r-(n[r-1]=="=")-(n[r-2]=="="))*3/4|0),i=0,a=0;i<r;){var f=t[n.charCodeAt(i++)],d=t[n.charCodeAt(i++)],h=t[n.charCodeAt(i++)],A=t[n.charCodeAt(i++)];s[a++]=f<<2|d>>4,s[a++]=d<<4|h>>2,s[a++]=h<<6|A}return s}})(),Ie,ve=(Ie=class{constructor(e,n,r){q(this,"r",255);q(this,"g",255);q(this,"b",255);this.r=Kt(e,0,255),this.g=Kt(n,0,255),this.b=Kt(r,0,255)}static fromArray(e){return new Ie(e[0],e[1],e[2])}static fromHex(e){if(typeof e=="number")return new Ie(e>>16&255,e>>8&255,e>>0&255);if(typeof e=="string"){let n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(!n)throw new Error("Invalid hex color format");return new Ie(parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16))}else throw new Error("Invalid hex color format")}static fromHSL(e,n,r){if(n==0)return new Ie(255*r,255*r,255*r);let s=u((A,y,g)=>(g<0&&(g+=1),g>1&&(g-=1),g<1/6?A+(y-A)*6*g:g<1/2?y:g<2/3?A+(y-A)*(2/3-g)*6:A),"hue2rgb"),i=r<.5?r*(1+n):r+n-r*n,a=2*r-i,f=s(a,i,e+1/3),d=s(a,i,e),h=s(a,i,e-1/3);return new Ie(Math.round(f*255),Math.round(d*255),Math.round(h*255))}clone(){return new Ie(this.r,this.g,this.b)}lighten(e){return new Ie(this.r+e,this.g+e,this.b+e)}darken(e){return this.lighten(-e)}invert(){return new Ie(255-this.r,255-this.g,255-this.b)}mult(e){return new Ie(this.r*e.r/255,this.g*e.g/255,this.b*e.b/255)}lerp(e,n){return new Ie(vt(this.r,e.r,n),vt(this.g,e.g,n),vt(this.b,e.b,n))}toHSL(){let e=this.r/255,n=this.g/255,r=this.b/255,s=Math.max(e,n,r),i=Math.min(e,n,r),a=(s+i)/2,f=a,d=a;if(s==i)a=f=0;else{let h=s-i;switch(f=d>.5?h/(2-s-i):h/(s+i),s){case e:a=(n-r)/h+(n<r?6:0);break;case n:a=(r-e)/h+2;break;case r:a=(e-n)/h+4;break}a/=6}return[a,f,d]}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}toArray(){return[this.r,this.g,this.b]}},u(Ie,"Color"),q(Ie,"RED",new Ie(255,0,0)),q(Ie,"GREEN",new Ie(0,255,0)),q(Ie,"BLUE",new Ie(0,0,255)),q(Ie,"YELLOW",new Ie(255,255,0)),q(Ie,"MAGENTA",new Ie(255,0,255)),q(Ie,"CYAN",new Ie(0,255,255)),q(Ie,"WHITE",new Ie(255,255,255)),q(Ie,"BLACK",new Ie(0,0,0)),Ie);function Re(...t){if(t.length===0)return new ve(255,255,255);if(t.length===1){if(t[0]instanceof ve)return t[0].clone();if(typeof t[0]=="string")return ve.fromHex(t[0]);if(Array.isArray(t[0])&&t[0].length===3)return ve.fromArray(t[0])}else if(t.length===2){if(t[0]instanceof ve)return t[0].clone()}else if(t.length===3||t.length===4)return new ve(t[0],t[1],t[2]);throw new Error("Invalid color arguments")}u(Re,"rgb");var kf=u((t,e,n)=>ve.fromHSL(t,e,n),"hsl2rgb");function Je(t){return t*Math.PI/180}u(Je,"deg2rad");function Bn(t){return t*180/Math.PI}u(Bn,"rad2deg");function Kt(t,e,n){return e>n?Kt(t,n,e):Math.min(Math.max(t,e),n)}u(Kt,"clamp");function vt(t,e,n){if(typeof t=="number"&&typeof e=="number")return t+(e-t)*n;if(t instanceof V&&e instanceof V||t instanceof ve&&e instanceof ve)return t.lerp(e,n);throw new Error(`Bad value for lerp(): ${t}, ${e}. Only number, Vec2 and Color is supported.`)}u(vt,"lerp");function zt(t,e,n,r,s){return r+(t-e)/(n-e)*(s-r)}u(zt,"map");function ll(t,e,n,r,s){return Kt(zt(t,e,n,r,s),r,s)}u(ll,"mapc");var Te,V=(Te=class{constructor(e=0,n=e){q(this,"x",0);q(this,"y",0);this.x=e,this.y=n}static fromAngle(e){let n=Je(e);return new Te(Math.cos(n),Math.sin(n))}static fromArray(e){return new Te(e[0],e[1])}clone(){return new Te(this.x,this.y)}add(...e){let n=L(...e);return new Te(this.x+n.x,this.y+n.y)}sub(...e){let n=L(...e);return new Te(this.x-n.x,this.y-n.y)}scale(...e){let n=L(...e);return new Te(this.x*n.x,this.y*n.y)}dist(...e){let n=L(...e);return this.sub(n).len()}sdist(...e){let n=L(...e);return this.sub(n).slen()}static sdist(e,n){let r=e.x-n.x,s=e.y-n.y;return r*r+s*s}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let e=this.len();return e===0?new Te(0):this.scale(1/e)}normal(){return new Te(this.y,-this.x)}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}dot(e){return this.x*e.x+this.y*e.y}static dot(e,n){return e.x*n.x+e.y*n.y}cross(e){return this.x*e.y-this.y*e.x}static cross(e,n){return e.x*n.y-e.y*n.x}angle(...e){let n=L(...e);return Bn(Math.atan2(this.y-n.y,this.x-n.x))}angleBetween(...e){let n=L(...e);return Bn(Math.atan2(this.cross(n),this.dot(n)))}lerp(e,n){return new Te(vt(this.x,e.x,n),vt(this.y,e.y,n))}slerp(e,n){let r=this.dot(e),s=this.cross(e),i=Math.atan2(s,r);return this.scale(Math.sin((1-n)*i)).add(e.scale(Math.sin(n*i))).scale(1/s)}isZero(){return this.x===0&&this.y===0}toFixed(e){return new Te(Number(this.x.toFixed(e)),Number(this.y.toFixed(e)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new Ue(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}toArray(){return[this.x,this.y]}},u(Te,"Vec2"),q(Te,"ZERO",new Te(0,0)),q(Te,"ONE",new Te(1,1)),q(Te,"LEFT",new Te(-1,0)),q(Te,"RIGHT",new Te(1,0)),q(Te,"UP",new Te(0,-1)),q(Te,"DOWN",new Te(0,1)),Te);function L(...t){if(t.length===1){if(t[0]instanceof V)return new V(t[0].x,t[0].y);if(Array.isArray(t[0])&&t[0].length===2)return new V(...t[0])}return new V(...t)}u(L,"vec2");var Tn,ze=(Tn=class{constructor(e,n,r,s){q(this,"x",0);q(this,"y",0);q(this,"w",1);q(this,"h",1);this.x=e,this.y=n,this.w=r,this.h=s}scale(e){return new Tn(this.x+this.w*e.x,this.y+this.h*e.y,this.w*e.w,this.h*e.h)}pos(){return new V(this.x,this.y)}clone(){return new Tn(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}},u(Tn,"Quad"),Tn);function Xe(t,e,n,r){return new ze(t,e,n,r)}u(Xe,"quad");var Vt,$s=(Vt=class{constructor(e,n,r,s){q(this,"a");q(this,"b");q(this,"c");q(this,"d");this.a=e,this.b=n,this.c=r,this.d=s}mul(e){return new Vt(this.a*e.a+this.b*e.c,this.a*e.b+this.b*e.d,this.c*e.a+this.d*e.c,this.c*e.b+this.d*e.d)}transform(e){return L(this.a*e.x+this.b*e.y,this.c*e.x+this.d*e.y)}get inverse(){let e=this.det;return new Vt(this.d/e,-this.b/e,-this.c/e,this.a/e)}get transpose(){return new Vt(this.a,this.c,this.b,this.d)}get eigenvalues(){let e=this.trace/2,n=this.det,r=e+Math.sqrt(e*e-n),s=e-Math.sqrt(e*e-n);return[r,s]}eigenvectors(e,n){return this.c!=0?[[e-this.d,this.c],[n-this.d,this.c]]:this.b!=0?[[this.b,e-this.a],[this.b,n-this.a]]:Math.abs(this.transform(L(1,0)).x-e)<Number.EPSILON?[[1,0],[0,1]]:[[0,1],[1,0]]}get det(){return this.a*this.d-this.b*this.c}get trace(){return this.a+this.d}static rotation(e){let n=Math.cos(e),r=Math.sin(e);return new Vt(n,r,-r,n)}static scale(e,n){return new Vt(e,0,0,n)}},u(Vt,"Mat2"),Vt),Zt,ns=(Zt=class{constructor(e,n,r,s,i,a,f,d,h){q(this,"m11");q(this,"m12");q(this,"m13");q(this,"m21");q(this,"m22");q(this,"m23");q(this,"m31");q(this,"m32");q(this,"m33");this.m11=e,this.m12=n,this.m13=r,this.m21=s,this.m22=i,this.m23=a,this.m31=f,this.m32=d,this.m33=h}static fromMat2(e){return new Zt(e.a,e.b,0,e.c,e.d,0,0,0,1)}toMat2(){return new $s(this.m11,this.m12,this.m21,this.m22)}mul(e){return new Zt(this.m11*e.m11+this.m12*e.m21+this.m13*e.m31,this.m11*e.m12+this.m12*e.m22+this.m13*e.m32,this.m11*e.m13+this.m12*e.m23+this.m13*e.m33,this.m21*e.m11+this.m22*e.m21+this.m23*e.m31,this.m21*e.m12+this.m22*e.m22+this.m23*e.m32,this.m21*e.m13+this.m22*e.m23+this.m23*e.m33,this.m31*e.m11+this.m32*e.m21+this.m33*e.m31,this.m31*e.m12+this.m32*e.m22+this.m33*e.m32,this.m31*e.m13+this.m32*e.m23+this.m33*e.m33)}get det(){return this.m11*this.m22*this.m33+this.m12*this.m23*this.m31+this.m13*this.m21*this.m32-this.m13*this.m22*this.m31-this.m12*this.m21*this.m33-this.m11*this.m23*this.m32}rotate(e){let n=Math.cos(e),r=Math.sin(e),s=this.m11,i=this.m12;return this.m11=n*this.m11+r*this.m21,this.m12=n*this.m12+r*this.m22,this.m21=n*this.m21-r*s,this.m22=n*this.m22-r*i,this}scale(e,n){return this.m11*=e,this.m12*=e,this.m21*=n,this.m22*=n,this}get inverse(){let e=this.det;return new Zt((this.m22*this.m33-this.m23*this.m32)/e,(this.m13*this.m32-this.m12*this.m33)/e,(this.m12*this.m23-this.m13*this.m22)/e,(this.m23*this.m31-this.m21*this.m33)/e,(this.m11*this.m33-this.m13*this.m31)/e,(this.m13*this.m21-this.m11*this.m23)/e,(this.m21*this.m32-this.m22*this.m31)/e,(this.m12*this.m31-this.m11*this.m32)/e,(this.m11*this.m22-this.m12*this.m21)/e)}get transpose(){return new Zt(this.m11,this.m21,this.m31,this.m12,this.m22,this.m32,this.m13,this.m23,this.m33)}},u(Zt,"Mat3"),Zt),At,nn=(At=class{constructor(e){q(this,"m",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);e&&(this.m=e)}static translate(e){return new At([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,0,1])}static scale(e){return new At([e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(e){e=Je(-e);let n=Math.cos(e),r=Math.sin(e);return new At([1,0,0,0,0,n,-r,0,0,r,n,0,0,0,0,1])}static rotateY(e){e=Je(-e);let n=Math.cos(e),r=Math.sin(e);return new At([n,0,r,0,0,1,0,0,-r,0,n,0,0,0,0,1])}static rotateZ(e){e=Je(-e);let n=Math.cos(e),r=Math.sin(e);return new At([n,-r,0,0,r,n,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){e=Je(-e);let n=Math.cos(e),r=Math.sin(e),s=this.m[0],i=this.m[1],a=this.m[4],f=this.m[5];return this.m[0]=s*n+i*r,this.m[1]=-s*r+i*n,this.m[4]=a*n+f*r,this.m[5]=-a*r+f*n,this}mult(e){let n=[];for(let r=0;r<4;r++)for(let s=0;s<4;s++)n[r*4+s]=this.m[0*4+s]*e.m[r*4+0]+this.m[1*4+s]*e.m[r*4+1]+this.m[2*4+s]*e.m[r*4+2]+this.m[3*4+s]*e.m[r*4+3];return new At(n)}multVec2(e){return new V(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new V(this.m[12],this.m[13])}getScale(){if(this.m[0]!=0||this.m[1]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],n=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new V(n,e/n)}else if(this.m[4]!=0||this.m[5]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],n=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new V(e/n,n)}else return new V(0,0)}getRotation(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return Bn(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return Bn(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}else return 0}getSkew(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new V(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new V(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}else return new V(0,0)}invert(){let e=[],n=this.m[10]*this.m[15]-this.m[14]*this.m[11],r=this.m[9]*this.m[15]-this.m[13]*this.m[11],s=this.m[9]*this.m[14]-this.m[13]*this.m[10],i=this.m[8]*this.m[15]-this.m[12]*this.m[11],a=this.m[8]*this.m[14]-this.m[12]*this.m[10],f=this.m[8]*this.m[13]-this.m[12]*this.m[9],d=this.m[6]*this.m[15]-this.m[14]*this.m[7],h=this.m[5]*this.m[15]-this.m[13]*this.m[7],A=this.m[5]*this.m[14]-this.m[13]*this.m[6],y=this.m[4]*this.m[15]-this.m[12]*this.m[7],g=this.m[4]*this.m[14]-this.m[12]*this.m[6],b=this.m[5]*this.m[15]-this.m[13]*this.m[7],E=this.m[4]*this.m[13]-this.m[12]*this.m[5],C=this.m[6]*this.m[11]-this.m[10]*this.m[7],v=this.m[5]*this.m[11]-this.m[9]*this.m[7],S=this.m[5]*this.m[10]-this.m[9]*this.m[6],j=this.m[4]*this.m[11]-this.m[8]*this.m[7],W=this.m[4]*this.m[10]-this.m[8]*this.m[6],ee=this.m[4]*this.m[9]-this.m[8]*this.m[5];e[0]=this.m[5]*n-this.m[6]*r+this.m[7]*s,e[4]=-(this.m[4]*n-this.m[6]*i+this.m[7]*a),e[8]=this.m[4]*r-this.m[5]*i+this.m[7]*f,e[12]=-(this.m[4]*s-this.m[5]*a+this.m[6]*f),e[1]=-(this.m[1]*n-this.m[2]*r+this.m[3]*s),e[5]=this.m[0]*n-this.m[2]*i+this.m[3]*a,e[9]=-(this.m[0]*r-this.m[1]*i+this.m[3]*f),e[13]=this.m[0]*s-this.m[1]*a+this.m[2]*f,e[2]=this.m[1]*d-this.m[2]*h+this.m[3]*A,e[6]=-(this.m[0]*d-this.m[2]*y+this.m[3]*g),e[10]=this.m[0]*b-this.m[1]*y+this.m[3]*E,e[14]=-(this.m[0]*A-this.m[1]*g+this.m[2]*E),e[3]=-(this.m[1]*C-this.m[2]*v+this.m[3]*S),e[7]=this.m[0]*C-this.m[2]*j+this.m[3]*W,e[11]=-(this.m[0]*v-this.m[1]*j+this.m[3]*ee),e[15]=this.m[0]*S-this.m[1]*W+this.m[2]*ee;let re=this.m[0]*e[0]+this.m[1]*e[4]+this.m[2]*e[8]+this.m[3]*e[12];for(let R=0;R<4;R++)for(let D=0;D<4;D++)e[R*4+D]*=1/re;return new At(e)}clone(){return new At([...this.m])}toString(){return this.m.toString()}},u(At,"Mat4"),At);function no(t,e,n,r=s=>-Math.cos(s)){return t+(r(n)+1)/2*(e-t)}u(no,"wave");var qf=1103515245,Ff=12345,qa=2147483648,Sr,ul=(Sr=class{constructor(e){q(this,"seed");this.seed=e}gen(){return this.seed=(qf*this.seed+Ff)%qa,this.seed/qa}genNumber(e,n){return e+this.gen()*(n-e)}genVec2(e,n){return new V(this.genNumber(e.x,n.x),this.genNumber(e.y,n.y))}genColor(e,n){return new ve(this.genNumber(e.r,n.r),this.genNumber(e.g,n.g),this.genNumber(e.b,n.b))}genAny(...e){if(e.length===0)return this.gen();if(e.length===1){if(typeof e[0]=="number")return this.genNumber(0,e[0]);if(e[0]instanceof V)return this.genVec2(L(0,0),e[0]);if(e[0]instanceof ve)return this.genColor(Re(0,0,0),e[0])}else if(e.length===2){if(typeof e[0]=="number"&&typeof e[1]=="number")return this.genNumber(e[0],e[1]);if(e[0]instanceof V&&e[1]instanceof V)return this.genVec2(e[0],e[1]);if(e[0]instanceof ve&&e[1]instanceof ve)return this.genColor(e[0],e[1])}throw new Error("More than 2 arguments not supported")}},u(Sr,"RNG"),Sr),Ni=new ul(Date.now());function cl(t){return t!=null&&(Ni.seed=t),Ni.seed}u(cl,"randSeed");function tt(...t){return Ni.genAny(...t)}u(tt,"rand");function ro(...t){return Math.floor(tt(...t.length>0?t:[2]))}u(ro,"randi");function hl(t){return tt()<=t}u(hl,"chance");function so(t){for(let e=t.length-1;e>0;e--){let n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}u(so,"shuffle");function fl(t,e){return t.length<=e?t.slice():so(t.slice()).slice(0,e)}u(fl,"chooseMultiple");function dl(t){return t[ro(t.length)]}u(dl,"choose");function io(t,e){return t.pos.x+t.width>e.pos.x&&t.pos.x<e.pos.x+e.width&&t.pos.y+t.height>e.pos.y&&t.pos.y<e.pos.y+e.height}u(io,"testRectRect");function gl(t,e){if(t.p1.x===t.p2.x&&t.p1.y===t.p2.y||e.p1.x===e.p2.x&&e.p1.y===e.p2.y)return null;let n=(e.p2.y-e.p1.y)*(t.p2.x-t.p1.x)-(e.p2.x-e.p1.x)*(t.p2.y-t.p1.y);if(n===0)return null;let r=((e.p2.x-e.p1.x)*(t.p1.y-e.p1.y)-(e.p2.y-e.p1.y)*(t.p1.x-e.p1.x))/n,s=((t.p2.x-t.p1.x)*(t.p1.y-e.p1.y)-(t.p2.y-t.p1.y)*(t.p1.x-e.p1.x))/n;return r<0||r>1||s<0||s>1?null:r}u(gl,"testLineLineT");function ii(t,e){let n=gl(t,e);return n?L(t.p1.x+n*(t.p2.x-t.p1.x),t.p1.y+n*(t.p2.y-t.p1.y)):null}u(ii,"testLineLine");function oi(t,e){let n=e.p2.sub(e.p1),r=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;if(n.x!=0){let i=(t.pos.x-e.p1.x)/n.x,a=(t.pos.x+t.width-e.p1.x)/n.x;r=Math.max(r,Math.min(i,a)),s=Math.min(s,Math.max(i,a))}if(n.y!=0){let i=(t.pos.y-e.p1.y)/n.y,a=(t.pos.y+t.height-e.p1.y)/n.y;r=Math.max(r,Math.min(i,a)),s=Math.min(s,Math.max(i,a))}return s>=r&&s>=0&&r<=1}u(oi,"testRectLine");function ps(t,e){return e.x>t.pos.x&&e.x<t.pos.x+t.width&&e.y>t.pos.y&&e.y<t.pos.y+t.height}u(ps,"testRectPoint");function oo(t,e){let n=Math.max(t.pos.x,Math.min(e.center.x,t.pos.x+t.width)),r=Math.max(t.pos.y,Math.min(e.center.y,t.pos.y+t.height));return L(n,r).sdist(e.center)<=e.radius*e.radius}u(oo,"testRectCircle");function ao(t,e){return lo(e,new Et(t.points()))}u(ao,"testRectPolygon");function ai(t,e){let n=e.sub(t.p1),r=t.p2.sub(t.p1);if(Math.abs(n.cross(r))>Number.EPSILON)return!1;let s=n.dot(r)/r.dot(r);return s>=0&&s<=1}u(ai,"testLinePoint");function Yr(t,e){let n=t.p2.sub(t.p1),r=n.dot(n),s=t.p1.sub(e.center),i=2*n.dot(s),a=s.dot(s)-e.radius*e.radius,f=i*i-4*r*a;if(r<=Number.EPSILON||f<0)return!1;if(f==0){let d=-i/(2*r);if(d>=0&&d<=1)return!0}else{let d=(-i+Math.sqrt(f))/(2*r),h=(-i-Math.sqrt(f))/(2*r);if(d>=0&&d<=1||h>=0&&h<=1)return!0}return ms(e,t.p1)}u(Yr,"testLineCircle");function li(t,e){if(gn(e,t.p1)||gn(e,t.p2))return!0;for(let n=0;n<e.pts.length;n++){let r=e.pts[n],s=e.pts[(n+1)%e.pts.length];if(ii(t,new Pt(r,s)))return!0}return!1}u(li,"testLinePolygon");function ms(t,e){return t.center.sdist(e)<t.radius*t.radius}u(ms,"testCirclePoint");function pl(t,e){return t.center.sdist(e.center)<(t.radius+e.radius)*(t.radius+e.radius)}u(pl,"testCircleCircle");function ys(t,e){let n=e.pts[e.pts.length-1];for(let r of e.pts){if(Yr(new Pt(n,r),t))return!0;n=r}return ms(t,e.pts[0])?!0:gn(e,t.center)}u(ys,"testCirclePolygon");function lo(t,e){for(let n=0;n<t.pts.length;n++)if(li(new Pt(t.pts[n],t.pts[(n+1)%t.pts.length]),e))return!0;return!!(t.pts.some(n=>gn(e,n))||e.pts.some(n=>gn(t,n)))}u(lo,"testPolygonPolygon");function gn(t,e){let n=!1,r=t.pts;for(let s=0,i=r.length-1;s<r.length;i=s++)r[s].y>e.y!=r[i].y>e.y&&e.x<(r[i].x-r[s].x)*(e.y-r[s].y)/(r[i].y-r[s].y)+r[s].x&&(n=!n);return n}u(gn,"testPolygonPoint");function ui(t,e){e=e.sub(t.center);let n=Je(t.angle),r=Math.cos(n),s=Math.sin(n),i=e.x*r+e.y*s,a=-e.x*s+e.y*r;return i*i/(t.radiusX*t.radiusX)+a*a/(t.radiusY*t.radiusY)<1}u(ui,"testEllipsePoint");function os(t,e){let n=e.center.sub(t.center),r=Je(t.angle),s=Math.cos(r),i=Math.sin(r),a=n.x*s+n.y*i,f=-n.x*i+n.y*s;return ui(new pn(L(),t.radiusX+e.radius,t.radiusY+e.radius,0),L(a,f))}u(os,"testEllipseCircle");function uo(t,e){let n=t.toMat2().inverse;return e=new Pt(n.transform(e.p1.sub(t.center)),n.transform(e.p2.sub(t.center))),Yr(e,new Tt(L(),1))}u(uo,"testEllipseLine");function ml(t,e){if(t.radiusX===t.radiusY)return os(e,new Tt(t.center,t.radiusX));if(e.radiusX===e.radiusY)return os(t,new Tt(e.center,e.radiusX));let n=new ns(1/t.radiusX**2,0,0,0,1/t.radiusY**2,0,0,0,-1),r=new ns(1/e.radiusX**2,0,0,0,1/e.radiusY**2,0,0,0,-1),s=t.center.x,i=t.center.y,a=e.center.x,f=e.center.y,d=Je(t.angle),h=Je(e.angle),A=new ns(Math.cos(d),-Math.sin(d),s,Math.sin(d),Math.cos(d),i,0,0,1),y=new ns(Math.cos(h),-Math.sin(h),a,Math.sin(h),Math.cos(h),f,0,0,1),g=A.inverse,b=y.inverse,E=g.transpose.mul(n).mul(g),C=b.transpose.mul(r).mul(b),v=E.m11,S=E.m12,j=E.m13,W=E.m21,ee=E.m22,re=E.m23,R=E.m31,D=E.m32,N=E.m33,Y=C.m11,Q=C.m12,ie=C.m13,fe=C.m21,M=C.m22,K=C.m23,z=C.m31,_=C.m32,$=C.m33,te=v*ee*N-v*re*D-S*W*N+S*re*R+j*W*D-j*ee*R,he=(v*ee*$-v*re*_-v*D*K+v*N*M-S*W*$+S*re*z+S*R*K-S*N*fe+j*W*_-j*ee*z-j*R*M+j*D*fe+W*D*ie-W*N*Q-ee*R*ie+ee*N*Y+re*R*Q-re*D*Y)/te,oe=(v*M*$-v*K*_-S*fe*$+S*K*z+j*fe*_-j*M*z-W*Q*$+W*ie*_+ee*Y*$-ee*ie*z-re*Y*_+re*Q*z+R*Q*K-R*ie*M-D*Y*K+D*ie*fe+N*Y*M-N*Q*fe)/te,ye=(Y*M*$-Y*K*_-Q*fe*$+Q*K*z+ie*fe*_-ie*M*z)/te;if(he>=0){let le=-3*oe+he**2,Fe=3*he*ye+oe*he**2-4*oe**2,We=-27*ye**2+18*ye*he*oe+he**2*oe**2-4*he**3*ye-4*oe**3;return!(le>0&&Fe<0&&We>0)}else{let le=-3*oe+he**2,Fe=-27*ye**2+18*ye*he*oe+he**2*oe**2-4*he**3*ye-4*oe**3;return!(le>0&&Fe>0)}}u(ml,"testEllipseEllipse");function co(t,e){return ci(t,new Et(e.points()))}u(co,"testEllipseRect");function ci(t,e){let n=t.toMat2().inverse;return e=new Et(e.pts.map(r=>n.transform(r.sub(t.center)))),ys(new Tt(L(),1),e)}u(ci,"testEllipsePolygon");function yl(t,e){return t.x===e.x&&t.y===e.y}u(yl,"testPointPoint");function wl(t,e){return e instanceof V?yl(e,t.pt):e instanceof Tt?ms(e,t.pt):e instanceof Pt?ai(e,t.pt):e instanceof Ue?ps(e,t.pt):e instanceof Et?gn(e,t.pt):e instanceof pn?ui(e,t.pt):!1}u(wl,"testPointShape");function Al(t,e){return e instanceof V?ai(t,e):e instanceof Tt?Yr(t,e):e instanceof Pt?ii(t,e)!=null:e instanceof Ue?oi(e,t):e instanceof Et?li(t,e):e instanceof pn?uo(e,t):!1}u(Al,"testLineShape");function xl(t,e){return e instanceof V?ms(t,e):e instanceof Tt?pl(t,e):e instanceof Pt?Yr(e,t):e instanceof Ue?oo(e,t):e instanceof Et?ys(t,e):e instanceof pn?os(e,t):!1}u(xl,"testCircleShape");function bl(t,e){return e instanceof V?ps(t,e):e instanceof Tt?oo(t,e):e instanceof Pt?oi(t,e):e instanceof Ue?io(t,e):e instanceof Et?ao(t,e):e instanceof pn?co(e,t):!1}u(bl,"testRectShape");function vl(t,e){return e instanceof V?gn(t,e):e instanceof Tt?ys(e,t):e instanceof Pt?li(e,t):e instanceof Ue?ao(e,t):e instanceof Et?lo(e,t):e instanceof pn?ci(e,t):!1}u(vl,"testPolygonShape");function El(t,e){return e instanceof V?ui(t,e):e instanceof Tt?os(t,e):e instanceof Pt?uo(t,e):e instanceof Ue?co(t,e):e instanceof Et?ci(t,e):e instanceof pn?ml(e,t):!1}u(El,"testEllipseShape");function ho(t,e,n){let r=t,s=n.p1,i=n.p2,a=e,f=i.sub(s),d=a.cross(f);if(Math.abs(d)<Number.EPSILON)return null;let h=s.sub(r),A=h.cross(f)/d;if(A<=0||A>=1)return null;let y=h.cross(a)/d;if(y<=0||y>=1)return null;let g=f.normal().unit();return e.dot(g)>0&&(g.x*=-1,g.y*=-1),{point:r.add(a.scale(A)),normal:g,fraction:A}}u(ho,"raycastLine");function Sl(t,e,n){let r=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY,i;if(t.x!=0){let a=(n.pos.x-t.x)/e.x,f=(n.pos.x+n.width-t.x)/e.x;i=L(-Math.sign(e.x),0),r=Math.max(r,Math.min(a,f)),s=Math.min(s,Math.max(a,f))}if(t.y!=0){let a=(n.pos.y-t.y)/e.y,f=(n.pos.y+n.height-t.y)/e.y;Math.min(a,f)>r&&(i=L(0,-Math.sign(e.y))),r=Math.max(r,Math.min(a,f)),s=Math.min(s,Math.max(a,f))}return s>=r&&r>=0&&r<=1?{point:t.add(e.scale(r)),normal:i,fraction:r}:null}u(Sl,"raycastRect");function fo(t,e,n){let r=t,s=n.center,i=e,a=i.dot(i),f=r.sub(s),d=2*i.dot(f),h=f.dot(f)-n.radius*n.radius,A=d*d-4*a*h;if(a<=Number.EPSILON||A<0)return null;if(A==0){let y=-d/(2*a);if(y>=0&&y<=1){let g=r.add(i.scale(y));return{point:g,normal:g.sub(s),fraction:y}}}else{let y=(-d+Math.sqrt(A))/(2*a),g=(-d-Math.sqrt(A))/(2*a),b=null;if(y>=0&&y<=1&&(b=y),g>=0&&g<=1&&(b=Math.min(g,b??g)),b!=null){let E=r.add(i.scale(b));return{point:E,normal:E.sub(s).unit(),fraction:b}}}return null}u(fo,"raycastCircle");function Il(t,e,n){let r=n.pts,s=null,i=r[r.length-1];for(let a=0;a<r.length;a++){let f=r[a],d=ho(t,e,new Pt(i,f));d&&(!s||s.fraction>d.fraction)&&(s=d),i=f}return s}u(Il,"raycastPolygon");function Ol(t,e,n){let r=n.toMat2(),s=r.inverse,i=s.transform(t.sub(n.center)),a=s.transform(e),f=fo(i,a,new Tt(L(),1));if(f){let d=$s.rotation(Je(-n.angle)),h=$s.scale(n.radiusX,n.radiusY).transform(f.point),A=r.transform(f.point).add(n.center),y=A.dist(t)/e.len();return{point:A,normal:d.transform(L(n.radiusY**2*h.x,n.radiusX**2*h.y)).unit(),fraction:y}}return f}u(Ol,"raycastEllipse");function Rl(t,e,n,r=64){let s=t,i=e.len(),a=e.scale(1/i),f=0,d=L(Math.floor(t.x),Math.floor(t.y)),h=L(a.x>0?1:-1,a.y>0?1:-1),A=L(Math.abs(1/a.x),Math.abs(1/a.y)),y=L(h.x>0?d.x+1-t.x:t.x-d.x,h.y>0?d.y+1-t.y:t.y-d.y),g=L(A.x<1/0?A.x*y.x:1/0,A.y<1/0?A.y*y.y:1/0),b=-1;for(;f<=r;){let E=n(d);if(E===!0)return{point:s.add(a.scale(f)),normal:L(b===0?-h.x:0,b===1?-h.y:0),fraction:f/i,gridPos:d};if(E)return E;g.x<g.y?(d.x+=h.x,f=g.x,g.x+=A.x,b=0):(d.y+=h.y,f=g.y,g.y+=A.y,b=1)}return null}u(Rl,"raycastGrid");var Cn,Nf=(Cn=class{constructor(e){q(this,"pt");this.pt=e.clone()}transform(e){return new Cn(e.multVec2(this.pt))}bbox(){return new Ue(this.pt,0,0)}area(){return 0}clone(){return new Cn(this.pt)}collides(e){return wl(this,e)}contains(e){return this.pt.eq(e)}raycast(e,n){return null}random(){return this.pt.clone()}},u(Cn,"Point"),Cn),Pn,Pt=(Pn=class{constructor(e,n){q(this,"p1");q(this,"p2");this.p1=e.clone(),this.p2=n.clone()}transform(e){return new Pn(e.multVec2(this.p1),e.multVec2(this.p2))}bbox(){return Ue.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new Pn(this.p1,this.p2)}collides(e){return Al(this,e)}contains(e){return this.collides(e)}raycast(e,n){return ho(e,n,this)}random(){return this.p1.add(this.p2.sub(this.p1).scale(tt(1)))}},u(Pn,"Line"),Pn),Dn,Ue=(Dn=class{constructor(e,n,r){q(this,"pos");q(this,"width");q(this,"height");this.pos=e.clone(),this.width=n,this.height=r}static fromPoints(e,n){return new Dn(e.clone(),n.x-e.x,n.y-e.y)}center(){return new V(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e){return new Et(this.points().map(n=>e.multVec2(n)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new Dn(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let n=this.pos,r=this.pos.add(this.width,this.height),s=Math.max(n.x-e.x,0,e.x-r.x),i=Math.max(n.y-e.y,0,e.y-r.y);return s*s+i*i}collides(e){return bl(this,e)}contains(e){return this.collides(e)}raycast(e,n){return Sl(e,n,this)}random(){return this.pos.add(tt(this.width),tt(this.height))}},u(Dn,"Rect"),Dn),Xn,Tt=(Xn=class{constructor(e,n){q(this,"center");q(this,"radius");this.center=e.clone(),this.radius=n}transform(e){return new pn(this.center,this.radius,this.radius).transform(e)}bbox(){return Ue.fromPoints(this.center.sub(L(this.radius)),this.center.add(L(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new Xn(this.center,this.radius)}collides(e){return xl(this,e)}contains(e){return this.collides(e)}raycast(e,n){return fo(e,n,this)}random(){return this.center.add(V.fromAngle(tt(360)).scale(tt(this.radius)))}},u(Xn,"Circle"),Xn),Ht,pn=(Ht=class{constructor(e,n,r,s=0){q(this,"center");q(this,"radiusX");q(this,"radiusY");q(this,"angle");this.center=e.clone(),this.radiusX=n,this.radiusY=r,this.angle=s}static fromMat2(e){let n=e.inverse,r=n.transpose.mul(n),[s,i]=r.eigenvalues,[a,f]=r.eigenvectors(s,i),[d,h]=[1/Math.sqrt(s),1/Math.sqrt(i)];return d>h?new Ht(L(),d,h,Bn(Math.atan2(-a[1],a[0]))):new Ht(L(),h,d,Bn(Math.atan2(-f[1],f[0])))}toMat2(){let e=Je(this.angle),n=Math.cos(e),r=Math.sin(e);return new $s(n*this.radiusX,-r*this.radiusY,r*this.radiusX,n*this.radiusY)}transform(e){if(this.angle==0&&e.getRotation()==0)return new Ht(e.multVec2(this.center),e.m[0]*this.radiusX,e.m[5]*this.radiusY);{let n=this.toMat2(),r=e.getRotation(),s=e.getScale();n=ns.fromMat2(n).scale(s.x,s.y).rotate(r).toMat2();let i=Ht.fromMat2(n);return i.center=e.multVec2(this.center),i}}bbox(){if(this.angle==0)return Ue.fromPoints(this.center.sub(L(this.radiusX,this.radiusY)),this.center.add(L(this.radiusX,this.radiusY)));{let e=Je(this.angle),n=Math.cos(e),r=Math.sin(e),s=this.radiusX*n,i=this.radiusX*r,a=this.radiusY*r,f=this.radiusY*n,d=Math.sqrt(s*s+a*a),h=Math.sqrt(i*i+f*f);return Ue.fromPoints(this.center.sub(L(d,h)),this.center.add(L(d,h)))}}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new Ht(this.center,this.radiusX,this.radiusY,this.angle)}collides(e){return El(this,e)}contains(e){e=e.sub(this.center);let n=Je(this.angle),r=Math.cos(n),s=Math.sin(n),i=e.x*r+e.y*s,a=-e.x*s+e.y*r;return i*i/(this.radiusX*this.radiusX)+a*a/(this.radiusY*this.radiusY)<1}raycast(e,n){return Ol(e,n,this)}random(){return this.center}},u(Ht,"Ellipse"),Ht);function Ml(t,e,n,r){let s=e.sub(t),i=r.sub(n),a=s.cross(i);return a<1e-5&&a>-1e-5||(a=n.sub(t).cross(i)/a,a<0||a>1)?null:t.add(s.scale(a))}u(Ml,"segmentLineIntersection");var en,Et=(en=class{constructor(e){q(this,"pts");if(e.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=e}transform(e){return new en(this.pts.map(n=>e.multVec2(n)))}bbox(){let e=L(Number.MAX_VALUE),n=L(-Number.MAX_VALUE);for(let r of this.pts)e.x=Math.min(e.x,r.x),n.x=Math.max(n.x,r.x),e.y=Math.min(e.y,r.y),n.y=Math.max(n.y,r.y);return Ue.fromPoints(e,n)}area(){let e=0,n=this.pts.length;for(let r=0;r<n;r++){let s=this.pts[r],i=this.pts[(r+1)%n];e+=s.x*i.y*.5,e-=i.x*s.y*.5}return Math.abs(e)}clone(){return new en(this.pts.map(e=>e.clone()))}collides(e){return vl(this,e)}contains(e){return this.collides(e)}raycast(e,n){return Il(e,n,this)}random(){return L()}cut(e,n){new Pt(e,n);let r=[],s=[],i=n.sub(e),a=this.pts[this.pts.length-1],f=a.sub(e),d=i.cross(f)>0;return this.pts.forEach(h=>{f=h.sub(e);let A=i.cross(f)>0;if(d!=A){let y=Ml(a,h,e,n);r.push(y),s.push(y),d=A}(A?r:s).push(h),a=h}),[r.length?new en(r):null,s.length?new en(s):null]}},u(en,"Polygon"),en);function Tl(t,e,n,r){let s=r*r,i=1-r,a=i*i;return t.scale(a).add(e.scale(2*i*r)).add(n.scale(s))}u(Tl,"evaluateQuadratic");function Cl(t,e,n,r){let s=1-r;return e.sub(t).scale(2*s).add(n.sub(e).scale(2*r))}u(Cl,"evaluateQuadraticFirstDerivative");function Pl(t,e,n,r){return n.sub(e.scale(2)).add(t).scale(2)}u(Pl,"evaluateQuadraticSecondDerivative");function hi(t,e,n,r,s){let i=s*s,a=i*s,f=1-s,d=f*f,h=d*f;return t.scale(h).add(e.scale(3*d*s)).add(n.scale(3*f*i)).add(r.scale(a))}u(hi,"evaluateBezier");function Dl(t,e,n,r,s){let i=s*s,a=1-s,f=a*a;return e.sub(t).scale(3*f).add(n.sub(e).scale(6*a*s)).add(r.sub(n).scale(3*i))}u(Dl,"evaluateBezierFirstDerivative");function Bl(t,e,n,r,s){let i=1-s;return n.sub(e.scale(2)).add(t).scale(6*i).add(r.sub(n.scale(2)).add(e).scale(6*s))}u(Bl,"evaluateBezierSecondDerivative");function kl(t,e,n,r,s){let i=.5*(((-s+2)*s-1)*s),a=.5*((3*s-5)*s*s+2),f=.5*(((-3*s+4)*s+1)*s),d=.5*((s-1)*s*s);return t.scale(i).add(e.scale(a)).add(n.scale(f)).add(r.scale(d))}u(kl,"evaluateCatmullRom");function ql(t,e,n,r,s){let i=.5*((-3*s+4)*s-1),a=.5*((9*s-10)*s),f=.5*((-9*s+8)*s+1),d=.5*((3*s-2)*s);return t.scale(i).add(e.scale(a)).add(n.scale(f)).add(r.scale(d))}u(ql,"evaluateCatmullRomFirstDerivative");function Fl(t){let e=go(t),n=e(1);return r=>{let s=r*n,i=e(s,!0);return t(i)}}u(Fl,"normalizedCurve");function go(t,e=10,n=10){let r=[0],s=[0],i=1/(e-1)/n,a=0,f=t(0),d=0;for(let h=1;h<e;h++){for(let A=0;A<n;A++){d+=i;let y=t(d),g=y.dist(f);a+=g,f=y}r[h]=a,s[h]=d}return s[e-1]=1,(h,A=!1)=>{if(A){let y=h;if(y<=0)return 0;if(y>=a)return 1;let g=0;for(;r[g+1]<y;)g++;let b=s[g],E=s[g+1],C=r[g],v=r[g+1],S=(y-C)/(v-C);return b+(E-b)*S}else{if(h<=0)return 0;if(h>=1)return r[e-1];let y=0;for(;s[y+1]<h;)y++;let g=s[y],b=s[y+1],E=r[y],C=r[y+1],v=(h-g)/(b-g);return E+(C-E)*v}}}u(go,"curveLengthApproximation");function Xr(t,e,n,r){let s=2*t+e-2*r+n,i=-3*t+3*r-2*e-n,a=e,f=t;return d=>{let h=d*d,A=h*d;return s*A+i*h+a*d+f}}u(Xr,"hermite");function po(t,e,n,r,s,i=Xr){let a=i(e.x,(1-s)*(n.x-t.x),(1-s)*(r.x-e.x),n.x),f=i(e.y,(1-s)*(n.y-t.y),(1-s)*(r.y-e.y),n.y);return d=>new V(a(d),f(d))}u(po,"cardinal");function as(t,e,n,r,s=Xr){return po(t,e,n,r,.5,s)}u(as,"catmullRom");function Nl(t,e,n,r,s=Xr){return as(r.add(t.sub(e).scale(6)),t,r,t.add(r.sub(n).scale(6)),s)}u(Nl,"bezier");function Ll(t,e,n,r,s,i,a,f=Xr){let d=f(e.x,.5*(1-s)*(1+a)*(1+i)*(e.x-t.x)+.5*(1-s)*(1-a)*(1-i)*(n.x-e.x),.5*(1-s)*(1+a)*(1-i)*(n.x-e.x)+.5*(1-s)*(1-a)*(1+i)*(r.x-n.x),n.x),h=f(e.y,.5*(1-s)*(1+a)*(1+i)*(e.y-t.y)+.5*(1-s)*(1-a)*(1-i)*(n.y-e.y),.5*(1-s)*(1+a)*(1-i)*(n.y-e.y)+.5*(1-s)*(1-a)*(1+i)*(r.y-n.y),n.y);return A=>new V(d(A),h(A))}u(Ll,"kochanekBartels");function Ul(t,e,n,r){let s=2*t+e-2*r+n,i=-3*t+3*r-2*e+n,a=e;return f=>{let d=f*f;return 3*s*d+2*i*f+a}}u(Ul,"hermiteFirstDerivative");function yr(t){return 0<=t&&t<=1}u(yr,"inZeroOneDomain");function ks(t,e){return Math.abs(t-e)<=Number.EPSILON}u(ks,"approximately");function wr(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}u(wr,"cubeRoot");function _l(t,e,n,r){let s=3*t-6*e+3*n,i=-3*t+3*e,a=t,f=-t+3*e-3*n+r;if(ks(f,0)){if(ks(s,0))return ks(i,0)?[]:[-a/i].filter(yr);let v=Math.sqrt(i*i-4*s*a),S=2*s;return[(v-i)/S,(-i-v)/S].filter(yr)}s/=f,i/=f,a/=f;let d=(3*i-s*s)/3,h=d/3,A=(2*s*s*s-9*s*i+27*a)/27,y=A/2,g=y*y+h*h*h;if(g<0){let v=-d/3,S=v*v*v,j=Math.sqrt(S),W=-A/(2*j),ee=W<-1?-1:W>1?1:W,re=Math.acos(ee),R=2*wr(j),D=R*Math.cos(re/3)-s/3,N=R*Math.cos((re+2*Math.PI)/3)-s/3,Y=R*Math.cos((re+4*Math.PI)/3)-s/3;return[D,N,Y].filter(yr)}if(g===0){let v=y<0?wr(-y):-wr(y),S=2*v-s/3,j=-v-s/3;return[S,j].filter(yr)}let b=Math.sqrt(g),E=wr(b-y),C=wr(b+y);return[E-C-s/3].filter(yr)}u(_l,"getCubicRoots");function jl(t,e,n,r,s){let i=_l(t.x-s,e.x-s,n.x-s,r.x-s);return i.length>0?hi(t,e,n,r,i[0]).y:NaN}u(jl,"cubicBezierYforX");function $l(t){if(!t||t.length==0)throw new Error("Need at least one point for easingLinear.");let e=t.length;return n=>{if(n<=0||t.length==1||n<=t[0].x)return t[0].y;for(let r=0;r<e;r++)if(t[r].x>=n)return zt(n,t[r-1].x,t[r].x,t[r-1].y,t[r].y);return t[t.length-1].y}}u($l,"easingLinear");function Vl(t,e){return n=>jl(L(0,0),t,e,L(1,1),n)}u(Vl,"easingCubicBezier");function Hl(t,e="jump-end"){let n=1/t,r=e=="jump-start"||e=="jump-both",s=e=="jump-end"||e=="jump-both",i=1/(t+(s?1:0)),a=r?i:0;return f=>{let d=Math.floor(f/n);return a+d*i}}u(Hl,"easingSteps");function zl(t,e){let n=Number.MAX_VALUE,r={normal:L(0),distance:0};for(let s of[t,e])for(let i=0;i<s.pts.length;i++){let a=s.pts[i],f=s.pts[(i+1)%s.pts.length].sub(a).normal().unit(),d=Number.MAX_VALUE,h=-Number.MAX_VALUE;for(let b=0;b<t.pts.length;b++){let E=t.pts[b].dot(f);d=Math.min(d,E),h=Math.max(h,E)}let A=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let b=0;b<e.pts.length;b++){let E=e.pts[b].dot(f);A=Math.min(A,E),y=Math.max(y,E)}let g=Math.min(h,y)-Math.max(d,A);if(g<0)return null;if(g<Math.abs(n)){let b=y-d,E=A-h;n=Math.abs(b)<Math.abs(E)?b:E,r.normal=f,r.distance=n}}return r}u(zl,"sat");function mo(t,e,n){return(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x)>=0}u(mo,"isOrientedCcw");function Kl(t){let e=0,n=t[t.length-1];for(let r=0;r<t.length;r++)e+=(t[r].x-n.x)*(t[r].y+n.y),n=t[r];return e<0}u(Kl,"isOrientedCcwPolygon");function qs(t,e,n,r){let s=r.x-n.x,i=r.y-n.y,a=s*(t.y-n.y)-i*(t.x-n.x),f=s*(e.y-n.y)-i*(e.x-n.x);return a*f>=0}u(qs,"onSameSide");function Gl(t,e,n,r){return qs(t,e,n,r)&&qs(t,n,e,r)&&qs(t,r,e,n)}u(Gl,"pointInTriangle");function Wl(t,e,n,r){for(let s of t)if(s!==e&&s!==n&&s!==r&&Gl(s,e,n,r))return!0;return!1}u(Wl,"someInTriangle");function Yl(t,e,n,r){return mo(t,e,n)&&!Wl(r,t,e,n)}u(Yl,"isEar");function yo(t){if(t.length<3)return[];if(t.length==3)return[t];let e=[],n=[],r=0;for(let y=0;y<t.length;y++){let g=t[r],b=t[y];(b.x<g.x||b.x==g.x&&b.y<g.y)&&(r=r),e[y]=y+1,n[y]=y-1}e[e.length-1]=0,n[0]=n.length-1,Kl(t)||([e,n]=[n,e]);let s=[];for(let y=0;y<t.length;++y)mo(t[n[y]],t[y],t[e[y]])||s.push(t[y]);let i=[],a=t.length,f=1,d=0,h,A;for(;a>3;){h=e[f],A=n[f];let y=t[A],g=t[f],b=t[h];if(Yl(y,g,b,s))i.push([y,g,b]),e[A]=h,n[h]=A,s.splice(s.indexOf(g),1),--a,d=0;else if(++d>a)return[];f=h}return h=e[f],A=n[f],i.push([t[A],t[f],t[h]]),i}u(yo,"triangulate");function Xl(t){if(t.length<3)return!1;let e=t.length-2,n=t.length-1,r=0,s=t[n].sub(t[e]),i=t[r].sub(t[n]),a=s.cross(i);for(;r+1<t.length;)if(e=n,n=r,r++,s=t[n].sub(t[e]),i=t[r].sub(t[n]),s.cross(i)*a<0)return!1;return!0}u(Xl,"isConvex");var Jl=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",fi="topleft",Lf="monospace",Vs="monospace",Li="linear",wo=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],Uf=wo.reduce((t,e)=>t+e.size,0),Ql=2048,_f=Ql*4*Uf,jf=Ql*6,$f=`
attribute vec2 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

vec4 def_vert() {
	return vec4(a_pos, 0.0, 1.0);
}

{{user}}

void main() {
	vec4 pos = vert(a_pos, a_uv, a_color);
	v_pos = a_pos;
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = pos;
}
`,Vf=`
precision mediump float;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

vec4 def_frag() {
	vec4 texColor = texture2D(u_tex, v_uv);
	return vec4((v_color.rgb * texColor.rgb), texColor.a) * v_color.a;
}

{{user}}

void main() {
	gl_FragColor = frag(v_pos, v_uv, v_color, u_tex);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`,Ui=`
vec4 vert(vec2 pos, vec2 uv, vec4 color) {
	return def_vert();
}
`,_i=`
vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
	return def_frag();
}
`,Hf=new Set(["id","require"]),zf=new Set(["add","fixedUpdate","update","draw","destroy","inspect","drawInspect"]),Kf=200,Gf=640,Wf=65536,Zl=Symbol.for("kaplay.cancel"),Ir,eu=(Ir=class extends Map{constructor(){super(...arguments);q(this,"lastID",0)}push(n){let r=this.lastID;return this.set(r,n),this.lastID++,r}pushd(n){let r=this.push(n);return()=>this.delete(r)}},u(Ir,"Registry"),Ir),Jn,tr=(Jn=class{constructor(e){q(this,"paused",!1);q(this,"cancel");this.cancel=e}static join(e){let n=new Jn(()=>e.forEach(r=>r.cancel()));return Object.defineProperty(n,"paused",{get:u(()=>e[0].paused,"get"),set:u(r=>e.forEach(s=>s.paused=r),"set")}),n.paused=!1,n}static replace(e,n){return e.cancel=()=>n.cancel(),n.paused=e.paused,Object.defineProperty(e,"paused",{get:u(()=>n.paused,"get"),set:u(r=>n.paused=r,"set")}),e}},u(Jn,"KEventController"),Jn),Or,xt=(Or=class{constructor(){q(this,"cancellers",new WeakMap);q(this,"handlers",new eu)}add(e){function n(...i){if(!s.paused)return e(...i)}u(n,"handler");let r=this.handlers.pushd(n),s=new tr(r);return this.cancellers.set(n,r),s}addOnce(e){let n=this.add((...r)=>{n.cancel(),e(...r)});return n}next(){return new Promise(e=>this.addOnce(e))}trigger(...e){this.handlers.forEach(n=>{let r=n(...e),s;r===Zl&&(s=this.cancellers.get(n))&&s()})}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},u(Or,"KEvent"),Or),Rr,ls=(Rr=class{constructor(){q(this,"handlers",{});q(this,"registers",{})}on(e,n){return this.handlers[e]||(this.handlers[e]=new xt),this.handlers[e].add(n)}onOnce(e,n){let r=this.on(e,(...s)=>{r.cancel(),n(...s)});return r}next(e){return new Promise(n=>{this.onOnce(e,(...r)=>n(r[0]))})}trigger(e,...n){this.handlers[e]&&this.handlers[e].trigger(...n)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){var n;return((n=this.handlers[e])==null?void 0:n.numListeners())??0}},u(Rr,"KEventHandler"),Rr),Yf=u(t=>t[0]instanceof ve,"arrayIsColor"),Xf=u(t=>t[0]instanceof V,"arrayIsVec2"),Jf=u(t=>typeof t[0]=="number","arrayIsNumber"),Mr,tu=(Mr=class{constructor(e=(n,r)=>n<r){q(this,"_items");q(this,"_compareFn");this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(this._items.length===0)return null;let e=this._items[0],n=this._items.pop();return this._items.length!==0&&(this._items[0]=n,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let n=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[n])&&this._items[e]>=this._items[n])break;this.swap(e,n),e=n}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let n=2*e+1;if(n<this._items.length-1&&!this._compareFn(this._items[n],this._items[n+1])&&++n,this._compareFn(this._items[e],this._items[n]))break;this.swap(e,n),e=n}}swap(e,n){[this._items[e],this._items[n]]=[this._items[n],this._items[e]]}get length(){return this._items.length}},u(Mr,"BinaryHeap"),Mr);function nu(t){let e=window.atob(t),n=e.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=e.charCodeAt(s);return r.buffer}u(nu,"base64ToArrayBuffer");function ru(t){return nu(t.split(",")[1])}u(ru,"dataURLToArrayBuffer");function di(t,e){let n=document.createElement("a");n.href=e,n.download=t,n.click()}u(di,"download");function Ao(t,e){di(t,"data:text/plain;charset=utf-8,"+e)}u(Ao,"downloadText");function su(t,e){Ao(t,JSON.stringify(e))}u(su,"downloadJSON");function ji(t,e){let n=URL.createObjectURL(e);di(t,n),URL.revokeObjectURL(n)}u(ji,"downloadBlob");var iu=u(t=>t.match(/^data:\w+\/\w+;base64,.+/),"isDataURL"),Qf=u(t=>t.split(".").slice(0,-1).join("."),"getFileName");function gi(t,e){if(t===e)return!0;let n=typeof t,r=typeof e;if(n!==r)return!1;if(n==="object"&&r==="object"&&t!==null&&e!==null){if(Array.isArray(t)!==Array.isArray(e))return!1;let s=Object.keys(t),i=Object.keys(e);if(s.length!==i.length)return!1;for(let a of s){let f=t[a],d=e[a];if(!gi(f,d))return!1}return!0}return!1}u(gi,"deepEq");var Fa=new Set,Zf=u(t=>t instanceof Error?t.message:String(t),"getErrorMessage");function ou(t){Fa.has(t)||(Fa.add(t),console.warn(t))}u(ou,"warn");function nr(t,e){ou(`${t} is deprecated. Use ${e} instead.`)}u(nr,"deprecateMsg");function Hs(t,e){return Number(t.toFixed(e))}u(Hs,"toFixed");function qe(t,e){return(...n)=>{let r=n.length;if(r===t.length)return t(...n);if(r===e.length)return e(...n)}}u(qe,"overload2");var ed=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function au(t){if(typeof t!="string")throw new TypeError("string cannot be undefined or null");let e=[],n=0,r=0;for(;n<t.length;){if(r+=lu(n+r,t),pu(t[n+r])&&r++,fu(t[n+r])&&r++,du(t[n+r])&&r++,mu(t[n+r])){r++;continue}e.push(t.substring(n,n+r)),n+=r,r=0}return e}u(au,"runes");function lu(t,e){let n=e[t];if(!uu(n)||t===e.length-1)return 1;let r=n+e[t+1],s=e.substring(t+2,t+5);return $i(r)&&$i(s)?4:cu(r)&&gu(s)?e.slice(t).indexOf(String.fromCodePoint(917631))+2:hu(s)?4:2}u(lu,"nextUnits");function uu(t){return t&&_n(t[0].charCodeAt(0),55296,56319)}u(uu,"isFirstOfSurrogatePair");function $i(t){return _n(pi(t),127462,127487)}u($i,"isRegionalIndicator");function cu(t){return _n(pi(t),127988,127988)}u(cu,"isSubdivisionFlag");function hu(t){return _n(pi(t),127995,127999)}u(hu,"isFitzpatrickModifier");function fu(t){return typeof t=="string"&&_n(t.charCodeAt(0),65024,65039)}u(fu,"isVariationSelector");function du(t){return typeof t=="string"&&_n(t.charCodeAt(0),8400,8447)}u(du,"isDiacriticalMark");function gu(t){let e=t.codePointAt(0);return typeof t=="string"&&typeof e=="number"&&_n(e,917504,917631)}u(gu,"isSupplementarySpecialpurposePlane");function pu(t){return typeof t=="string"&&ed.includes(t.charCodeAt(0))}u(pu,"isGrapheme");function mu(t){return typeof t=="string"&&t.charCodeAt(0)===8205}u(mu,"isZeroWidthJoiner");function pi(t){let e=t.charCodeAt(0)-55296,n=t.charCodeAt(1)-56320;return(e<<10)+n+65536}u(pi,"codePointFromSurrogatePair");function _n(t,e,n){return t>=e&&t<=n}u(_n,"betweenInclusive");var Ft=u((t,e)=>Array.isArray(t)?t==null?void 0:t.includes(e):t===e,"isEqOrIncludes"),Jt=u((t,e)=>Array.isArray(e)?e.some(n=>t.has(n)):t.has(e),"setHasOrIncludes"),Ts=u((t,e,n)=>{var r;t.has(e)?(r=t.get(e))==null||r.push(n):t.set(e,[n])},"mapAddOrPush"),td=(()=>{let t=0;return()=>t++})(),nd={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},rd=u(()=>Yn.lastInputDevice,"getLastInputDeviceType"),sd=u(()=>{let t=Yn.buttons;for(let e in t){let n=t[e].keyboard&&[t[e].keyboard].flat(),r=t[e].keyboardCode&&[t[e].keyboardCode].flat(),s=t[e].gamepad&&[t[e].gamepad].flat(),i=t[e].mouse&&[t[e].mouse].flat();n&&n.forEach(a=>{Ts(Yn.buttonsByKey,a,e)}),r&&r.forEach(a=>{Ts(Yn.buttonsByKeyCode,a,e)}),s&&s.forEach(a=>{Ts(Yn.buttonsByGamepad,a,e)}),i&&i.forEach(a=>{Ts(Yn.buttonsByMouse,a,e)})}},"parseButtonBindings"),Tr,rs=(Tr=class{constructor(){q(this,"pressed",new Set([]));q(this,"pressedRepeat",new Set([]));q(this,"released",new Set([]));q(this,"down",new Set([]))}update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(e){this.pressed.add(e),this.pressedRepeat.add(e),this.down.add(e)}pressRepeat(e){this.pressedRepeat.add(e)}release(e){this.down.delete(e),this.pressed.delete(e),this.released.add(e)}},u(Tr,"ButtonState"),Tr),Cr,id=(Cr=class{constructor(){q(this,"buttonState",new rs);q(this,"stickState",new Map)}},u(Cr,"GamepadState"),Cr),Pr,od=(Pr=class{constructor(){q(this,"dts",[]);q(this,"timer",0);q(this,"fps",0)}tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((n,r)=>n+r)/this.dts.length)),this.dts=[])}},u(Pr,"FPSCounter"),Pr),Yn,Na=nd,ad=u(t=>{let e=t.buttons??{};return{canvas:t.canvas,buttons:e,buttonsByKey:new Map,buttonsByMouse:new Map,buttonsByGamepad:new Map,buttonsByKeyCode:new Map,loopID:null,stopped:!1,dt:0,fixedDt:1/50,restDt:0,time:0,realTime:0,fpsCounter:new od,timeScale:1,skipTime:!1,isHidden:!1,numFrames:0,mousePos:new V(0),mouseDeltaPos:new V(0),keyState:new rs,mouseState:new rs,mergedGamepadState:new id,gamepadStates:new Map,lastInputDevice:null,buttonState:new rs,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:t.canvas.offsetWidth,lastHeight:t.canvas.offsetHeight,events:new ls}},"initAppState"),ld=u(t=>{if(!t.canvas)throw new Error("Please provide a canvas");let e=ad(t);Yn=e,sd();function n(){return e.dt*e.timeScale}u(n,"dt");function r(){return e.fixedDt*e.timeScale}u(r,"fixedDt");function s(){return e.restDt*e.timeScale}u(s,"restDt");function i(){return e.isHidden}u(i,"isHidden");function a(){return e.time}u(a,"time");function f(){return e.fpsCounter.fps}u(f,"fps");function d(){return e.numFrames}u(d,"numFrames");function h(){return e.canvas.toDataURL()}u(h,"screenshot");function A(I){e.canvas.style.cursor=I}u(A,"setCursor");function y(){return e.canvas.style.cursor}u(y,"getCursor");function g(I){if(I)try{let U=e.canvas.requestPointerLock();U!=null&&U.catch&&U.catch(G=>console.error(G))}catch(U){console.error(U)}else document.exitPointerLock()}u(g,"setCursorLocked");function b(){return!!document.pointerLockElement}u(b,"isCursorLocked");function E(I){I.requestFullscreen?I.requestFullscreen():I.webkitRequestFullscreen&&I.webkitRequestFullscreen()}u(E,"enterFullscreen");function C(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}u(C,"exitFullscreen");function v(I=!0){I?E(e.canvas):C()}u(v,"setFullscreen");function S(){return document.fullscreenElement===e.canvas||document.webkitFullscreenElement===e.canvas}u(S,"isFullscreen");function j(){e.stopped=!0;let I=Object.entries(ke),U=Object.entries(lr),G=Object.entries(je);for(let[se,we]of I)e.canvas.removeEventListener(se,we);for(let[se,we]of U)document.removeEventListener(se,we);for(let[se,we]of G)window.removeEventListener(se,we);ur.disconnect()}u(j,"quit");function W(I,U){e.loopID!==null&&cancelAnimationFrame(e.loopID);let G=0,se=0,we=u(Pe=>{if(e.stopped)return;if(document.visibilityState!=="visible"){e.loopID=requestAnimationFrame(we);return}let Ke=Pe/1e3,$e=Math.min(Ke-e.realTime,.25),Bt=t.maxFPS?1/t.maxFPS:0;if(e.realTime=Ke,se+=$e,se>Bt){if(!e.skipTime){for(G+=se,e.dt=e.fixedDt,e.restDt=0;G>e.fixedDt;)G-=e.fixedDt,G<e.fixedDt&&(e.restDt=G),I();e.restDt=G,e.dt=se,e.time+=n(),e.fpsCounter.tick(e.dt)}se=0,e.skipTime=!1,e.numFrames++,U(wn,Ss)}e.loopID=requestAnimationFrame(we)},"frame");we(0)}u(W,"run");function ee(){return"ontouchstart"in window||navigator.maxTouchPoints>0}u(ee,"isTouchscreen");function re(){return e.mousePos.clone()}u(re,"mousePos");function R(){return e.mouseDeltaPos.clone()}u(R,"mouseDeltaPos");function D(I="left"){return e.mouseState.pressed.has(I)}u(D,"isMousePressed");function N(I="left"){return e.mouseState.down.has(I)}u(N,"isMouseDown");function Y(I="left"){return e.mouseState.released.has(I)}u(Y,"isMouseReleased");function Q(){return e.isMouseMoved}u(Q,"isMouseMoved");function ie(I){return I===void 0?e.keyState.pressed.size>0:Jt(e.keyState.pressed,I)}u(ie,"isKeyPressed");function fe(I){return I===void 0?e.keyState.pressedRepeat.size>0:Jt(e.keyState.pressedRepeat,I)}u(fe,"isKeyPressedRepeat");function M(I){return I===void 0?e.keyState.down.size>0:Jt(e.keyState.down,I)}u(M,"isKeyDown");function K(I){return I===void 0?e.keyState.released.size>0:Jt(e.keyState.released,I)}u(K,"isKeyReleased");function z(I){return I===void 0?e.mergedGamepadState.buttonState.pressed.size>0:Jt(e.mergedGamepadState.buttonState.pressed,I)}u(z,"isGamepadButtonPressed");function _(I){return I===void 0?e.mergedGamepadState.buttonState.down.size>0:Jt(e.mergedGamepadState.buttonState.down,I)}u(_,"isGamepadButtonDown");function $(I){return I===void 0?e.mergedGamepadState.buttonState.released.size>0:Jt(e.mergedGamepadState.buttonState.released,I)}u($,"isGamepadButtonReleased");function te(I){return I===void 0?e.buttonState.pressed.size>0:Jt(e.buttonState.pressed,I)}u(te,"isButtonPressed");function he(I){return I===void 0?e.buttonState.down.size>0:Jt(e.buttonState.down,I)}u(he,"isButtonDown");function oe(I){return I===void 0?e.buttonState.released.size>0:Jt(e.buttonState.released,I)}u(oe,"isButtonReleased");function ye(I){var U;return(U=e.buttons)==null?void 0:U[I]}u(ye,"getButton");function le(I,U){e.buttons[I]={...e.buttons[I],...U}}u(le,"setButton");function Fe(I){e.buttonState.press(I),e.events.trigger("buttonPress",I)}u(Fe,"pressButton");function We(I){e.buttonState.release(I),e.events.trigger("buttonRelease",I)}u(We,"releaseButton");function ct(I){return e.events.on("resize",I)}u(ct,"onResize");let jn=qe(I=>e.events.on("keyDown",I),(I,U)=>e.events.on("keyDown",G=>Ft(I,G)&&U(G))),sn=qe(I=>e.events.on("keyPress",U=>I(U)),(I,U)=>e.events.on("keyPress",G=>Ft(I,G)&&U(G))),Qe=qe(I=>e.events.on("keyPressRepeat",I),(I,U)=>e.events.on("keyPressRepeat",G=>Ft(I,G)&&U(G))),Wt=qe(I=>e.events.on("keyRelease",I),(I,U)=>e.events.on("keyRelease",G=>Ft(I,G)&&U(G))),ht=qe(I=>e.events.on("mouseDown",U=>I(U)),(I,U)=>e.events.on("mouseDown",G=>Ft(I,G)&&U(G))),Dt=qe(I=>e.events.on("mousePress",U=>I(U)),(I,U)=>e.events.on("mousePress",G=>Ft(I,G)&&U(G))),ir=qe(I=>e.events.on("mouseRelease",U=>I(U)),(I,U)=>e.events.on("mouseRelease",G=>G===I&&U(G)));function on(I){return e.events.on("mouseMove",()=>I(re(),R()))}u(on,"onMouseMove");function pe(I){return e.events.on("charInput",I)}u(pe,"onCharInput");function Ae(I){return e.events.on("touchStart",I)}u(Ae,"onTouchStart");function xe(I){return e.events.on("touchMove",I)}u(xe,"onTouchMove");function Oe(I){return e.events.on("touchEnd",I)}u(Oe,"onTouchEnd");function _e(I){return e.events.on("scroll",I)}u(_e,"onScroll");function Ee(I){return e.events.on("hide",I)}u(Ee,"onHide");function Ce(I){return e.events.on("show",I)}u(Ce,"onShow");let lt=qe(I=>e.events.on("gamepadButtonPress",(U,G)=>I(U,G)),(I,U)=>e.events.on("gamepadButtonPress",(G,se)=>Ft(I,G)&&U(G,se))),or=qe(I=>e.events.on("gamepadButtonDown",(U,G)=>I(U,G)),(I,U)=>e.events.on("gamepadButtonDown",(G,se)=>Ft(I,G)&&U(G,se))),ar=qe(I=>e.events.on("gamepadButtonRelease",(U,G)=>I(U,G)),(I,U)=>e.events.on("gamepadButtonRelease",(G,se)=>Ft(I,G)&&U(G,se)));function $n(I,U){return e.events.on("gamepadStick",(G,se,we)=>G===I&&U(se,we))}u($n,"onGamepadStick");function Vn(I){e.events.on("gamepadConnect",I)}u(Vn,"onGamepadConnect");function Hn(I){e.events.on("gamepadDisconnect",I)}u(Hn,"onGamepadDisconnect");function It(I){return e.mergedGamepadState.stickState.get(I)||new V(0)}u(It,"getGamepadStick");function _t(){return[...e.charInputted]}u(_t,"charInputted");function yn(){return[...e.gamepads]}u(yn,"getGamepads");let ft=qe(I=>e.events.on("buttonPress",U=>I(U)),(I,U)=>e.events.on("buttonPress",G=>Ft(I,G)&&U(G))),zn=qe(I=>e.events.on("buttonDown",U=>I(U)),(I,U)=>e.events.on("buttonDown",G=>Ft(I,G)&&U(G))),Ne=qe(I=>e.events.on("buttonRelease",U=>I(U)),(I,U)=>e.events.on("buttonRelease",G=>Ft(I,G)&&U(G)));function wn(){e.events.trigger("input"),e.keyState.down.forEach(I=>e.events.trigger("keyDown",I)),e.mouseState.down.forEach(I=>e.events.trigger("mouseDown",I)),e.buttonState.down.forEach(I=>{e.events.trigger("buttonDown",I)}),Is()}u(wn,"processInput");function Ss(){e.keyState.update(),e.mouseState.update(),e.buttonState.update(),e.mergedGamepadState.buttonState.update(),e.mergedGamepadState.stickState.forEach((I,U)=>{e.mergedGamepadState.stickState.set(U,new V(0))}),e.charInputted=[],e.isMouseMoved=!1,e.mouseDeltaPos=new V(0),e.gamepadStates.forEach(I=>{I.buttonState.update(),I.stickState.forEach((U,G)=>{I.stickState.set(G,new V(0))})})}u(Ss,"resetInput");function dt(I){let U={index:I.index,isPressed:u(G=>{var se;return((se=e.gamepadStates.get(I.index))==null?void 0:se.buttonState.pressed.has(G))||!1},"isPressed"),isDown:u(G=>{var se;return((se=e.gamepadStates.get(I.index))==null?void 0:se.buttonState.down.has(G))||!1},"isDown"),isReleased:u(G=>{var se;return((se=e.gamepadStates.get(I.index))==null?void 0:se.buttonState.released.has(G))||!1},"isReleased"),getStick:u(G=>{var se;return((se=e.gamepadStates.get(I.index))==null?void 0:se.stickState.get(G))||L()},"getStick")};return e.gamepads.push(U),e.gamepadStates.set(I.index,{buttonState:new rs,stickState:new Map([["left",new V(0)],["right",new V(0)]])}),U}u(dt,"registerGamepad");function An(I){e.gamepads=e.gamepads.filter(U=>U.index!==I.index),e.gamepadStates.delete(I.index)}u(An,"removeGamepad");function Is(){var I,U;for(let G of navigator.getGamepads())G&&!e.gamepadStates.has(G.index)&&dt(G);for(let G of e.gamepads){let se=navigator.getGamepads()[G.index];if(!se)continue;let we=(t.gamepads??{})[se.id]||Na[se.id]||Na.default,Pe=e.gamepadStates.get(G.index);if(Pe){for(let Ke=0;Ke<se.buttons.length;Ke++){let $e=we.buttons[Ke],Bt=se.buttons[Ke],kt=e.buttonsByGamepad.has($e);if(Bt.pressed){if(Pe.buttonState.down.has($e)){e.events.trigger("gamepadButtonDown",$e,G);continue}e.lastInputDevice="gamepad",kt&&((I=e.buttonsByGamepad.get($e))==null||I.forEach(mt=>{e.buttonState.press(mt),e.events.trigger("buttonPress",mt)})),e.mergedGamepadState.buttonState.press($e),Pe.buttonState.press($e),e.events.trigger("gamepadButtonPress",$e,G)}else Pe.buttonState.down.has($e)&&(kt&&((U=e.buttonsByGamepad.get($e))==null||U.forEach(mt=>{e.buttonState.release(mt),e.events.trigger("buttonRelease",mt)})),e.mergedGamepadState.buttonState.release($e),Pe.buttonState.release($e),e.events.trigger("gamepadButtonRelease",$e,G))}for(let Ke in we.sticks){let $e=we.sticks[Ke];if(!$e)continue;let Bt=new V(se.axes[$e.x],se.axes[$e.y]);Pe.stickState.set(Ke,Bt),e.mergedGamepadState.stickState.set(Ke,Bt),e.events.trigger("gamepadStick",Ke,Bt,G)}}}}u(Is,"processGamepad");let ke={},lr={},je={},gt=t.pixelDensity||1;ke.mousemove=I=>{let U=new V(I.offsetX,I.offsetY),G=new V(I.movementX,I.movementY);if(S()){let se=e.canvas.width/gt,we=e.canvas.height/gt,Pe=window.innerWidth,Ke=window.innerHeight,$e=Pe/Ke,Bt=se/we;if($e>Bt){let kt=Ke/we,mt=(Pe-se*kt)/2;U.x=zt(I.offsetX-mt,0,se*kt,0,se),U.y=zt(I.offsetY,0,we*kt,0,we)}else{let kt=Pe/se,mt=(Ke-we*kt)/2;U.x=zt(I.offsetX,0,se*kt,0,se),U.y=zt(I.offsetY-mt,0,we*kt,0,we)}}e.events.onOnce("input",()=>{e.isMouseMoved=!0,e.mousePos=U,e.mouseDeltaPos=G,e.events.trigger("mouseMove")})};let Jr=["left","middle","right","back","forward"];ke.mousedown=I=>{e.events.onOnce("input",()=>{var G;let U=Jr[I.button];U&&(e.lastInputDevice="mouse",e.buttonsByMouse.has(U)&&((G=e.buttonsByMouse.get(U))==null||G.forEach(se=>{e.buttonState.press(se),e.events.trigger("buttonPress",se)})),e.mouseState.press(U),e.events.trigger("mousePress",U))})},ke.mouseup=I=>{e.events.onOnce("input",()=>{var G;let U=Jr[I.button];U&&(e.buttonsByMouse.has(U)&&((G=e.buttonsByMouse.get(U))==null||G.forEach(se=>{e.buttonState.release(se),e.events.trigger("buttonRelease",se)})),e.mouseState.release(U),e.events.trigger("mouseRelease",U))})};let pt=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),an={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};ke.keydown=I=>{pt.has(I.key)&&I.preventDefault(),e.events.onOnce("input",()=>{var se,we;let U=an[I.key]||I.key.toLowerCase(),G=I.code;if(U===void 0)throw new Error(`Unknown key: ${I.key}`);U.length===1?(e.events.trigger("charInput",U),e.charInputted.push(U)):U==="space"&&(e.events.trigger("charInput"," "),e.charInputted.push(" ")),I.repeat?(e.keyState.pressRepeat(U),e.events.trigger("keyPressRepeat",U)):(e.lastInputDevice="keyboard",e.buttonsByKey.has(U)&&((se=e.buttonsByKey.get(U))==null||se.forEach(Pe=>{e.buttonState.press(Pe),e.events.trigger("buttonPress",Pe)})),e.buttonsByKeyCode.has(G)&&((we=e.buttonsByKeyCode.get(G))==null||we.forEach(Pe=>{e.buttonState.press(Pe),e.events.trigger("buttonPress",Pe)})),e.keyState.press(U),e.events.trigger("keyPressRepeat",U),e.events.trigger("keyPress",U))})},ke.keyup=I=>{e.events.onOnce("input",()=>{var se,we;let U=an[I.key]||I.key.toLowerCase(),G=I.code;e.buttonsByKey.has(U)&&((se=e.buttonsByKey.get(U))==null||se.forEach(Pe=>{e.buttonState.release(Pe),e.events.trigger("buttonRelease",Pe)})),e.buttonsByKeyCode.has(G)&&((we=e.buttonsByKeyCode.get(G))==null||we.forEach(Pe=>{e.buttonState.release(Pe),e.events.trigger("buttonRelease",Pe)})),e.keyState.release(U),e.events.trigger("keyRelease",U)})},ke.touchstart=I=>{I.preventDefault(),e.events.onOnce("input",()=>{var se;let U=[...I.changedTouches],G=e.canvas.getBoundingClientRect();t.touchToMouse!==!1&&(e.mousePos=new V(U[0].clientX-G.x,U[0].clientY-G.y),e.lastInputDevice="mouse",e.buttonsByMouse.has("left")&&((se=e.buttonsByMouse.get("left"))==null||se.forEach(we=>{e.buttonState.press(we),e.events.trigger("buttonPress",we)})),e.mouseState.press("left"),e.events.trigger("mousePress","left")),U.forEach(we=>{e.events.trigger("touchStart",new V(we.clientX-G.x,we.clientY-G.y),we)})})},ke.touchmove=I=>{I.preventDefault(),e.events.onOnce("input",()=>{let U=[...I.changedTouches],G=e.canvas.getBoundingClientRect();if(t.touchToMouse!==!1){let se=e.mousePos;e.mousePos=new V(U[0].clientX-G.x,U[0].clientY-G.y),e.mouseDeltaPos=e.mousePos.sub(se),e.events.trigger("mouseMove")}U.forEach(se=>{e.events.trigger("touchMove",new V(se.clientX-G.x,se.clientY-G.y),se)})})},ke.touchend=I=>{e.events.onOnce("input",()=>{var se;let U=[...I.changedTouches],G=e.canvas.getBoundingClientRect();t.touchToMouse!==!1&&(e.mousePos=new V(U[0].clientX-G.x,U[0].clientY-G.y),e.mouseDeltaPos=new V(0,0),e.buttonsByMouse.has("left")&&((se=e.buttonsByMouse.get("left"))==null||se.forEach(we=>{e.buttonState.release(we),e.events.trigger("buttonRelease",we)})),e.mouseState.release("left"),e.events.trigger("mouseRelease","left")),U.forEach(we=>{e.events.trigger("touchEnd",new V(we.clientX-G.x,we.clientY-G.y),we)})})},ke.touchcancel=I=>{e.events.onOnce("input",()=>{let U=[...I.changedTouches],G=e.canvas.getBoundingClientRect();t.touchToMouse!==!1&&(e.mousePos=new V(U[0].clientX-G.x,U[0].clientY-G.y),e.mouseState.release("left"),e.events.trigger("mouseRelease","left")),U.forEach(se=>{e.events.trigger("touchEnd",new V(se.clientX-G.x,se.clientY-G.y),se)})})},ke.wheel=I=>{I.preventDefault(),e.events.onOnce("input",()=>{e.events.trigger("scroll",new V(I.deltaX,I.deltaY))})},ke.contextmenu=I=>I.preventDefault(),lr.visibilitychange=()=>{document.visibilityState==="visible"?(e.skipTime=!0,e.isHidden=!1,e.events.trigger("show")):(e.isHidden=!0,e.events.trigger("hide"))},je.gamepadconnected=I=>{let U=dt(I.gamepad);e.events.onOnce("input",()=>{e.events.trigger("gamepadConnect",U)})},je.gamepaddisconnected=I=>{let U=yn().filter(G=>G.index===I.gamepad.index)[0];An(I.gamepad),e.events.onOnce("input",()=>{e.events.trigger("gamepadDisconnect",U)})};for(let[I,U]of Object.entries(ke))e.canvas.addEventListener(I,U);for(let[I,U]of Object.entries(lr))document.addEventListener(I,U);for(let[I,U]of Object.entries(je))window.addEventListener(I,U);let ur=new ResizeObserver(I=>{for(let U of I)if(U.target===e.canvas){if(e.lastWidth===e.canvas.offsetWidth&&e.lastHeight===e.canvas.offsetHeight)return;e.lastWidth=e.canvas.offsetWidth,e.lastHeight=e.canvas.offsetHeight,e.events.onOnce("input",()=>{e.events.trigger("resize")})}});return ur.observe(e.canvas),{state:e,dt:n,fixedDt:r,restDt:s,time:a,run:W,canvas:e.canvas,fps:f,numFrames:d,quit:j,isHidden:i,setFullscreen:v,isFullscreen:S,setCursor:A,screenshot:h,getGamepads:yn,getCursor:y,setCursorLocked:g,isCursorLocked:b,isTouchscreen:ee,mousePos:re,mouseDeltaPos:R,isKeyDown:M,isKeyPressed:ie,isKeyPressedRepeat:fe,isKeyReleased:K,isMouseDown:N,isMousePressed:D,isMouseReleased:Y,isMouseMoved:Q,isGamepadButtonPressed:z,isGamepadButtonDown:_,isGamepadButtonReleased:$,getGamepadStick:It,isButtonPressed:te,isButtonDown:he,isButtonReleased:oe,setButton:le,getButton:ye,pressButton:Fe,releaseButton:We,charInputted:_t,onResize:ct,onKeyDown:jn,onKeyPress:sn,onKeyPressRepeat:Qe,onKeyRelease:Wt,onMouseDown:ht,onMousePress:Dt,onMouseRelease:ir,onMouseMove:on,onCharInput:pe,onTouchStart:Ae,onTouchMove:xe,onTouchEnd:Oe,onScroll:_e,onHide:Ee,onShow:Ce,onGamepadButtonDown:or,onGamepadButtonPress:lt,onGamepadButtonRelease:ar,onGamepadStick:$n,onGamepadConnect:Vn,onGamepadDisconnect:Hn,onButtonPress:ft,onButtonDown:zn,onButtonRelease:Ne,getLastInputDeviceType:rd,events:e.events}},"initApp");function nt(){return m.app.dt()}u(nt,"dt");function zs(){return m.app.fixedDt()}u(zs,"fixedDt");function Ks(){return m.app.restDt()}u(Ks,"restDt");var ud=new V(-1,-1),cd=new V(0,-1),hd=new V(1,-1),fd=new V(-1,0),dd=new V(0,0),gd=new V(1,0),pd=new V(-1,1),md=new V(0,1),yd=new V(1,1);function rr(t){switch(t){case"topleft":return ud;case"top":return cd;case"topright":return hd;case"left":return fd;case"center":return dd;case"right":return gd;case"botleft":return pd;case"bot":return md;case"botright":return yd;default:return t}}u(rr,"anchorPt");function yu(t){switch(t){case"left":return 0;case"center":return .5;case"right":return 1;default:return 0}}u(yu,"alignPt");function wu(t){return t.createBuffer(1,1,44100)}u(wu,"createEmptyAudioBuffer");var Cs=2.5949095,La=1.70158+1,Ua=2*Math.PI/3,_a=2*Math.PI/4.5,Fs={linear:u(t=>t,"linear"),easeInSine:u(t=>1-Math.cos(t*Math.PI/2),"easeInSine"),easeOutSine:u(t=>Math.sin(t*Math.PI/2),"easeOutSine"),easeInOutSine:u(t=>-(Math.cos(Math.PI*t)-1)/2,"easeInOutSine"),easeInQuad:u(t=>t*t,"easeInQuad"),easeOutQuad:u(t=>1-(1-t)*(1-t),"easeOutQuad"),easeInOutQuad:u(t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,"easeInOutQuad"),easeInCubic:u(t=>t*t*t,"easeInCubic"),easeOutCubic:u(t=>1-Math.pow(1-t,3),"easeOutCubic"),easeInOutCubic:u(t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,"easeInOutCubic"),easeInQuart:u(t=>t*t*t*t,"easeInQuart"),easeOutQuart:u(t=>1-Math.pow(1-t,4),"easeOutQuart"),easeInOutQuart:u(t=>t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2,"easeInOutQuart"),easeInQuint:u(t=>t*t*t*t*t,"easeInQuint"),easeOutQuint:u(t=>1-Math.pow(1-t,5),"easeOutQuint"),easeInOutQuint:u(t=>t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2,"easeInOutQuint"),easeInExpo:u(t=>t===0?0:Math.pow(2,10*t-10),"easeInExpo"),easeOutExpo:u(t=>t===1?1:1-Math.pow(2,-10*t),"easeOutExpo"),easeInOutExpo:u(t=>t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2,"easeInOutExpo"),easeInCirc:u(t=>1-Math.sqrt(1-Math.pow(t,2)),"easeInCirc"),easeOutCirc:u(t=>Math.sqrt(1-Math.pow(t-1,2)),"easeOutCirc"),easeInOutCirc:u(t=>t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2,"easeInOutCirc"),easeInBack:u(t=>La*t*t*t-1.70158*t*t,"easeInBack"),easeOutBack:u(t=>1+La*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2),"easeOutBack"),easeInOutBack:u(t=>t<.5?Math.pow(2*t,2)*((Cs+1)*2*t-Cs)/2:(Math.pow(2*t-2,2)*((Cs+1)*(t*2-2)+Cs)+2)/2,"easeInOutBack"),easeInElastic:u(t=>t===0?0:t===1?1:-Math.pow(2,10*t-10)*Math.sin((t*10-10.75)*Ua),"easeInElastic"),easeOutElastic:u(t=>t===0?0:t===1?1:Math.pow(2,-10*t)*Math.sin((t*10-.75)*Ua)+1,"easeOutElastic"),easeInOutElastic:u(t=>t===0?0:t===1?1:t<.5?-(Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*_a))/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*_a)/2+1,"easeInOutElastic"),easeInBounce:u(t=>1-Fs.easeOutBounce(1-t),"easeInBounce"),easeOutBounce:u(t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,"easeOutBounce"),easeInOutBounce:u(t=>t<.5?(1-Fs.easeOutBounce(1-2*t))/2:(1+Fs.easeOutBounce(2*t-1))/2,"easeInOutBounce")},us=Fs;function Au(t,e,n){let r=[],s=e;for(r.push(s);s!==t;){if(s=n.get(s),s==null)return null;r.push(s)}return r.reverse()}u(Au,"buildPath");function xu(t,e,n){var a;let r=new tu((f,d)=>f.cost<d.cost);r.insert({cost:0,node:e});let s=new Map;s.set(e,e);let i=new Map;for(i.set(e,0);r.length!==0;){let f=(a=r.remove())==null?void 0:a.node;if(f===n)break;let d=t.getNeighbours(f);for(let h of d){let A=(i.get(f)||0)+t.getCost(f,h)+t.getHeuristic(h,n);(!i.has(h)||A<i.get(h))&&(i.set(h,A),r.insert({cost:A,node:h}),s.set(h,f))}}return Au(e,n,s)}u(xu,"aStarSearch");var Dr,wd=(Dr=class{constructor(e,n,r){q(this,"a");q(this,"b");q(this,"polygon");this.a=e,this.b=n,this.polygon=new WeakRef(r)}isLeft(e,n){return(this.b.x-this.a.x)*(n-this.a.y)-(e-this.a.x)*(this.b.y-this.a.y)}get middle(){return this.a.add(this.b).scale(.5)}},u(Dr,"NavEdge"),Dr),Br,Ad=(Br=class{constructor(e){q(this,"_edges");q(this,"_centroid");q(this,"_id");this._id=e}get id(){return this._id}set edges(e){this._edges=e;let n=0,r=0,s=0;for(let i of this._edges){i.polygon=new WeakRef(this);let a=i.a.x*i.b.y-i.a.y*i.b.x;n+=(i.a.x+i.b.x)*a,r+=(i.a.y+i.b.y)*a,s+=a}s/=2,this._centroid=L(n/(6*s),r/(6*s))}get edges(){return this._edges}get centroid(){return this._centroid}contains(e){let n=!1;for(let r of this.edges)r.b.y>e.y!=r.a.y>e.y&&e.x<(r.a.x-r.b.x)*(e.y-r.b.y)/(r.a.y-r.b.y)+r.b.x&&(n=!n);return n}},u(Br,"NavPolygon"),Br),kr,xd=(kr=class{constructor(){q(this,"_polygons");q(this,"_pointCache");q(this,"_edgeCache");this._polygons=[],this._pointCache={},this._edgeCache={}}_addPoint(e){let n=this._pointCache[`${e.x}_${e.y}`];return n||(n=e.clone(),this._pointCache[`${e.x}_${e.y}`]=n,n)}_addEdge(e){let n=`${e.a.x}_${e.a.y}-${e.b.x}_${e.b.y}`;return this._edgeCache[n]=e,e}_findEdge(e,n){let r=`${e.x}_${e.y}-${n.x}_${n.y}`;return this._edgeCache[r]}_findCommonEdge(e,n){for(let r of e.edges){let s=this._findEdge(r.b,r.a);if(s&&s.polygon.deref().id===n.id)return s}return null}addPolygon(e){let n=new Ad(this._polygons.length),r=e.map((s,i)=>new wd(s,e[(i+1)%e.length],n));n.edges=r,this._polygons.push(n);for(let s of n.edges)this._addEdge(s);return n}addRect(e,n){let r=this._addPoint(e),s=this._addPoint(e.add(n.x,0)),i=this._addPoint(e.add(n)),a=this._addPoint(e.add(0,n.y));return this.addPolygon([r,s,i,a])}_getLocation(e){for(let n of this._polygons)if(n.contains(e))return n;return null}getNeighbours(e){let n=[];for(let r of this._polygons[e].edges){let s=this._findEdge(r.b,r.a);if(s){let i=s.polygon.deref();i&&n.push(i.id)}}return n}getCost(e,n){return 1}getHeuristic(e,n){let r=this._polygons[e],s=this._polygons[n],i=r.centroid.x-s.centroid.x,a=r.centroid.y-s.centroid.y;return Math.sqrt(i*i+a*a)}getPath(e,n){return e===void 0||n===void 0?[]:e===n?[e,n]:xu(this,e,n)}getWaypointPath(e,n,r){let s=(r==null?void 0:r.type)||"centroids",i=this._getLocation(e),a=this._getLocation(n);if(i===void 0||a===void 0)return[];let f=this.getPath(i.id,a.id);if(!f)return[];if(s==="edges"){let d=[];for(let h=1;h<f.length;h++){let A=this._polygons[f[h-1]],y=this._polygons[f[h]],g=this._findCommonEdge(A,y);d.push(g.middle.add(y.centroid.sub(g.middle).unit().scale(4)))}return[e,...d,n]}else return[e,...f.slice(1,-1).map(d=>this._polygons[d].centroid),n]}},u(kr,"NavMesh"),kr);function br(t){let e=new nn;return t.pos&&e.translate(t.pos),t.scale&&e.scale(t.scale),t.angle&&e.rotate(t.angle),t.parent?e.mult(t.parent.transform):e}u(br,"calcTransform");function bu(t){return new V(t.x/st()*2-1,-t.y/ot()*2+1)}u(bu,"screen2ndc");function Ar(t,e,n,r,s,i=1){r=Je(r%360),s=Je(s%360),s<=r&&(s+=Math.PI*2);let a=[],f=Math.ceil((s-r)/Je(8)*i),d=(s-r)/f,h=L(Math.cos(r),Math.sin(r)),A=L(Math.cos(d),Math.sin(d));for(let y=0;y<=f;y++)a.push(t.add(e*h.x,n*h.y)),h=L(h.x*A.x-h.y*A.y,h.x*A.y+h.y*A.x);return a}u(Ar,"getArcPts");function vu(...t){let e=Re(...t),n=t[3]??1;m.gfx.bgColor=e,m.gfx.bgAlpha=n,m.gfx.ggl.gl.clearColor(e.r/255,e.g/255,e.b/255,n)}u(vu,"setBackground");function Eu(){var t,e;return((e=(t=m.gfx.bgColor)==null?void 0:t.clone)==null?void 0:e.call(t))??null}u(Eu,"getBackground");function He(...t){if(t[0]===void 0)return;let e=L(...t);e.x===0&&e.y===0||m.gfx.transform.translate(e)}u(He,"pushTranslate");function Ot(){m.gfx.transformStack.push(m.gfx.transform.clone())}u(Ot,"pushTransform");function Su(t){m.gfx.transform=t.clone()}u(Su,"pushMatrix");function Kr(...t){if(t[0]===void 0)return;let e=L(...t);e.x===1&&e.y===1||m.gfx.transform.scale(e)}u(Kr,"pushScale");function er(t){t&&m.gfx.transform.rotate(t)}u(er,"pushRotate");function bt(){m.gfx.transformStack.length>0&&(m.gfx.transform=m.gfx.transformStack.pop())}u(bt,"popTransform");function Rt(){m.gfx.renderer.flush()}u(Rt,"flush");function st(){return m.gfx.width}u(st,"width");function ot(){return m.gfx.height}u(ot,"height");function xo(){return(m.gfx.viewport.width+m.gfx.viewport.height)/(m.gfx.width+m.gfx.height)}u(xo,"getViewportScale");function Iu(t){return new V(t.x*m.gfx.viewport.width/m.gfx.width,t.y*m.gfx.viewport.height/m.gfx.height)}u(Iu,"contentToView");function Ou(t){return new V((t.x-m.gfx.viewport.x)*st()/m.gfx.viewport.width,(t.y-m.gfx.viewport.y)*ot()/m.gfx.viewport.height)}u(Ou,"windowToContent");function bo(){return Ou(m.app.mousePos())}u(bo,"mousePos");function cs(){return L(st()/2,ot()/2)}u(cs,"center");var qr,bd=(qr=class{constructor(e,n,r,s){q(this,"lastTextureId",0);q(this,"textures",[]);q(this,"bigTextures",[]);q(this,"texturesPosition",new Map);q(this,"canvas");q(this,"c2d");q(this,"x",0);q(this,"y",0);q(this,"curHeight",0);q(this,"gfx");q(this,"padding");this.gfx=e,this.canvas=document.createElement("canvas"),this.canvas.width=n,this.canvas.height=r,this.textures=[On.fromImage(e,this.canvas)],this.bigTextures=[],this.padding=s;let i=this.canvas.getContext("2d");if(!i)throw new Error("Failed to get 2d context");this.c2d=i}add_single(e){let n=On.fromImage(this.gfx,e);return this.bigTextures.push(n),[n,new ze(0,0,1,1),0]}add(e){let n=e.width+this.padding*2,r=e.height+this.padding*2;(n>this.canvas.width||r>this.canvas.height)&&this.add_single(e),this.x+n>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+r>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(On.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let s=this.textures[this.textures.length-1],i=new V(this.x+this.padding,this.y+this.padding);return this.x+=n,r>this.curHeight&&(this.curHeight=r),e instanceof ImageData?this.c2d.putImageData(e,i.x,i.y):this.c2d.drawImage(e,i.x,i.y),s.update(this.canvas),this.texturesPosition.set(this.lastTextureId,{position:i,size:new V(e.width,e.height),texture:s}),this.lastTextureId++,[s,new ze(i.x/this.canvas.width,i.y/this.canvas.height,e.width/this.canvas.width,e.height/this.canvas.height),this.lastTextureId-1]}free(){for(let e of this.textures)e.free();for(let e of this.bigTextures)e.free()}},u(qr,"TexPacker"),qr);function Ct(t){return typeof t!="string"||iu(t)?t:m.assets.urlPrefix+t}u(Ct,"fixURL");var Qn,Ut=(Qn=class{constructor(e){q(this,"loaded",!1);q(this,"data",null);q(this,"error",null);q(this,"onLoadEvents",new xt);q(this,"onErrorEvents",new xt);q(this,"onFinishEvents",new xt);e.then(n=>{this.loaded=!0,this.data=n,this.onLoadEvents.trigger(n)}).catch(n=>{if(this.error=n,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(n);else throw n}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(e){let n=new Qn(Promise.resolve(e));return n.data=e,n.loaded=!0,n}onLoad(e){return this.loaded&&this.data?e(this.data):this.onLoadEvents.add(e),this}onError(e){return this.loaded&&this.error?e(this.error):this.onErrorEvents.add(e),this}onFinish(e){return this.loaded?e():this.onFinishEvents.add(e),this}then(e){return this.onLoad(e)}catch(e){return this.onError(e)}finally(e){return this.onFinish(e)}},u(Qn,"Asset"),Qn),Fr,pr=(Fr=class{constructor(){q(this,"assets",new Map);q(this,"lastUID",0)}add(e,n){let r=e??this.lastUID+++"",s=new Ut(n);return this.assets.set(r,s),s}addLoaded(e,n){let r=e??this.lastUID+++"",s=Ut.loaded(n);return this.assets.set(r,s),s}get(e){return this.assets.get(e)}progress(){if(this.assets.size===0)return 1;let e=0;return this.assets.forEach(n=>{n.loaded&&e++}),e/this.assets.size}getFailedAssets(){return Array.from(this.assets.keys()).filter(e=>this.assets.get(e).error!==null).map(e=>[e,this.assets.get(e)])}},u(Fr,"AssetBucket"),Fr);function mi(t){return fetch(t).then(e=>{if(!e.ok)throw new Error(`Failed to fetch "${t}"`);return e})}u(mi,"fetchURL");function ws(t){return mi(t).then(e=>e.json())}u(ws,"fetchJSON");function Ru(t){return mi(t).then(e=>e.text())}u(Ru,"fetchText");function Mu(t){return mi(t).then(e=>e.arrayBuffer())}u(Mu,"fetchArrayBuffer");function Tu(t){return t!==void 0&&(m.assets.urlPrefix=t),m.assets.urlPrefix}u(Tu,"loadRoot");function Cu(t,e){return m.assets.custom.add(t,ws(Ct(e)))}u(Cu,"loadJSON");function As(t){let e=new Image;return e.crossOrigin="anonymous",e.src=t,new Promise((n,r)=>{e.onload=()=>n(e),e.onerror=()=>r(new Error(`Failed to load image from "${t}"`))})}u(As,"loadImg");function kn(){let t=[m.assets.sprites,m.assets.sounds,m.assets.shaders,m.assets.fonts,m.assets.bitmapFonts,m.assets.custom];return t.reduce((e,n)=>e+n.progress(),0)/t.length}u(kn,"loadProgress");function vo(){return[m.assets.sprites,m.assets.sounds,m.assets.shaders,m.assets.fonts,m.assets.bitmapFonts,m.assets.custom].reduce((t,e)=>t.concat(e.getFailedAssets()),[])}u(vo,"getFailedAssets");function Pu(t){return m.assets.custom.get(t)??null}u(Pu,"getAsset");function Gs(t){return m.assets.custom.add(null,t)}u(Gs,"load");var vd=u((t,e)=>({urlPrefix:"",sprites:new pr,fonts:new pr,bitmapFonts:new pr,sounds:new pr,shaders:new pr,custom:new pr,music:{},packer:new bd(t,2048,2048,e),loaded:!1}),"initAssets"),Ed="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==",tn,qn=(tn=class{constructor(e,n,r={},s=null){q(this,"tex");q(this,"frames",[new ze(0,0,1,1)]);q(this,"anims",{});q(this,"slice9",null);this.tex=e,n&&(this.frames=n),this.anims=r,this.slice9=s}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(e,n={}){return typeof e=="string"?tn.fromURL(e,n):Promise.resolve(tn.fromImage(e,n))}static fromImage(e,n={}){let[r,s]=n.singular?m.assets.packer.add_single(e):m.assets.packer.add(e),i=n.frames?n.frames.map(a=>new ze(s.x+a.x*s.w,s.y+a.y*s.h,a.w*s.w,a.h*s.h)):So(n.sliceX||1,n.sliceY||1,s.x,s.y,s.w,s.h);return new tn(r,i,n.anims,n.slice9)}static fromURL(e,n={}){return As(e).then(r=>tn.fromImage(r,n))}},u(tn,"SpriteData"),tn);function ss(t){if(typeof t=="string"){let e=Eo(t);if(e)return e;if(kn()<1)return null;throw new Error(`Sprite not found: ${t}`)}else{if(t instanceof qn)return Ut.loaded(t);if(t instanceof Ut)return t;throw new Error(`Invalid sprite: ${t}`)}}u(ss,"resolveSprite");function Eo(t){return m.assets.sprites.get(t)??null}u(Eo,"getSprite");function vr(t,e,n={sliceX:1,sliceY:1,anims:{}}){return e=Ct(e),Array.isArray(e)?e.some(r=>typeof r=="string")?m.assets.sprites.add(t,Promise.all(e.map(r=>typeof r=="string"?As(r):Promise.resolve(r))).then(r=>Vi(r,n))):m.assets.sprites.addLoaded(t,Vi(e,n)):typeof e=="string"?m.assets.sprites.add(t,qn.from(e,n)):m.assets.sprites.addLoaded(t,qn.fromImage(e,n))}u(vr,"loadSprite");function So(t=1,e=1,n=0,r=0,s=1,i=1){let a=[],f=s/t,d=i/e;for(let h=0;h<e;h++)for(let A=0;A<t;A++)a.push(new ze(n+A*f,r+h*d,f,d));return a}u(So,"slice");function Vi(t,e={}){let n=document.createElement("canvas"),r=t[0].width,s=t[0].height;n.width=r*t.length,n.height=s;let i=n.getContext("2d");if(!i)throw new Error("Failed to create canvas context");t.forEach((f,d)=>{f instanceof ImageData?i.putImageData(f,d*r,0):i.drawImage(f,d*r,0)});let a=i.getImageData(0,0,t.length*r,s);return qn.fromImage(a,{...e,sliceX:t.length,sliceY:1})}u(Vi,"createSpriteSheet");function Du(t="bean"){return vr(t,Ed)}u(Du,"loadBean");function Bu(t,e,n){e=Ct(e),n=Ct(n),typeof e=="string"&&!n&&(n=Qf(e)+".json");let r=typeof n=="string"?ws(n):Promise.resolve(n);return m.assets.sprites.add(t,r.then(s=>{let i=s.meta.size,a=s.frames.map(d=>new ze(d.frame.x/i.w,d.frame.y/i.h,d.frame.w/i.w,d.frame.h/i.h)),f={};for(let d of s.meta.frameTags)d.from===d.to?f[d.name]=d.from:f[d.name]={from:d.from,to:d.to,speed:10,loop:!0,pingpong:d.direction==="pingpong"};return qn.from(e,{frames:a,anims:f})}))}u(Bu,"loadAseprite");var Nr,Ns=(Nr=class{constructor(e,n={}){q(this,"fontface");q(this,"filter",Li);q(this,"outline",null);q(this,"size",64);if(this.fontface=e,this.filter=n.filter??Li,this.size=n.size??64,this.size>256)throw new Error("Max font size: 256");n.outline&&(this.outline={width:1,color:Re(0,0,0)},typeof n.outline=="number"?this.outline.width=n.outline:typeof n.outline=="object"&&(n.outline.width&&(this.outline.width=n.outline.width),n.outline.color&&(this.outline.color=n.outline.color)))}},u(Nr,"FontData"),Nr);function Io(t){if(!t)return Io(m.globalOpt.font??Lf);if(typeof t=="string"){let e=Ro(t),n=Oo(t);if(e)return e.data??e;if(n)return n.data??n;if(document.fonts.check(`64px ${t}`))return t;if(kn()<1)return null;throw new Error(`Font not found: ${t}`)}else if(t instanceof Ut)return t.data?t.data:t;return t}u(Io,"resolveFont");function Oo(t){return m.assets.fonts.get(t)??null}u(Oo,"getFont");function ku(t,e,n={}){let r=Ct(e),s=new FontFace(t,typeof e=="string"?`url(${r})`:r);return document.fonts.add(s),m.assets.fonts.add(t,s.load().catch(i=>{throw new Error(`Failed to load font from "${r}": ${i}`)}).then(i=>new Ns(i,n)))}u(ku,"loadFont");function qu(t,e,n,r){let s=t.width/e,i={},a=r.split("").entries();for(let[f,d]of a)i[d]=new ze(f%s*e,Math.floor(f/s)*n,e,n);return{tex:t,map:i,size:n}}u(qu,"makeFont");function Ro(t){return m.assets.bitmapFonts.get(t)??null}u(Ro,"getBitmapFont");function Fu(t,e,n,r,s={}){let i=Ct(e);return m.assets.bitmapFonts.add(t,As(i).then(a=>qu(On.fromImage(m.gfx.ggl,a,s),n,r,s.chars??Jl)))}u(Fu,"loadBitmapFont");function Nu(t,e){return e=Ct(e),m.assets.sprites.add(t,new Promise(async n=>{let r=typeof e=="string"?await ws(e):e,s=await Promise.all(r.frames.map(As)),i=document.createElement("canvas");i.width=r.width,i.height=r.height*r.frames.length;let a=i.getContext("2d");if(!a)throw new Error("Failed to create canvas context");s.forEach((d,h)=>{a.drawImage(d,0,h*r.height)});let f=await vr(null,i,{sliceY:r.frames.length,anims:r.anims});n(f)}))}u(Nu,"loadPedit");var Lr,Sd=(Lr=class{constructor(e,n,r,s){q(this,"ctx");q(this,"glProgram");this.ctx=e,e.onDestroy(()=>this.free());let i=e.gl,a=i.createShader(i.VERTEX_SHADER),f=i.createShader(i.FRAGMENT_SHADER);if(!a||!f)throw new Error("Failed to create shader");i.shaderSource(a,n),i.shaderSource(f,r),i.compileShader(a),i.compileShader(f);let d=i.createProgram();if(this.glProgram=d,i.attachShader(d,a),i.attachShader(d,f),s.forEach((h,A)=>i.bindAttribLocation(d,A,h)),i.linkProgram(d),!i.getProgramParameter(d,i.LINK_STATUS)){let h=i.getShaderInfoLog(a);if(h)throw new Error("VERTEX SHADER "+h);let A=i.getShaderInfoLog(f);if(A)throw new Error("FRAGMENT SHADER "+A)}i.deleteShader(a),i.deleteShader(f)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(e){let n=this.ctx.gl;for(let r in e){let s=e[r],i=n.getUniformLocation(this.glProgram,r);if(typeof s=="number")n.uniform1f(i,s);else if(s instanceof nn)n.uniformMatrix4fv(i,!1,new Float32Array(s.m));else if(s instanceof ve)n.uniform3f(i,s.r,s.g,s.b);else if(s instanceof V)n.uniform2f(i,s.x,s.y);else if(Array.isArray(s))s[0],Jf(s)?n.uniform1fv(i,s):Xf(s)?n.uniform2fv(i,s.map(a=>[a.x,a.y]).flat()):Yf(s)&&n.uniform3fv(i,s.map(a=>[a.r,a.g,a.b]).flat());else throw new Error("Unsupported uniform data type")}}free(){this.ctx.gl.deleteProgram(this.glProgram)}},u(Lr,"Shader"),Lr);function yi(t,e=Ui,n=_i){let r=$f.replace("{{user}}",e??Ui),s=Vf.replace("{{user}}",n??_i);try{return new Sd(t,r,s,wo.map(i=>i.name))}catch(i){let a=/(?<type>^\w+) SHADER ERROR: 0:(?<line>\d+): (?<msg>.+)/,f=Zf(i).match(a);if(!(f!=null&&f.groups))throw i;let d=Number(f.groups.line)-14,h=f.groups.msg.trim(),A=f.groups.type.toLowerCase();throw new Error(`${A} shader line ${d}: ${h}`)}}u(yi,"makeShader");function Lu(t){if(!t)return m.gfx.defShader;if(typeof t=="string"){let e=Mo(t);if(e)return e.data??e;if(kn()<1)return null;throw new Error(`Shader not found: ${t}`)}else if(t instanceof Ut)return t.data?t.data:t;return t}u(Lu,"resolveShader");function Mo(t){return m.assets.shaders.get(t)??null}u(Mo,"getShader");function Uu(t,e,n){return m.assets.shaders.addLoaded(t,yi(m.gfx.ggl,e,n))}u(Uu,"loadShader");function _u(t,e,n){e=Ct(e),n=Ct(n);let r=u(i=>i?Ru(i):Promise.resolve(null),"resolveUrl"),s=Promise.all([r(e),r(n)]).then(([i,a])=>yi(m.gfx.ggl,i,a));return m.assets.shaders.add(t,s)}u(_u,"loadShaderURL");var hn,hs=(hn=class{constructor(e){q(this,"buf");this.buf=e}static fromArrayBuffer(e){return new Promise((n,r)=>m.audio.ctx.decodeAudioData(e,n,r)).then(n=>new hn(n))}static fromURL(e){return iu(e)?hn.fromArrayBuffer(ru(e)):Mu(e).then(n=>hn.fromArrayBuffer(n))}},u(hn,"SoundData"),hn);function ju(t){if(typeof t=="string"){let e=To(t);if(e)return e;if(kn()<1)return null;throw new Error(`Sound not found: ${t}`)}else{if(t instanceof hs)return Ut.loaded(t);if(t instanceof Ut)return t;throw new Error(`Invalid sound: ${t}`)}}u(ju,"resolveSound");function To(t){return m.assets.sounds.get(t)??null}u(To,"getSound");function $u(t,e){return e=Ct(e),m.assets.sounds.add(t,typeof e=="string"?hs.fromURL(e):hs.fromArrayBuffer(e))}u($u,"loadSound");function Vu(t,e){let n=Ct(e),r=new Audio(n);return r.preload="auto",m.assets.music[t]=n}u(Vu,"loadMusic");function Co(t,e){return t=Ct(t),Gs(typeof e=="string"?new Promise((n,r)=>{ws(e).then(s=>{Co(t,s).then(n).catch(r)})}):qn.from(t).then(n=>{let r={};for(let s in e){let i=e[s],a=n.frames[0],f=2048*a.w,d=2048*a.h,h=i.frames?i.frames.map(y=>new ze(a.x+(i.x+y.x)/f*a.w,a.y+(i.y+y.y)/d*a.h,y.w/f*a.w,y.h/d*a.h)):So(i.sliceX||1,i.sliceY||1,a.x+i.x/f*a.w,a.y+i.y/d*a.h,i.width/f*a.w,i.height/d*a.h),A=new qn(n.tex,h,i.anims);m.assets.sprites.addLoaded(s,A),r[s]=A}return r}))}u(Co,"loadSpriteAtlas");function mn(t,e,n=!1,r,s,i={}){let a=r??m.gfx.defTex,f=s??m.gfx.defShader,d=Lu(f);if(!d||d instanceof Ut)return;let h=m.gfx.fixed||n?m.gfx.transform:m.game.cam.transform.mult(m.gfx.transform),A=[];for(let y of t){let g=bu(h.multVec2(y.pos));A.push(g.x,g.y,y.uv.x,y.uv.y,y.color.r/255,y.color.g/255,y.color.b/255,y.opacity)}m.gfx.renderer.push(m.gfx.ggl.gl.TRIANGLES,A,e,d,a,i)}u(mn,"drawRaw");function fn(t){if(!t.pts)throw new Error('drawPolygon() requires property "pts".');let e=t.pts.length;if(!(e<3)){if(Ot(),He(t.pos),Kr(t.scale),er(t.angle),He(t.offset),t.fill!==!1){let n=t.color??ve.WHITE,r=t.pts.map((i,a)=>({pos:new V(i.x,i.y),uv:t.uv?t.uv[a]:new V(0,0),color:t.colors&&t.colors[a]?t.colors[a].mult(n):n,opacity:t.opacity??1})),s;t.triangulate?s=yo(t.pts).map(i=>i.map(a=>t.pts.indexOf(a))).flat():s=[...Array(e-2).keys()].map(i=>[0,i+1,i+2]).flat(),mn(r,t.indices??s,t.fixed,t.uv?t.tex:m.gfx.defTex,t.shader,t.uniform??void 0)}t.outline&&wi({pts:[...t.pts,t.pts[0]],radius:t.radius,width:t.outline.width,color:t.outline.color,join:t.outline.join,uniform:t.uniform,fixed:t.fixed,opacity:t.opacity??t.outline.opacity}),bt()}}u(fn,"drawPolygon");function Po(t){if(t.radiusX===void 0||t.radiusY===void 0)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(t.radiusX===0||t.radiusY===0)return;let e=t.start??0,n=t.end??360,r=rr(t.anchor??"center").scale(new V(-t.radiusX,-t.radiusY)),s=Ar(r,t.radiusX,t.radiusY,e,n,t.resolution);s.unshift(r);let i=Object.assign({},t,{pts:s,radius:0,...t.gradient?{colors:[t.gradient[0],...Array(s.length-1).fill(t.gradient[1])]}:{}});if(n-e>=360&&t.outline){t.fill!==!1&&fn(Object.assign({},i,{outline:null})),fn(Object.assign({},i,{pts:s.slice(1),fill:!1}));return}fn(i)}u(Po,"drawEllipse");function sr(t){if(typeof t.radius!="number")throw new Error('drawCircle() requires property "radius".');t.radius!==0&&Po(Object.assign({},t,{radiusX:t.radius,radiusY:t.radius,angle:0}))}u(sr,"drawCircle");function xr(t){let{p1:e,p2:n}=t;if(!e||!n)throw new Error('drawLine() requires properties "p1" and "p2".');let r=t.width||1,s=n.sub(e).unit().normal().scale(r*.5),i=[e.sub(s),e.add(s),n.add(s),n.sub(s)].map(a=>({pos:new V(a.x,a.y),uv:new V(0),color:t.color??ve.WHITE,opacity:t.opacity??1}));mn(i,[0,1,3,1,2,3],t.fixed,m.gfx.defTex,t.shader,t.uniform??void 0)}u(xr,"drawLine");function Hu(t){let e=t.pts,n=[],r=(t.width||1)*.5,s=e[0]===e[e.length-1]||e[0].eq(e[e.length-1]),i=t.pos||L(0,0),a;s?a=e[0].sub(e[e.length-2]):a=e[1].sub(e[0]);let f=a.len(),d=a.normal().scale(-r/f),h,A=e[0];if(!s)switch(t.cap){case"square":{let E=a.scale(-r/f);n.push(A.add(E).add(d)),n.push(A.add(E).sub(d));break}case"round":{let E=Math.max(r,10),C=Math.PI/E,v=d.scale(-1),S=Math.cos(C),j=Math.sin(C);for(let W=0;W<E;W++)n.push(A),n.push(A.sub(v)),v=L(v.x*S-v.y*j,v.x*j+v.y*S)}}for(let E=1;E<e.length;E++){if(A===e[E]||A.eq(e[E]))continue;h=A,A=e[E];let C=A.sub(h),v=C.len(),S=C.normal().scale(-r/v),j=a.cross(C);if(Math.abs(j)/(f*v)<.05){n.push(h.add(d)),n.push(h.sub(d)),a.dot(C)<0&&(n.push(h.sub(d)),n.push(h.add(d))),a=C,f=v,d=S;continue}let W=S.sub(d).cross(C)/j,ee=d.add(a.scale(W));j>0?(n.push(h.add(ee)),n.push(h.sub(d)),n.push(h.add(ee)),n.push(h.sub(S))):(n.push(h.add(d)),n.push(h.sub(ee)),n.push(h.add(S)),n.push(h.sub(ee))),a=C,f=v,d=S}if(!s)switch(n.push(A.add(d)),n.push(A.sub(d)),t.cap){case"square":{let E=a.scale(r/f);n.push(A.add(E).add(d)),n.push(A.add(E).sub(d));break}case"round":{let E=Math.max(r,10),C=Math.PI/E,v=d.scale(1),S=Math.cos(C),j=Math.sin(C);for(let W=0;W<E;W++)v=L(v.x*S-v.y*j,v.x*j+v.y*S),n.push(A),n.push(A.sub(v))}}if(n.length<4)return;let y=n.map(E=>({pos:i.add(E),uv:L(),color:t.color||ve.WHITE,opacity:t.opacity??1})),g=[],b=0;for(let E=0;E<n.length-2;E+=2)g[b++]=E+1,g[b++]=E,g[b++]=E+2,g[b++]=E+2,g[b++]=E+3,g[b++]=E+1;s&&(g[b++]=n.length-1,g[b++]=n.length-2,g[b++]=0,g[b++]=0,g[b++]=1,g[b++]=n.length-1),mn(y,g,t.fixed,m.gfx.defTex,t.shader,t.uniform??void 0)}u(Hu,"_drawLinesBevel");function zu(t){let e=t.pts,n=[],r=(t.width||1)*.5,s=e[0]===e[e.length-1]||e[0].eq(e[e.length-1]),i=t.pos||L(0,0),a;s?a=e[0].sub(e[e.length-2]):a=e[1].sub(e[0]);let f=a.len(),d=a.normal().scale(-r/f),h,A=e[0];if(!s)switch(t.cap){case"square":{let E=a.scale(-r/f);n.push(A.add(E).add(d)),n.push(A.add(E).sub(d));break}case"round":{let E=Math.max(r,10),C=Math.PI/E,v=d.scale(-1),S=Math.cos(C),j=Math.sin(C);for(let W=0;W<E;W++)n.push(A),n.push(A.sub(v)),v=L(v.x*S-v.y*j,v.x*j+v.y*S)}}for(let E=1;E<e.length;E++){if(A===e[E]||A.eq(e[E]))continue;h=A,A=e[E];let C=A.sub(h),v=C.len(),S=C.normal().scale(-r/v),j=a.cross(C);if(Math.abs(j)/(f*v)<.05){n.push(h.add(d)),n.push(h.sub(d)),a.dot(C)<0&&(n.push(h.sub(d)),n.push(h.add(d))),a=C,f=v,d=S;continue}let W=S.sub(d).cross(C)/j,ee=d.add(a.scale(W));if(j>0){let re=h.add(ee),R=Math.max(r,10),D=Je(d.angleBetween(S)/R),N=d,Y=Math.cos(D),Q=Math.sin(D);for(let ie=0;ie<R;ie++)n.push(re),n.push(h.sub(N)),N=L(N.x*Y-N.y*Q,N.x*Q+N.y*Y)}else{let re=h.sub(ee),R=Math.max(r,10),D=Je(d.angleBetween(S)/R),N=d,Y=Math.cos(D),Q=Math.sin(D);for(let ie=0;ie<R;ie++)n.push(h.add(N)),n.push(re),N=L(N.x*Y-N.y*Q,N.x*Q+N.y*Y)}a=C,f=v,d=S}if(!s)switch(n.push(A.add(d)),n.push(A.sub(d)),t.cap){case"square":{let E=a.scale(r/f);n.push(A.add(E).add(d)),n.push(A.add(E).sub(d));break}case"round":{let E=Math.max(r,10),C=Math.PI/E,v=d.scale(1),S=Math.cos(C),j=Math.sin(C);for(let W=0;W<E;W++)v=L(v.x*S-v.y*j,v.x*j+v.y*S),n.push(A),n.push(A.sub(v))}}if(n.length<4)return;let y=n.map(E=>({pos:i.add(E),uv:L(),color:t.color||ve.WHITE,opacity:t.opacity??1})),g=[],b=0;for(let E=0;E<n.length-2;E+=2)g[b++]=E+1,g[b++]=E,g[b++]=E+2,g[b++]=E+2,g[b++]=E+3,g[b++]=E+1;s&&(g[b++]=n.length-1,g[b++]=n.length-2,g[b++]=0,g[b++]=0,g[b++]=1,g[b++]=n.length-1),mn(y,g,t.fixed,m.gfx.defTex,t.shader,t.uniform??void 0)}u(zu,"_drawLinesRound");function Ku(t){let e=t.pts,n=[],r=(t.width||1)*.5,s=e[0]===e[e.length-1]||e[0].eq(e[e.length-1]),i=t.pos||L(0,0),a;s?a=e[0].sub(e[e.length-2]):a=e[1].sub(e[0]);let f=a.len(),d=a.normal().scale(-r/f),h,A=e[0];if(!s)switch(t.cap){case"square":{let E=a.scale(-r/f);n.push(A.add(E).add(d)),n.push(A.add(E).sub(d));break}case"round":{let E=Math.max(r,10),C=Math.PI/E,v=d.scale(-1),S=Math.cos(C),j=Math.sin(C);for(let W=0;W<E;W++)n.push(A),n.push(A.sub(v)),v=L(v.x*S-v.y*j,v.x*j+v.y*S)}}for(let E=1;E<e.length;E++){if(A===e[E]||A.eq(e[E]))continue;h=A,A=e[E];let C=A.sub(h),v=C.len(),S=C.normal().scale(-r/v),j=a.cross(C);if(Math.abs(j)/(f*v)<.05){n.push(h.add(d)),n.push(h.sub(d)),a.dot(C)<0&&(n.push(h.sub(d)),n.push(h.add(d))),a=C,f=v,d=S;continue}let W=S.sub(d).cross(C)/j,ee=d.add(a.scale(W));n.push(h.add(ee)),n.push(h.sub(ee)),a=C,f=v,d=S}if(!s)switch(n.push(A.add(d)),n.push(A.sub(d)),t.cap){case"square":{let E=a.scale(r/f);n.push(A.add(E).add(d)),n.push(A.add(E).sub(d));break}case"round":{let E=Math.max(r,10),C=Math.PI/E,v=d.scale(1),S=Math.cos(C),j=Math.sin(C);for(let W=0;W<E;W++)v=L(v.x*S-v.y*j,v.x*j+v.y*S),n.push(A),n.push(A.sub(v))}}if(n.length<4)return;let y=n.map(E=>({pos:i.add(E),uv:L(),color:t.color||ve.WHITE,opacity:t.opacity??1})),g=[],b=0;for(let E=0;E<n.length-2;E+=2)g[b++]=E+1,g[b++]=E,g[b++]=E+2,g[b++]=E+2,g[b++]=E+3,g[b++]=E+1;s&&(g[b++]=n.length-1,g[b++]=n.length-2,g[b++]=0,g[b++]=0,g[b++]=1,g[b++]=n.length-1),mn(y,g,t.fixed,m.gfx.defTex,t.shader,t.uniform??void 0)}u(Ku,"_drawLinesMiter");function wi(t){let e=t.pts,n=t.width??1;if(!e)throw new Error('drawLines() requires property "pts".');if(!(e.length<2)){if(e.length>2)switch(t.join){case"bevel":return Hu(t);case"round":return zu(t);case"miter":return Ku(t)}if(t.radius&&e.length>=3){xr(Object.assign({},t,{p1:e[0],p2:e[1]}));for(let r=1;r<e.length-2;r++){let s=e[r],i=e[r+1];xr(Object.assign({},t,{p1:s,p2:i}))}xr(Object.assign({},t,{p1:e[e.length-2],p2:e[e.length-1]}))}else for(let r=0;r<e.length-1;r++)xr(Object.assign({},t,{p1:e[r],p2:e[r+1]})),t.join!=="none"&&sr(Object.assign({},t,{pos:e[r],radius:n/2}))}}u(wi,"drawLines");function Do(t,e){let n=e.segments??16,r=[];for(let s=0;s<=n;s++)r.push(t(s/n));wi({pts:r,width:e.width||1,pos:e.pos,color:e.color,opacity:e.opacity})}u(Do,"drawCurve");function Gu(t){Do(e=>hi(t.pt1,t.pt2,t.pt3,t.pt4,e),t)}u(Gu,"drawBezier");var Zn,On=(Zn=class{constructor(e,n,r,s={}){q(this,"ctx");q(this,"src",null);q(this,"glTex");q(this,"width");q(this,"height");this.ctx=e;let i=e.gl,a=e.gl.createTexture();if(!a)throw new Error("Failed to create texture");this.glTex=a,e.onDestroy(()=>this.free()),this.width=n,this.height=r;let f={linear:i.LINEAR,nearest:i.NEAREST}[s.filter??e.opts.texFilter??"nearest"],d={repeat:i.REPEAT,clampToEdge:i.CLAMP_TO_EDGE}[s.wrap??"clampToEdge"];this.bind(),n&&r&&i.texImage2D(i.TEXTURE_2D,0,i.RGBA,n,r,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,f),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,f),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,d),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,d),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.unbind()}static fromImage(e,n,r={}){let s=new Zn(e,n.width,n.height,r);return s.update(n),s.src=n,s}update(e,n=0,r=0){let s=this.ctx.gl;this.bind(),s.texSubImage2D(s.TEXTURE_2D,0,n,r,s.RGBA,s.UNSIGNED_BYTE,e),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},u(Zn,"Texture"),Zn),Ur,Ws=(Ur=class{constructor(e,n,r,s={}){q(this,"ctx");q(this,"tex");q(this,"glFramebuffer");q(this,"glRenderbuffer");this.ctx=e;let i=e.gl;e.onDestroy(()=>this.free()),this.tex=new On(e,n,r,s);let a=i.createFramebuffer(),f=i.createRenderbuffer();if(!a||!f)throw new Error("Failed to create framebuffer");this.glFramebuffer=a,this.glRenderbuffer=f,this.bind(),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,n,r),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.tex.glTex,0),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let e=this.ctx.gl,n=new Uint8ClampedArray(this.width*this.height*4);this.bind(),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,n),this.unbind();let r=this.width*4,s=new Uint8Array(r);for(let i=0;i<(this.height/2|0);i++){let a=i*r,f=(this.height-i-1)*r;s.set(n.subarray(a,a+r)),n.copyWithin(a,f,f+r),n.set(s,f)}return new ImageData(n,this.width,this.height)}toDataURL(){let e=document.createElement("canvas"),n=e.getContext("2d");if(e.width=this.width,e.height=this.height,!n)throw new Error("Failed to get 2d context");return n.putImageData(this.toImageData(),0,0),e.toDataURL()}clear(){let e=this.ctx.gl;e.clear(e.COLOR_BUFFER_BIT)}draw(e){this.bind(),e(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let e=this.ctx.gl;e.deleteFramebuffer(this.glFramebuffer),e.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}},u(Ur,"FrameBuffer"),Ur),_r,Id=(_r=class{constructor(e,n,r,s){q(this,"ctx");q(this,"glVBuf");q(this,"glIBuf");q(this,"vqueue",[]);q(this,"iqueue",[]);q(this,"stride");q(this,"maxVertices");q(this,"maxIndices");q(this,"vertexFormat");q(this,"numDraws",0);q(this,"curPrimitive",null);q(this,"curTex",null);q(this,"curShader",null);q(this,"curUniform",{});let i=e.gl;this.vertexFormat=n,this.ctx=e,this.stride=n.reduce((f,d)=>f+d.size,0),this.maxVertices=r,this.maxIndices=s;let a=i.createBuffer();if(!a)throw new Error("Failed to create vertex buffer");this.glVBuf=a,e.pushArrayBuffer(this.glVBuf),i.bufferData(i.ARRAY_BUFFER,r*4,i.DYNAMIC_DRAW),e.popArrayBuffer(),this.glIBuf=i.createBuffer(),e.pushElementArrayBuffer(this.glIBuf),i.bufferData(i.ELEMENT_ARRAY_BUFFER,s*4,i.DYNAMIC_DRAW),e.popElementArrayBuffer()}push(e,n,r,s,i=null,a={}){(e!==this.curPrimitive||i!==this.curTex||s!==this.curShader||!gi(this.curUniform,a)||this.vqueue.length+n.length*this.stride>this.maxVertices||this.iqueue.length+r.length>this.maxIndices)&&this.flush();let f=this.vqueue.length/this.stride;for(let d of n)this.vqueue.push(d);for(let d of r)this.iqueue.push(d+f);this.curPrimitive=e,this.curShader=s,this.curTex=i,this.curUniform=a}flush(){var n,r;if(!this.curPrimitive||!this.curShader||this.vqueue.length===0||this.iqueue.length===0)return;let e=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),e.bufferSubData(e.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),(n=this.curTex)==null||n.bind(),e.drawElements(this.curPrimitive,this.iqueue.length,e.UNSIGNED_SHORT,0),(r=this.curTex)==null||r.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let e=this.ctx.gl;e.deleteBuffer(this.glVBuf),e.deleteBuffer(this.glIBuf)}},u(_r,"BatchRenderer"),_r);function En(t){let e=[],n=u(i=>{e.push(i),t(i)},"push"),r=u(()=>{e.pop(),t(s()??null)},"pop"),s=u(()=>e[e.length-1],"cur");return[n,r,s]}u(En,"genStack");function Wu(t,e={}){let n=[];function r(re){n.push(re)}u(r,"onDestroy");function s(){n.forEach(R=>R());let re=t.getExtension("WEBGL_lose_context");re&&re.loseContext()}u(s,"destroy");let i=null;function a(re){if(gi(re,i))return;i=re;let R=re.reduce((D,N)=>D+N.size,0);re.reduce((D,N,Y)=>(t.vertexAttribPointer(Y,N.size,t.FLOAT,!1,R*4,D),t.enableVertexAttribArray(Y),D+N.size*4),0)}u(a,"setVertexFormat");let[f,d]=En(re=>t.bindTexture(t.TEXTURE_2D,re)),[h,A]=En(re=>t.bindBuffer(t.ARRAY_BUFFER,re)),[y,g]=En(re=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,re)),[b,E]=En(re=>t.bindFramebuffer(t.FRAMEBUFFER,re)),[C,v]=En(re=>t.bindRenderbuffer(t.RENDERBUFFER,re)),[S,j]=En(re=>{if(!re)return;let{x:R,y:D,w:N,h:Y}=re;t.viewport(R,D,N,Y)}),[W,ee]=En(re=>t.useProgram(re));return S({x:0,y:0,w:t.drawingBufferWidth,h:t.drawingBufferHeight}),{gl:t,opts:e,onDestroy:r,destroy:s,pushTexture2D:f,popTexture2D:d,pushArrayBuffer:h,popArrayBuffer:A,pushElementArrayBuffer:y,popElementArrayBuffer:g,pushFramebuffer:b,popFramebuffer:E,pushRenderbuffer:C,popRenderbuffer:v,pushViewport:S,popViewport:j,pushProgram:W,popProgram:ee,setVertexFormat:a}}u(Wu,"initGfx");var Di={};function Hi(t,e){if(e.override){Object.assign(t,e);return}e.pos&&(t.pos=t.pos.add(e.pos)),e.scale&&(t.scale=t.scale.scale(L(e.scale))),e.angle&&(t.angle+=e.angle),e.color&&t.ch.length===1&&(t.color=t.color.mult(e.color)),e.opacity!=null&&(t.opacity*=e.opacity)}u(Hi,"applyCharTransform");function Ys(t){let e={},n="",r=[],s=String(t),i=u(a=>{r.length>0&&(e[n.length]=r.slice()),n+=a},"emit");for(;s!=="";){if(s[0]==="\\"){if(s.length===1)throw new Error("Styled text error: \\ at end of string");i(s[1]),s=s.slice(2);continue}if(s[0]==="["){let a=/^\[(\/)?(\w+?)\]/.exec(s);if(!a){i(s[0]),s=s.slice(1);continue}let[f,d,h]=a;if(d!==void 0){let A=r.pop();if(A!==h)throw A!==void 0?new Error(`Styled text error: mismatched tags. Expected [/${A}], got [/${h}]`):new Error(`Styled text error: stray end tag [/${h}]`)}else r.push(h);s=s.slice(f.length);continue}i(s[0]),s=s.slice(1)}if(r.length>0)throw new Error(`Styled text error: unclosed tags ${r}`);return{charStyleMap:e,text:n}}u(Ys,"compileStyledText");function Fn(t){var W,ee,re;if(t.text===void 0)throw new Error('formatText() requires property "text".');let e=Io(t.font);if(!t.text||t.text===""||e instanceof Ut||!e)return{width:0,height:0,chars:[],opt:t,renderedText:""};let{charStyleMap:n,text:r}=Ys(t.text+""),s=au(r);if(e instanceof Ns||typeof e=="string"){let R=e instanceof Ns?e.fontface.family:e,D=e instanceof Ns?{outline:e.outline,filter:e.filter}:{outline:null,filter:Li},N=Di[R]??{font:{tex:new On(m.gfx.ggl,2048,2048,{filter:D.filter}),map:{},size:64},cursor:new V(0),maxHeight:0,outline:D.outline};Di[R]||(Di[R]=N),e=N.font;for(let Y of s)if(!N.font.map[Y]){let Q=m.fontCacheC2d;if(!Q)throw new Error("fontCacheC2d is not defined.");if(!m.fontCacheCanvas)throw new Error("fontCacheCanvas is not defined.");Q.clearRect(0,0,m.fontCacheCanvas.width,m.fontCacheCanvas.height),Q.font=`${e.size}px ${R}`,Q.textBaseline="top",Q.textAlign="left",Q.fillStyle="#ffffff";let ie=Q.measureText(Y),fe=Math.ceil(ie.width);if(!fe)continue;let M=Math.ceil(Math.abs(ie.actualBoundingBoxAscent))+Math.ceil(Math.abs(ie.actualBoundingBoxDescent));N.outline&&N.outline.width&&N.outline.color&&(Q.lineJoin="round",Q.lineWidth=N.outline.width*2,Q.strokeStyle=N.outline.color.toHex(),Q.strokeText(Y,N.outline.width,N.outline.width),fe+=N.outline.width*2,M+=N.outline.width*3),Q.fillText(Y,((W=N.outline)==null?void 0:W.width)??0,((ee=N.outline)==null?void 0:ee.width)??0);let K=Q.getImageData(0,0,fe,M);if(N.cursor.x+fe>2048&&(N.cursor.x=0,N.cursor.y+=N.maxHeight,N.maxHeight=0,N.cursor.y>2048))throw new Error("Font atlas exceeds character limit");e.tex.update(K,N.cursor.x,N.cursor.y),e.map[Y]=new ze(N.cursor.x,N.cursor.y,fe,M),N.cursor.x+=fe+1,N.maxHeight=Math.max(N.maxHeight,M)}}let i=t.size||e.size,a=L(t.scale??1).scale(i/e.size),f=t.lineSpacing??0,d=t.letterSpacing??0,h=0,A=0,y=0,g=[],b=[],E=0,C=null,v=0,S;for(;E<s.length;){let R=s[E];if(R===`
`)y+=i+f,g.push({width:h-d,chars:b}),C=null,v=0,h=0,b=[],S=void 0;else{let D=e.map[R];if(D){let N=D.w*a.x;t.width&&h+N>t.width&&(y+=i+f,C!=null&&(E-=b.length-C,R=s[E],D=e.map[R],N=D.w*a.x,b=b.slice(0,C-1),h=v),C=null,v=0,g.push({width:h-d,chars:b}),h=S??0,b=[]),b.push({tex:e.tex,width:D.w,height:D.h,quad:new ze(D.x/e.tex.width,D.y/e.tex.height,D.w/e.tex.width,D.h/e.tex.height),ch:R,pos:new V(h,y),opacity:t.opacity??1,color:t.color??ve.WHITE,scale:L(a),angle:0}),R===" "&&(C=b.length,v=h),t.indentAll&&S===void 0&&/\S/.test(R)&&(S=h),h+=N,A=Math.max(A,h),h+=d}}E++}g.push({width:h-d,chars:b}),y+=i,t.width&&(A=t.width);let j=[];for(let R=0;R<g.length;R++){let D=(A-g[R].width)*yu(t.align??"left");for(let N of g[R].chars){let Y=e.map[N.ch],Q=j.length+R;if(N.pos=N.pos.add(D,0).add(Y.w*a.x*.5,Y.h*a.y*.5),t.transform){let ie=typeof t.transform=="function"?t.transform(Q,N.ch):t.transform;ie&&Hi(N,ie)}if(n[Q]){let ie=n[Q];for(let fe of ie){let M=(re=t.styles)==null?void 0:re[fe],K=typeof M=="function"?M(Q,N.ch):M;K&&Hi(N,K)}}j.push(N)}}return{width:A,height:y,chars:j,opt:t,renderedText:r}}u(Fn,"formatText");function Gr(t){if(t.width===void 0||t.height===void 0)throw new Error('drawUVQuad() requires property "width" and "height".');if(t.width<=0||t.height<=0)return;let e=t.width,n=t.height,r=rr(t.anchor||fi).scale(new V(e,n).scale(-.5)),s=t.quad||new ze(0,0,1,1),i=t.color||Re(255,255,255),a=t.opacity??1,f=t.tex?.1/t.tex.width:0,d=t.tex?.1/t.tex.height:0,h=s.x+f,A=s.y+d,y=s.w-f*2,g=s.h-d*2;Ot(),He(t.pos),er(t.angle),Kr(t.scale),He(r),mn([{pos:new V(-e/2,n/2),uv:new V(t.flipX?h+y:h,t.flipY?A:A+g),color:i,opacity:a},{pos:new V(-e/2,-n/2),uv:new V(t.flipX?h+y:h,t.flipY?A+g:A),color:i,opacity:a},{pos:new V(e/2,-n/2),uv:new V(t.flipX?h:h+y,t.flipY?A+g:A),color:i,opacity:a},{pos:new V(e/2,n/2),uv:new V(t.flipX?h:h+y,t.flipY?A:A+g),color:i,opacity:a}],[0,1,3,1,2,3],t.fixed,t.tex,t.shader,t.uniform??void 0),bt()}u(Gr,"drawUVQuad");function Nn(t){Ot(),He(t.opt.pos),er(t.opt.angle),He(rr(t.opt.anchor??"topleft").add(1,1).scale(t.width,t.height).scale(-.5)),t.chars.forEach(e=>{Gr({tex:e.tex,width:e.width,height:e.height,pos:e.pos,scale:e.scale,angle:e.angle,color:e.color,opacity:e.opacity,quad:e.quad,anchor:"center",uniform:t.opt.uniform,shader:t.opt.shader,fixed:t.opt.fixed})}),bt()}u(Nn,"drawFormattedText");function Mt(t){if(t.width===void 0||t.height===void 0)throw new Error('drawRect() requires property "width" and "height".');if(t.width<=0||t.height<=0)return;let e=t.width,n=t.height,r=rr(t.anchor||fi).add(1,1).scale(new V(e,n).scale(-.5)),s=[new V(0,0),new V(e,0),new V(e,n),new V(0,n)];if(t.radius){let i=Math.min(e,n)/2,a=Array.isArray(t.radius)?t.radius.map(f=>Math.min(i,f)):new Array(4).fill(Math.min(i,t.radius));s=[new V(a[0],0),...a[1]?Ar(new V(e-a[1],a[1]),a[1],a[1],270,360):[L(e,0)],...a[2]?Ar(new V(e-a[2],n-a[2]),a[2],a[2],0,90):[L(e,n)],...a[3]?Ar(new V(a[3],n-a[3]),a[3],a[3],90,180):[L(0,n)],...a[0]?Ar(new V(a[0],a[0]),a[0],a[0],180,270):[]]}fn(Object.assign({},t,{offset:r,pts:s,...t.gradient?{colors:t.horizontal?[t.gradient[0],t.gradient[1],t.gradient[1],t.gradient[0]]:[t.gradient[0],t.gradient[0],t.gradient[1],t.gradient[1]]}:{}}))}u(Mt,"drawRect");function cn(t){Rt();let e=m.gfx.width,n=m.gfx.height;m.gfx.width=m.gfx.viewport.width,m.gfx.height=m.gfx.viewport.height,t(),Rt(),m.gfx.width=e,m.gfx.height=n}u(cn,"drawUnscaled");function zi(t,e){cn(()=>{let n=L(8);Ot(),He(t);let r=Fn({text:e,font:Vs,size:16,pos:n,color:Re(255,255,255),fixed:!0}),s=r.width+n.x*2,i=r.height+n.x*2;t.x+s>=st()&&He(L(-s,0)),t.y+i>=ot()&&He(L(0,-i)),Mt({width:s,height:i,color:Re(0,0,0),radius:4,opacity:.8,fixed:!0}),Nn(r),bt()})}u(zi,"drawInspectText");function Bo(t){if(!t.p1||!t.p2||!t.p3)throw new Error('drawTriangle() requires properties "p1", "p2" and "p3".');return fn(Object.assign({},t,{pts:[t.p1,t.p2,t.p3]}))}u(Bo,"drawTriangle");function Yu(){if(m.debug.inspect){let t=null;for(let e of m.game.root.get("*",{recursive:!0}))if(e.c("area")&&e.isHovering()){t=e;break}if(m.game.root.drawInspect(),t){let e=[],n=t.inspect();for(let r in n)n[r]?e.push(`${n[r]}`):e.push(`${r}`);zi(Iu(bo()),e.join(`
`))}zi(L(8),`FPS: ${m.debug.fps()}`)}m.debug.paused&&cn(()=>{Ot(),He(st(),0),He(-8,8);let t=32;Mt({width:t,height:t,anchor:"topright",color:Re(0,0,0),opacity:.8,radius:4,fixed:!0});for(let e=1;e<=2;e++)Mt({width:4,height:t*.6,anchor:"center",pos:L(-32/3*e,t*.5),color:Re(255,255,255),radius:2,fixed:!0});bt()}),m.debug.timeScale!==1&&cn(()=>{Ot(),He(st(),ot()),He(-8,-8);let t=8,e=Fn({text:m.debug.timeScale.toFixed(1),font:Vs,size:16,color:Re(255,255,255),pos:L(-8),anchor:"botright",fixed:!0});Mt({width:e.width+t*2+t*4,height:e.height+t*2,anchor:"botright",color:Re(0,0,0),opacity:.8,radius:4,fixed:!0});for(let n=0;n<2;n++){let r=m.debug.timeScale<1;Bo({p1:L(-e.width-t*(r?2:3.5),-8),p2:L(-e.width-t*(r?2:3.5),-8-e.height),p3:L(-e.width-t*(r?3.5:2),-8-e.height/2),pos:L(-n*t*1+(r?-8*.5:0),0),color:Re(255,255,255),fixed:!0})}Nn(e),bt()}),m.debug.curRecording&&cn(()=>{Ot(),He(0,ot()),He(24,-24),sr({radius:12,color:Re(255,0,0),opacity:no(0,1,m.app.time()*4),fixed:!0}),bt()}),m.debug.showLog&&m.game.logs.length>0&&cn(()=>{Ot(),He(0,ot()),He(8,-8);let t=8,e=[];for(let r of m.game.logs){let s="",i=r.msg instanceof Error?"error":"info";s+=`[time]${r.time.toFixed(2)}[/time]`,s+=" ",s+=`[${i}]${Xs(r.msg)}[/${i}]`,e.push(s)}m.game.logs=m.game.logs.filter(r=>m.app.time()-r.time<(m.globalOpt.logTime||4));let n=Fn({text:e.join(`
`),font:Vs,pos:L(t,-8),anchor:"botleft",size:16,width:st()*.6,lineSpacing:t/2,fixed:!0,styles:{time:{color:Re(127,127,127)},info:{color:Re(255,255,255)},error:{color:Re(255,0,127)}}});Mt({width:n.width+t*2,height:n.height+t*2,anchor:"botleft",color:Re(0,0,0),radius:4,opacity:.8,fixed:!0}),Nn(n),bt()})}u(Yu,"drawDebug");function Xs(t,e=!1,n=new Set){if(n.has(t))return"<recursive>";var r="",s;return e&&typeof t=="string"&&(t=JSON.stringify(t)),Array.isArray(t)&&(r=["[",t.map(i=>Xs(i,!0,n.union(new Set([t])))).join(", "),"]"].join(""),t=r),t===null?"null":(typeof t=="object"&&t.toString===Object.prototype.toString&&(t.constructor!==Object&&(r+=t.constructor.name+" "),r+=["{",(s=Object.getOwnPropertyNames(t).map(i=>`${/^\w+$/.test(i)?i:JSON.stringify(i)}: ${Xs(t[i],!0,n.union(new Set([t])))}`).join(", "))?` ${s} `:"","}"].join(""),t=r),String(t).replaceAll(new RegExp("(?<!\\\\)\\[","g"),"\\["))}u(Xs,"prettyDebug");function Xu(){let t=m.game.cam,e=V.fromAngle(tt(0,360)).scale(t.shake);t.shake=vt(t.shake,0,5*nt()),t.transform=new nn().translate(cs()).scale(t.scale).rotate(t.angle).translate((t.pos??cs()).scale(-1).add(e)),m.game.root.draw(),Rt()}u(Xu,"drawFrame");function Ju(){let t=kn();m.game.events.numListeners("loading")>0?m.game.events.trigger("loading",t):cn(()=>{let e=st()/2,n=24,r=L(st()/2,ot()/2).sub(L(e/2,n/2));Mt({pos:L(0),width:st(),height:ot(),color:Re(0,0,0)}),Mt({pos:r,width:e,height:n,fill:!1,outline:{width:4}}),Mt({pos:r,width:e*t,height:n})})}u(Ju,"drawLoadScreen");function ko(t,e,n){let r=m.gfx.ggl.gl;Rt(),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST),r.stencilFunc(r.NEVER,1,255),r.stencilOp(r.REPLACE,r.REPLACE,r.REPLACE),e(),Rt(),r.stencilFunc(n,1,255),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),t(),Rt(),r.disable(r.STENCIL_TEST)}u(ko,"drawStenciled");function Qu(t,e){let n=m.gfx.ggl.gl;ko(t,e,n.EQUAL)}u(Qu,"drawMasked");function fs(t){var i,a;if(!t.tex)throw new Error('drawTexture() requires property "tex".');let e=t.quad??new ze(0,0,1,1),n=t.tex.width*e.w,r=t.tex.height*e.h,s=new V(1);if(t.tiled){let f=rr(t.anchor||fi);(((i=t.pos)==null?void 0:i.x)||0)-(f.x+1)*.5*(t.width||n),(((a=t.pos)==null?void 0:a.y)||0)-(f.y+1)*.5*(t.height||r);let d=(t.width||n)/n,h=(t.height||r)/r,A=Math.floor(d),y=Math.floor(h),g=d-A,b=h-y,E=(A+g?1:0)*(y+b?1:0),C=new Array(E*6),v=new Array(E*4),S=0,j=u((W,ee,re,R,D)=>{C[S*6+0]=S*4+0,C[S*6+1]=S*4+1,C[S*6+2]=S*4+3,C[S*6+3]=S*4+1,C[S*6+4]=S*4+2,C[S*6+5]=S*4+3,v[S*4+0]={pos:new V(W-f.x,ee-f.y),uv:new V(D.x,D.y),color:t.color||ve.WHITE,opacity:t.opacity||1},v[S*4+1]={pos:new V(W+re-f.x,ee-f.y),uv:new V(D.x+D.w,D.y),color:t.color||ve.WHITE,opacity:t.opacity||1},v[S*4+2]={pos:new V(W+re-f.x,ee+R-f.y),uv:new V(D.x+D.w,D.y+D.h),color:t.color||ve.WHITE,opacity:t.opacity||1},v[S*4+3]={pos:new V(W-f.x,ee+R-f.y),uv:new V(D.x,D.y+D.h),color:t.color||ve.WHITE,opacity:t.opacity||1},S++},"addQuad");for(let W=0;W<y;W++){for(let ee=0;ee<A;ee++)j(ee*n,W*r,n,r,e);g&&j(A*n,W*r,n*g,r,new ze(e.x,e.y,e.w*g,e.h))}if(b){for(let W=0;W<A;W++)j(W*n,y*r,n,r*b,new ze(e.x,e.y,e.w,e.h*b));g&&j(A*n,y*r,n*g,r*b,new ze(e.x,e.y,e.w*g,e.h*b))}mn(v,C,t.fixed,t.tex,t.shader,t.uniform??void 0)}else t.width&&t.height?(s.x=t.width/n,s.y=t.height/r):t.width?(s.x=t.width/n,s.y=s.x):t.height&&(s.y=t.height/r,s.x=s.y),Gr(Object.assign({},t,{scale:s.scale(t.scale||new V(1)),tex:t.tex,quad:e,width:n,height:r}))}u(fs,"drawTexture");function Zu(t){if(!t.sprite)throw new Error('drawSprite() requires property "sprite"');let e=ss(t.sprite);if(!e||!e.data)return;let n=e.data.frames[t.frame??0];if(!n)throw new Error(`Frame not found: ${t.frame??0}`);fs(Object.assign({},t,{tex:e.data.tex,quad:n.scale(t.quad??new ze(0,0,1,1))}))}u(Zu,"drawSprite");function ec(t,e){let n=m.gfx.ggl.gl;ko(t,e,n.NOTEQUAL)}u(ec,"drawSubtracted");function Ki(t){Nn(Fn(t))}u(Ki,"drawText");var Od=u((t,e)=>{let n=yi(e,Ui,_i),r=t.pixelDensity??1,s=t.scale??1,{gl:i}=e,a=On.fromImage(e,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),f=t.width&&t.height?new Ws(e,t.width*r*s,t.height*r*s):new Ws(e,i.drawingBufferWidth,i.drawingBufferHeight),d=null,h=1;t.background&&(typeof t.background=="string"?d=Re(t.background):(d=Re(...t.background),h=t.background[3]??1),i.clearColor(d.r/255,d.g/255,d.b/255,h??1)),i.enable(i.BLEND),i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);let A=new Id(e,wo,_f,jf),y=On.fromImage(e,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{lastDrawCalls:0,ggl:e,defShader:n,defTex:a,frameBuffer:f,postShader:null,postShaderUniform:null,renderer:A,transform:new nn,transformStack:[],bgTex:y,bgColor:d,bgAlpha:h,width:t.width??i.drawingBufferWidth/r/s,height:t.height??i.drawingBufferHeight/r/s,viewport:{x:0,y:0,width:i.drawingBufferWidth,height:i.drawingBufferHeight},fixed:!1}},"initAppGfx");function qo(){let t=m.pixelDensity,e=m.gfx.ggl.gl.drawingBufferWidth/t,n=m.gfx.ggl.gl.drawingBufferHeight/t;if(m.globalOpt.letterbox){if(!m.globalOpt.width||!m.globalOpt.height)throw new Error("Letterboxing requires width and height defined.");let r=e/n,s=m.globalOpt.width/m.globalOpt.height;if(r>s){let i=n*s,a=(e-i)/2;m.gfx.viewport={x:a,y:0,width:i,height:n}}else{let i=e/s,a=(n-i)/2;m.gfx.viewport={x:0,y:a,width:e,height:i}}return}if(m.globalOpt.stretch&&(!m.globalOpt.width||!m.globalOpt.height))throw new Error("Stretching requires width and height defined.");m.gfx.viewport={x:0,y:0,width:e,height:n}}u(qo,"updateViewport");function Rn(t){return t.fixed?!0:t.parent?Rn(t.parent):!1}u(Rn,"isFixed");function Ln(t){return{color:t.color,opacity:t.opacity,anchor:t.anchor,outline:t.outline,shader:t.shader,uniform:t.uniform}}u(Ln,"getRenderProps");function tc(t,e={}){return{id:"circle",radius:t,draw(){sr(Object.assign(Ln(this),{radius:this.radius,fill:e.fill}))},renderArea(){return new Ue(new V(this.anchor?0:-this.radius),this.radius*2,this.radius*2)},inspect(){return`radius: ${Math.ceil(this.radius)}`}}}u(tc,"circle");function Fo(...t){return{id:"color",color:Re(...t),inspect(){return`color: ${this.color.toString()}`}}}u(Fo,"color");function nc(t){return{add(){this.canvas=t}}}u(nc,"drawon");function rc(t=1){let e,n=0,r=!1;return{require:["opacity"],add(){e=this.opacity,this.opacity=0},update(){r||(n+=nt(),this.opacity=zt(n,0,t,0,e),n>=t&&(this.opacity=e,r=!0))}}}u(rc,"fadeIn");function sc(t="intersect"){return{id:"mask",mask:t}}u(sc,"mask");function No(t){return{id:"opacity",opacity:t??1,fadeIn(e=1,n=m.k.easings.linear){return m.game.root.tween(0,this.opacity,e,r=>this.opacity=r,n)},fadeOut(e=1,n=m.k.easings.linear){return m.game.root.tween(this.opacity,0,e,r=>this.opacity=r,n)},inspect(){return`opacity: ${Hs(this.opacity,1)}`}}}u(No,"opacity");function ic(t=1,e=Re(0,0,0),n=1,r="miter",s=10,i="butt"){return{id:"outline",outline:{width:t,color:e,opacity:n,join:r,miterLimit:s,cap:i},inspect(){return`outline: ${this.outline.width}px, ${this.outline.color}`}}}u(ic,"outline");var jr,Rd=(jr=class{constructor(){q(this,"pos",L(0));q(this,"vel",L(0));q(this,"acc",L(0));q(this,"angle",0);q(this,"angularVelocity",0);q(this,"damping",0);q(this,"t");q(this,"lt",null);q(this,"gc");this.t=0,this.gc=!0}get progress(){return this.lt?this.t/this.lt:this.t}},u(jr,"Particle"),jr);function oc(t,e){let n=e.lifetime,r=[],s=t.colors||[ve.WHITE],i=t.opacities||[1],a=t.quads||[new ze(0,0,1,1)],f=t.scales||[1],d=t.lifeTime,h=e.direction,A=e.spread,y=t.speed||[0,0],g=t.angle||[0,0],b=t.angularVelocity||[0,0],E=t.acceleration||[L(0),L(0)],C=t.damping||[0,0],v=[],S=new Array(t.max),j=0,W=0;for(let R=0;R<t.max;R++){v[R*6+0]=R*4+0,v[R*6+1]=R*4+1,v[R*6+2]=R*4+3,v[R*6+3]=R*4+1,v[R*6+4]=R*4+2,v[R*6+5]=R*4+3;for(let D=0;D<4;D++)S[R*4+D]={pos:new V(0,0),uv:new V(0,0),color:Re(255,255,255),opacity:1};r[R]=new Rd}let ee=new xt;function re(R=0){for(;R<t.max;){if(r[R].gc)return R;R++}return null}return u(re,"nextFree"),{id:"particles",emit(R){let D=0;for(let N=0;N<R;N++){if(D=re(D),D==null)return;let Y=tt(h-A,h+A),Q=V.fromAngle(Y).scale(tt(y[0],y[1])),ie=tt(g[0],g[1]),fe=tt(b[0],b[1]),M=L(tt(E[0].x,E[1].x),tt(E[0].y,E[1].y)),K=tt(C[0],C[1]),z=d?tt(d[0],d[1]):null,_=e.shape?e.shape.random():L(),$=r[D];$.lt=z,$.pos=_,$.vel=Q,$.acc=M,$.angle=ie,$.angularVelocity=fe,$.damping=K,$.angularVelocity=fe,$.gc=!1}j+=R},update(){if(n!==void 0&&n<=0)return;let R=nt();for(let D of r)if(!D.gc){if(D.t+=R,D.lt&&D.t>=D.lt){D.gc=!0,j--;continue}D.vel=D.vel.add(D.acc.scale(R)).scale(1-D.damping*R),D.pos=D.pos.add(D.vel.scale(R)),D.angle+=D.angularVelocity*R}for(n!==void 0&&(n-=R,n<=0&&ee.trigger()),W+=R;j<t.max&&e.rate&&W>e.rate;)this.emit(1),j++,W-=e.rate},draw(){if(!(n!==void 0&&n<=0)){for(let R=0;R<r.length;R++){let D=r[R];if(D.gc)continue;let N=D.progress,Y=Math.floor(D.progress*s.length),Q=Y<s.length-1?vt(s[Y],s[Y+1],zt(N,Y/s.length,(Y+1)/s.length,0,1)):s[Y],ie=Math.floor(D.progress*i.length),fe=ie<i.length-1?vt(i[ie],i[ie+1],zt(N,ie/i.length,(ie+1)/i.length,0,1)):i[ie],M=Math.floor(D.progress*a.length),K=a[M],z=Math.floor(D.progress*f.length),_=f[z],$=Math.cos(D.angle*Math.PI/180),te=Math.sin(D.angle*Math.PI/180),he=(t.texture?t.texture.width:10)*K.w/2,oe=(t.texture?t.texture.height:10)*K.h/2,ye=R*4,le=S[ye];le.pos.x=D.pos.x+-he*_*$- -oe*_*te,le.pos.y=D.pos.y+-he*_*te+-oe*_*$,le.uv.x=K.x,le.uv.y=K.y,le.color.r=Q.r,le.color.g=Q.g,le.color.b=Q.b,le.opacity=fe,le=S[ye+1],le.pos.x=D.pos.x+he*_*$- -oe*_*te,le.pos.y=D.pos.y+he*_*te+-oe*_*$,le.uv.x=K.x+K.w,le.uv.y=K.y,le.color.r=Q.r,le.color.g=Q.g,le.color.b=Q.b,le.opacity=fe,le=S[ye+2],le.pos.x=D.pos.x+he*_*$-oe*_*te,le.pos.y=D.pos.y+he*_*te+oe*_*$,le.uv.x=K.x+K.w,le.uv.y=K.y+K.h,le.color.r=Q.r,le.color.g=Q.g,le.color.b=Q.b,le.opacity=fe,le=S[ye+3],le.pos.x=D.pos.x+-he*_*$-oe*_*te,le.pos.y=D.pos.y+-he*_*te+oe*_*$,le.uv.x=K.x,le.uv.y=K.y+K.h,le.color.r=Q.r,le.color.g=Q.g,le.color.b=Q.b,le.opacity=fe}mn(S,v,this.fixed,t.texture,this.shader,this.uniform)}},onEnd(R){return ee.add(R)},inspect(){return`count: ${j}/${t.max}`}}}u(oc,"particles");function ac(t,e={}){if(t.length<3)throw new Error(`Polygon's need more than two points, ${t.length} points provided`);return{id:"polygon",pts:t,colors:e.colors,uv:e.uv,tex:e.tex,radius:e.radius,draw(){fn(Object.assign(Ln(this),{pts:this.pts,colors:this.colors,uv:this.uv,tex:this.tex,radius:this.radius,fill:e.fill,triangulate:e.triangulate}))},renderArea(){return new Et(this.pts)},inspect(){return`polygon: ${this.pts.map(n=>`[${n.x},${n.y}]`).join(",")}`}}}u(ac,"polygon");function Lo(t,e,n){let r;return m.game.root.get("area").forEach(s=>{if(n&&n.some(a=>s.is(a)))return;let i=s.worldArea().raycast(t,e);i&&(r?i.fraction<r.fraction&&(r=i,r.object=s):(r=i,r.object=s))}),r}u(Lo,"raycast");function Uo(t,e,n={}){return{id:"rect",width:t,height:e,radius:n.radius||0,draw(){Mt(Object.assign(Ln(this),{width:this.width,height:this.height,radius:this.radius,fill:n.fill}))},renderArea(){return new Ue(L(0),this.width,this.height)},inspect(){return`rect: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)}h)`}}}u(Uo,"rect");function lc(t,e){return{id:"shader",shader:t,...typeof e=="function"?{uniform:e(),update(){this.uniform=e()}}:{uniform:e},inspect(){return`shader: ${t}`}}}u(lc,"shader");function uc(t,e){if(!e.tileWidth||!e.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let n=m.game.root.add([ds(e.pos??L(0))]),r=t.length,s=0,i=null,a=null,f=null,d=null,h=u(R=>R.x+R.y*s,"tile2Hash"),A=u(R=>L(Math.floor(R%s),Math.floor(R/s)),"hash2Tile"),y=u(()=>{i=[];for(let R of n.children)g(R)},"createSpatialMap"),g=u(R=>{let D=h(R.tilePos);i[D]?i[D].push(R):i[D]=[R]},"insertIntoSpatialMap"),b=u(R=>{let D=h(R.tilePos);if(i[D]){let N=i[D].indexOf(R);N>=0&&i[D].splice(N,1)}},"removeFromSpatialMap"),E=u(()=>{let R=!1;for(let D of n.children){let N=n.pos2Tile(D.pos);(D.tilePos.x!=N.x||D.tilePos.y!=N.y)&&(R=!0,b(D),D.tilePos.x=N.x,D.tilePos.y=N.y,g(D))}R&&n.trigger("spatialMapChanged")},"updateSpatialMap"),C=u(()=>{let R=n.getSpatialMap(),D=n.numRows()*n.numColumns();a?a.length=D:a=new Array(D),a.fill(1,0,D);for(let N=0;N<R.length;N++){let Y=R[N];if(Y){let Q=0;for(let ie of Y)if(ie.isObstacle){Q=1/0;break}else Q+=ie.cost;a[N]=Q||1}}},"createCostMap"),v=u(()=>{let R=n.getSpatialMap(),D=n.numRows()*n.numColumns();f?f.length=D:f=new Array(D),f.fill(15,0,D);for(let N=0;N<R.length;N++){let Y=R[N];if(Y){let Q=Y.length,ie=15;for(let fe=0;fe<Q;fe++)ie|=Y[fe].edgeMask;f[N]=ie}}},"createEdgeMap"),S=u(()=>{let R=n.numRows()*n.numColumns(),D=u((Y,Q)=>{let ie=[];for(ie.push(Y);ie.length>0;){let fe=ie.pop();ee(fe).forEach(M=>{d[M]<0&&(d[M]=Q,ie.push(M))})}},"traverse");d?d.length=R:d=new Array(R),d.fill(-1,0,R);let N=0;for(let Y=0;Y<a.length;Y++){if(d[Y]>=0){N++;continue}D(Y,N),N++}},"createConnectivityMap"),j=u((R,D)=>a[D],"getCost"),W=u((R,D)=>{let N=A(R),Y=A(D);return N.dist(Y)},"getHeuristic"),ee=u((R,D)=>{let N=[],Y=Math.floor(R%s),Q=Y>0&&f[R]&1&&a[R-1]!==1/0,ie=R>=s&&f[R]&2&&a[R-s]!==1/0,fe=Y<s-1&&f[R]&4&&a[R+1]!==1/0,M=R<s*r-s-1&&f[R]&8&&a[R+s]!==1/0;return D?(Q&&(ie&&N.push(R-s-1),N.push(R-1),M&&N.push(R+s-1)),ie&&N.push(R-s),fe&&(ie&&N.push(R-s+1),N.push(R+1),M&&N.push(R+s+1)),M&&N.push(R+s)):(Q&&N.push(R-1),ie&&N.push(R-s),fe&&N.push(R+1),M&&N.push(R+s)),N},"getNeighbours"),re={id:"level",tileWidth(){return e.tileWidth},tileHeight(){return e.tileHeight},spawn(R,...D){let N=L(...D),Y=(()=>{if(typeof R=="string"){if(e.tiles[R]){if(typeof e.tiles[R]!="function")throw new Error("Level symbol def must be a function returning a component list");return e.tiles[R](N)}else if(e.wildcardTile)return e.wildcardTile(R,N)}else{if(Array.isArray(R))return R;throw new Error("Expected a symbol or a component list")}})();if(!Y)return null;let Q=!1,ie=!1;for(let M of Y)M.id==="tile"&&(ie=!0),M.id==="pos"&&(Q=!0);Q||Y.push(ds(this.tile2Pos(N))),ie||Y.push(ea());let fe=n.add(Y);return Q&&(fe.tilePosOffset=fe.pos.clone()),fe.tilePos=N,fe.transform=br(fe),i&&(g(fe),this.trigger("spatialMapChanged"),this.trigger("navigationMapInvalid")),fe},numColumns(){return s},numRows(){return r},levelWidth(){return s*this.tileWidth()},levelHeight(){return r*this.tileHeight()},tile2Pos(...R){return L(...R).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...R){let D=L(...R);return L(Math.floor(D.x/this.tileWidth()),Math.floor(D.y/this.tileHeight()))},getSpatialMap(){return i||y(),i},removeFromSpatialMap:b,insertIntoSpatialMap:g,onSpatialMapChanged(R){return this.on("spatialMapChanged",R)},onNavigationMapInvalid(R){return this.on("navigationMapInvalid",R)},getAt(R){i||y();let D=h(R);return i[D]||[]},raycast(R,D){let N=this.toWorld(R),Y=this.toWorld(R.add(D)).sub(N),Q=1/this.tileWidth(),ie=R.scale(Q),fe=Rl(ie,D,M=>{let K=this.getAt(M);if(K.some(_=>_.isObstacle))return!0;let z=null;for(let _ of K)if(_.has("area")){let $=_.worldArea().raycast(N,Y);$&&(z?$.fraction<z.fraction&&(z=$,z.object=_):(z=$,z.object=_))}return z&&(z.point=this.fromWorld(z.point).scale(Q)),z||!1},64);return fe&&(fe.point=fe.point.scale(this.tileWidth())),fe},update(){i&&E()},invalidateNavigationMap(){a=null,f=null,d=null},onNavigationMapChanged(R){return this.on("navigationMapChanged",R)},getTilePath(R,D,N={}){var $;if(a||C(),f||v(),d||S(),R.x<0||R.x>=s||R.y<0||R.y>=r||D.x<0||D.x>=s||D.y<0||D.y>=r)return null;let Y=h(R),Q=h(D);if(a[Q]===1/0)return null;if(Y===Q)return[];if(d[Y]!=-1&&d[Y]!==d[Q])return null;let ie=new tu((te,he)=>te.cost<he.cost);ie.insert({cost:0,node:Y});let fe=new Map;fe.set(Y,Y);let M=new Map;for(M.set(Y,0);ie.length!==0;){let te=($=ie.remove())==null?void 0:$.node;if(te===Q)break;let he=ee(te,N.allowDiagonals);for(let oe of he){let ye=(M.get(te)||0)+j(te,oe)+W(oe,Q);(!M.has(oe)||ye<M.get(oe))&&(M.set(oe,ye),ie.insert({cost:ye,node:oe}),fe.set(oe,te))}}let K=[],z=Q,_=A(z);for(K.push(_);z!==Y;){let te=fe.get(z);if(te===void 0)throw new Error("Bug in pathfinding algorithm");z=te;let he=A(z);K.push(he)}return K.reverse()},getPath(R,D,N={}){let Y=this.tileWidth(),Q=this.tileHeight(),ie=this.getTilePath(this.pos2Tile(R),this.pos2Tile(D),N);return ie?[R,...ie.slice(1,-1).map(fe=>fe.scale(Y,Q).add(Y/2,Q/2)),D]:null}};return n.use(re),n.onNavigationMapInvalid(()=>{n.invalidateNavigationMap(),n.trigger("navigationMapChanged")}),t.forEach((R,D)=>{let N=R.split("");s=Math.max(N.length,s),N.forEach((Y,Q)=>{n.spawn(Y,L(Q,D))})}),n}u(uc,"addLevel");function St(t,e,n){return m.game.objEvents.registers[t]||(m.game.objEvents.registers[t]=new eu),m.game.objEvents.on(t,(r,...s)=>{r.is(e)&&n(r,...s)})}u(St,"on");var Md=u((t,e,...n)=>{for(let r of m.game.root.children)r.is(e)&&r.trigger(t,n)},"trigger"),Td=qe(t=>{let e=m.game.root.add([{fixedUpdate:t}]);return{get paused(){return e.paused},set paused(n){e.paused=n},cancel:u(()=>e.destroy(),"cancel")}},(t,e)=>St("fixedUpdate",t,e)),Cd=qe(t=>{let e=m.game.root.add([{update:t}]);return{get paused(){return e.paused},set paused(n){e.paused=n},cancel:u(()=>e.destroy(),"cancel")}},(t,e)=>St("update",t,e)),Pd=qe(t=>{let e=m.game.root.add([{draw:t}]);return{get paused(){return e.hidden},set paused(n){e.hidden=n},cancel:u(()=>e.destroy(),"cancel")}},(t,e)=>St("draw",t,e)),hc=qe(t=>m.game.events.on("add",t),(t,e)=>St("add",t,e)),Dd=qe(t=>m.game.events.on("destroy",t),(t,e)=>St("destroy",t,e)),Bd=qe(t=>m.game.events.on("use",t),(t,e)=>St("use",t,e)),kd=qe(t=>m.game.events.on("unuse",t),(t,e)=>St("unuse",t,e)),fc=qe(t=>m.game.events.on("tag",t),(t,e)=>St("tag",t,e)),qd=qe(t=>m.game.events.on("untag",t),(t,e)=>St("untag",t,e));function dc(t,e,n){return St("collide",t,(r,s,i)=>s.is(e)&&n(r,s,i))}u(dc,"onCollide");function gc(t,e,n){return St("collideUpdate",t,(r,s,i)=>s.is(e)&&n(r,s,i))}u(gc,"onCollideUpdate");function pc(t,e,n){return St("collideEnd",t,(r,s,i)=>s.is(e)&&n(r,s,i))}u(pc,"onCollideEnd");function xs(t,e){m.game.root.get(t,{recursive:!0}).forEach(e),hc(t,e),fc((n,r)=>{r===t&&e(n)})}u(xs,"forAllCurrentAndFuture");var Fd=qe(t=>m.app.onMousePress(t),(t,e)=>{let n=[];return xs(t,r=>{if(!r.area)throw new Error("onClick() requires the object to have area() component");n.push(r.onClick(()=>e(r)))}),tr.join(n)});function mc(t,e){let n=[];return xs(t,r=>{if(!r.area)throw new Error("onHover() requires the object to have area() component");n.push(r.onHover(()=>e(r)))}),tr.join(n)}u(mc,"onHover");function yc(t,e){let n=[];return xs(t,r=>{if(!r.area)throw new Error("onHoverUpdate() requires the object to have area() component");n.push(r.onHoverUpdate(()=>e(r)))}),tr.join(n)}u(yc,"onHoverUpdate");function wc(t,e){let n=[];return xs(t,r=>{if(!r.area)throw new Error("onHoverEnd() requires the object to have area() component");n.push(r.onHoverEnd(()=>e(r)))}),tr.join(n)}u(wc,"onHoverEnd");function Ac(t){m.game.events.on("loading",t)}u(Ac,"onLoading");function xc(t){m.app.onResize(t)}u(xc,"onResize");function bc(t){m.game.events.on("error",t)}u(bc,"onError");function Ai(t){m.assets.loaded?t():m.game.events.on("load",t)}u(Ai,"onLoad");function vc(t){if(m.assets.loaded)vo().forEach(e=>t(...e));else return m.game.events.on("loadError",t)}u(vc,"onLoadError");function _o(...t){m.game.cam.pos=L(...t)}u(_o,"setCamPos");function jo(){return m.game.cam.pos?m.game.cam.pos.clone():cs()}u(jo,"getCamPos");function $o(...t){m.game.cam.scale=L(...t)}u($o,"setCamScale");function Vo(){return m.game.cam.scale.clone()}u(Vo,"getCamScale");function Ho(t){m.game.cam.angle=t}u(Ho,"setCamRot");function zo(){return m.game.cam.angle}u(zo,"getCamRot");function Ec(){return m.game.cam.transform.clone()}u(Ec,"getCamTransform");function Ko(t=Re(255,255,255),e=1){let n=m.game.root.add([Uo(st(),ot()),Fo(t),No(1),sa()]),r=n.fadeOut(e);return r.onEnd(()=>Zo(n)),r}u(Ko,"flash");function Sc(){return m.game.cam.transform.clone()}u(Sc,"camTransform");function Ic(t=12){m.game.cam.shake+=t}u(Ic,"shake");function Js(t){return m.game.cam.transform.multVec2(t)}u(Js,"toScreen");function Go(t){return m.game.cam.transform.invert().multVec2(t)}u(Go,"toWorld");function Oc(...t){return nr("camPos","setCamPos / getCamPos"),t.length>0&&_o(...t),jo()}u(Oc,"camPos");function Rc(...t){return nr("camScale","setCamScale / getCamScale"),t.length>0&&$o(...t),Vo()}u(Rc,"camScale");function Mc(t){return nr("camRot","setCamRot / getCamRot"),t!==void 0&&Ho(t),zo()}u(Mc,"camRot");function Tc(t=Re(255,255,255),e=1){return nr("camFlash","flash"),Ko(t,e)}u(Tc,"camFlash");function xi(t=[]){let e=new Map,n=[],r={},s=new ls,i=[],a=new Set("*"),f=m.globalOpt.tagsAsComponents,d=null,h=!1,A={id:td(),hidden:!1,transform:new nn,children:[],parent:null,set paused(g){if(g!==h){h=g;for(let b of i)b.paused=g}},get paused(){return h},get tags(){return Array.from(a)},add(g){let b=Array.isArray(g)?xi(g):g;if(b.parent)throw new Error("Cannot add a game obj that already has a parent.");return b.parent=this,b.transform=br(b),this.children.push(b),b.trigger("add",b),m.game.events.trigger("add",b),b},readd(g){let b=this.children.indexOf(g);return b!==-1&&(this.children.splice(b,1),this.children.push(g)),g},remove(g){let b=this.children.indexOf(g);if(b!==-1){g.parent=null,this.children.splice(b,1);let E=u(C=>{C.trigger("destroy"),m.game.events.trigger("destroy",C),C.children.forEach(v=>E(v))},"trigger");E(g)}},removeAll(g){if(g)this.get(g).forEach(b=>this.remove(b));else for(let b of[...this.children])this.remove(b)},fixedUpdate(){this.paused||(this.children.forEach(g=>g.fixedUpdate()),this.trigger("fixedUpdate"))},update(){this.paused||(this.children.forEach(g=>g.update()),this.trigger("update"))},draw(){if(this.hidden)return;this.canvas&&(Rt(),this.canvas.bind());let g=m.gfx.fixed;this.fixed&&(m.gfx.fixed=!0),Ot(),He(this.pos),Kr(this.scale),er(this.angle);let b=this.children.sort((E,C)=>{let v=E.layerIndex??m.game.defaultLayerIndex,S=C.layerIndex??m.game.defaultLayerIndex;return v-S||(E.z??0)-(C.z??0)});if(this.mask){let E={intersect:m.k.drawMasked,subtract:m.k.drawSubtracted}[this.mask];if(!E)throw new Error(`Invalid mask func: "${this.mask}"`);E(()=>{b.forEach(C=>C.draw())},()=>{this.trigger("draw")})}else this.trigger("draw"),b.forEach(E=>E.draw());bt(),m.gfx.fixed=g,this.canvas&&(Rt(),this.canvas.unbind())},drawInspect(){this.hidden||(Ot(),He(this.pos),Kr(this.scale),er(this.angle),this.children.forEach(g=>g.drawInspect()),this.trigger("drawInspect"),bt())},use(g){var C;if(typeof g=="string")return a.add(g);if(!g||typeof g!="object")throw new Error(`You can only pass a component or a string to .use(), you passed a "${typeof g}"`);let b=[];g.id?(this.unuse(g.id),r[g.id]=[],b=r[g.id],e.set(g.id,g),f&&a.add(g.id)):n.push(g);for(let v in g){if(Hf.has(v))continue;let S=Object.getOwnPropertyDescriptor(g,v);if(S)if(typeof S.value=="function"&&(g[v]=g[v].bind(this)),S.set&&Object.defineProperty(g,v,{set:S.set.bind(this)}),S.get&&Object.defineProperty(g,v,{get:S.get.bind(this)}),zf.has(v)){let j=v==="add"?()=>{var W;d=u(ee=>b.push(ee),"onCurCompCleanup"),(W=g[v])==null||W.call(g),d=null}:g[v];b.push(this.on(v,j).cancel)}else if(this[v]===void 0)Object.defineProperty(this,v,{get:u(()=>g[v],"get"),set:u(j=>g[v]=j,"set"),configurable:!0,enumerable:!0}),b.push(()=>delete this[v]);else{let j=(C=e.values().find(W=>W[v]!==void 0))==null?void 0:C.id;throw new Error(`Duplicate component property: "${v}" while adding component "${g.id}"`+(j?` (originally added by "${j}")`:""))}}let E=u(()=>{if(g.require){for(let v of g.require)if(!this.c(v))throw new Error(`Component "${g.id}" requires component "${v}"`)}},"checkDeps");g.destroy&&b.push(g.destroy.bind(this)),this.exists()?(E(),g.add&&(d=u(v=>b.push(v),"onCurCompCleanup"),g.add.call(this),d=null),g.id&&(this.trigger("use",g.id),m.game.events.trigger("use",this,g.id))):g.require&&b.push(this.on("add",E).cancel)},unuse(g){if(e.has(g)){for(let b of e.values())if(b.require&&b.require.includes(g))throw new Error(`Can't unuse. Component "${b.id}" requires component "${g}"`);e.delete(g),this.trigger("unuse",g),m.game.events.trigger("unuse",this,g)}else f&&a.has(g)&&a.delete(g);r[g]&&(r[g].forEach(b=>b()),delete r[g])},c(g){return e.get(g)??null},get(g,b={}){let E=u((v,S)=>b.only==="comps"?v.has(S):b.only==="tags"?v.is(S):v.is(S)||v.has(S),"checkTagsOrComps"),C=b.recursive?this.children.flatMap(u(function v(S){return[S,...S.children.flatMap(v)]},"recurse")):this.children;if(C=C.filter(v=>g?E(v,g):!0),b.liveUpdate){let v=u(j=>b.recursive?this.isAncestorOf(j):j.parent===this,"isChild"),S=[];S.push(m.k.onAdd(j=>{v(j)&&E(j,g)&&C.push(j)})),S.push(m.k.onDestroy(j=>{if(v(j)&&E(j,g)){let W=C.findIndex(ee=>ee.id===j.id);W!==-1&&C.splice(W,1)}})),this.onDestroy(()=>{for(let j of S)j.cancel()})}return C},query(g){let b=g.hierarchy||"children",E=g.include,C=g.exclude,v=[];switch(b){case"children":v=this.children;break;case"siblings":v=this.parent?this.parent.children.filter(j=>j!==this):[];break;case"ancestors":let S=this.parent;for(;S;)v.push(S),S=S.parent;break;case"descendants":v=this.children.flatMap(u(function j(W){return[W,...W.children.flatMap(j)]},"recurse"));break}if(E&&((g.includeOp||"and")==="and"||!Array.isArray(g.include)?v=v.filter(S=>S.is(E)):v=v.filter(S=>g.include.some(j=>S.is(j)))),C&&((g.includeOp||"and")==="and"||!Array.isArray(g.include)?v=v.filter(S=>!S.is(C)):v=v.filter(S=>!g.exclude.some(j=>S.is(j)))),g.visible===!0&&(v=v.filter(S=>S.visible)),g.distance){if(!this.pos)throw Error("Can't do a distance query from an object without pos");let S=g.distanceOp||"near",j=g.distance*g.distance;S==="near"?v=v.filter(W=>W.pos&&this.pos.sdist(W.pos)<=j):v=v.filter(W=>W.pos&&this.pos.sdist(W.pos)>j)}return g.name&&(v=v.filter(S=>S.name===g.name)),v},isAncestorOf(g){return g.parent?g.parent===this||this.isAncestorOf(g.parent):!1},exists(){return m.game.root.isAncestorOf(this)},is(g,b="and"){return Array.isArray(g)?b==="and"?g.every(E=>a.has(E)):g.some(E=>a.has(E)):a.has(g)},tag(g){if(Array.isArray(g))for(let b of g)a.add(b),this.trigger("tag",b),m.game.events.trigger("tag",this,b);else a.add(g),this.trigger("tag",g),m.game.events.trigger("tag",this,g)},untag(g){if(Array.isArray(g))for(let b of g)a.delete(b),this.trigger("untag",b),m.game.events.trigger("untag",this,b);else a.delete(g),this.trigger("untag",g),m.game.events.trigger("untag",this,g)},has(g,b="and"){return Array.isArray(g)?b==="and"?g.every(E=>e.has(E)):g.some(E=>e.has(E)):e.has(g)},on(g,b){let E=s.on(g,b.bind(this));return d&&d(()=>E.cancel()),E},trigger(g,...b){s.trigger(g,...b),m.game.objEvents.trigger(g,this,...b)},destroy(){this.parent&&this.parent.remove(this)},inspect(){var b;let g={};for(let[E,C]of e)g[E]=((b=C.inspect)==null?void 0:b.call(C))??null;for(let[E,C]of n.entries()){if(C.inspect){g[E]=C.inspect();continue}for(let[v,S]of Object.entries(C))typeof S!="function"&&(g[v]=`${v}: ${S}`)}return g},onAdd(g){return this.on("add",g)},onFixedUpdate(g){return this.on("fixedUpdate",g)},onUpdate(g){return this.on("update",g)},onDraw(g){return this.on("draw",g)},onDestroy(g){return this.on("destroy",g)},onUse(g){return this.on("use",g)},onUnuse(g){return this.on("unuse",g)},clearEvents(){s.clear()}},y=["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick","onButtonPress","onButtonDown","onButtonRelease"];for(let g of y)A[g]=(...b)=>{var C,v;let E=(v=(C=m.app)[g])==null?void 0:v.call(C,...b);return i.push(E),A.onDestroy(()=>E.cancel()),A.on("sceneEnter",()=>{var j,W;i.splice(i.indexOf(E),1);let S=(W=(j=m.app)[g])==null?void 0:W.call(j,...b);tr.replace(E,S),i.push(E)}),E};for(let g of t)A.use(g);return A}u(xi,"make");var Nd=u(()=>({events:new ls,objEvents:new ls,root:xi([]),gravity:null,scenes:{},currentScene:null,layers:null,defaultLayerIndex:0,logs:[],cam:{pos:null,scale:new V(1),angle:0,shake:0,transform:new nn}}),"initGame");function Cc(t){m.game.gravity=t?(m.game.gravity||L(0,1)).unit().scale(t):null}u(Cc,"setGravity");function Pc(){return m.game.gravity?m.game.gravity.len():0}u(Pc,"getGravity");function Dc(t){m.game.gravity=t.unit().scale(m.game.gravity?m.game.gravity.len():1)}u(Dc,"setGravityDirection");function Er(){return m.game.gravity?m.game.gravity.unit():L(0,1)}u(Er,"getGravityDirection");var Ld=Bf("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"),Ud=u(()=>(()=>{let t=new(window.AudioContext||window.webkitAudioContext),e=t.createGain();e.connect(t.destination);let n=new hs(wu(t));return t.decodeAudioData(Ld.buffer.slice(0)).then(r=>{n.buf=r}).catch(r=>{console.error("Failed to load burp: ",r)}),{ctx:t,masterNode:e,burpSnd:n}})(),"initAudio");function Bc(t,e={}){let n=new xt,r=new Audio(t);r.crossOrigin="anonymous",r.loop=!!e.loop,m.audio.ctx.createMediaElementSource(r).connect(m.audio.masterNode);function s(){m.debug.paused||m.app.isHidden()&&!m.globalOpt.backgroundAudio||m.audio.ctx.resume()}u(s,"resumeAudioCtx");function i(){s(),r.play()}return u(i,"play"),e.paused||i(),r.onended=()=>n.trigger(),{play(){i()},seek(a){r.currentTime=a},stop(){r.pause(),this.seek(0)},set loop(a){r.loop=a},get loop(){return r.loop},set paused(a){a?r.pause():i()},get paused(){return r.paused},time(){return r.currentTime},duration(){return r.duration},set volume(a){r.volume=Kt(a,0,1)},get volume(){return r.volume},set speed(a){r.playbackRate=Math.max(a,0)},get speed(){return r.playbackRate},set detune(a){},get detune(){return 0},onEnd(a){return n.add(a)},then(a){return this.onEnd(a)}}}u(Bc,"playMusic");function kc(t,e={}){if(typeof t=="string"&&m.assets.music[t])return Bc(m.assets.music[t],e);let n=m.audio.ctx,r=e.paused??!1,s=n.createBufferSource(),i=new xt,a=n.createGain(),f=n.createStereoPanner(),d=e.seek??0,h=0,A=0,y=!1;s.loop=!!e.loop,s.detune.value=e.detune??0,s.playbackRate.value=e.speed??1,s.connect(f),s.onended=()=>{var v;E()>=(((v=s.buffer)==null?void 0:v.duration)??Number.POSITIVE_INFINITY)&&i.trigger()},f.pan.value=e.pan??0,f.connect(a),a.connect(m.audio.masterNode),a.gain.value=e.volume??1;let g=u(v=>{s.buffer=v.buf,r||(h=n.currentTime,s.start(0,d),y=!0)},"start"),b=ju(t);b instanceof Ut&&b.onLoad(g);let E=u(()=>{if(!s.buffer)return 0;let v=r?A-h:n.currentTime-h,S=s.buffer.duration;return s.loop?v%S:Math.min(v,S)},"getTime"),C=u(v=>{let S=n.createBufferSource();return S.buffer=v.buffer,S.loop=v.loop,S.playbackRate.value=v.playbackRate.value,S.detune.value=v.detune.value,S.onended=v.onended,S.connect(f),S},"cloneNode");return{stop(){this.paused=!0,this.seek(0)},set paused(v){if(r!==v)if(r=v,v)y&&(s.stop(),y=!1),A=n.currentTime;else{s=C(s);let S=A-h;s.start(0,S),y=!0,h=n.currentTime-S,A=0}},get paused(){return r},play(v=0){this.seek(v),this.paused=!1},seek(v){var S;(S=s.buffer)!=null&&S.duration&&(v>s.buffer.duration||(r?(s=C(s),h=A-v):(s.stop(),s=C(s),h=n.currentTime-v,s.start(0,v),y=!0,A=0)))},set speed(v){s.playbackRate.value=v},get speed(){return s.playbackRate.value},set detune(v){s.detune.value=v},get detune(){return s.detune.value},set volume(v){a.gain.value=Math.max(v,0)},get volume(){return a.gain.value},set pan(v){f.pan.value=v},get pan(){return f.pan.value},set loop(v){s.loop=v},get loop(){return s.loop},duration(){var v;return((v=s.buffer)==null?void 0:v.duration)??0},time(){return E()%this.duration()},onEnd(v){return i.add(v)},then(v){return this.onEnd(v)}}}u(kc,"play");function Wo(t){return m.k.play(m.audio.burpSnd,t)}u(Wo,"burp");function Yo(t){m.audio.masterNode.gain.value=t}u(Yo,"setVolume");function Xo(){return m.audio.masterNode.gain.value}u(Xo,"getVolume");function qc(t){return nr("volume","setVolume / getVolume"),t!==void 0&&Yo(t),Xo()}u(qc,"volume");function Jo(){m.app.onHide(()=>{m.globalOpt.backgroundAudio||m.audio.ctx.suspend()}),m.app.onShow(()=>{!m.globalOpt.backgroundAudio&&!m.debug.paused&&m.audio.ctx.resume()}),m.app.onResize(()=>{if(m.app.isFullscreen())return;let t=m.globalOpt.width&&m.globalOpt.height;t&&!m.globalOpt.stretch&&!m.globalOpt.letterbox||(m.canvas.width=m.canvas.offsetWidth*m.pixelDensity,m.canvas.height=m.canvas.offsetHeight*m.pixelDensity,qo(),t||(m.gfx.frameBuffer.free(),m.gfx.frameBuffer=new Ws(m.gfx.ggl,m.gfx.ggl.gl.drawingBufferWidth,m.gfx.ggl.gl.drawingBufferHeight),m.gfx.width=m.gfx.ggl.gl.drawingBufferWidth/m.pixelDensity/m.gscale,m.gfx.height=m.gfx.ggl.gl.drawingBufferHeight/m.pixelDensity/m.gscale))}),m.globalOpt.debug!==!1&&(m.app.onKeyPress(m.globalOpt.debugKey??"f1",()=>m.debug.inspect=!m.debug.inspect),m.app.onKeyPress("f2",()=>m.debug.clearLog()),m.app.onKeyPress("f8",()=>m.debug.paused=!m.debug.paused),m.app.onKeyPress("f7",()=>{m.debug.timeScale=Hs(Kt(m.debug.timeScale-.2,0,2),1)}),m.app.onKeyPress("f9",()=>{m.debug.timeScale=Hs(Kt(m.debug.timeScale+.2,0,2),1)}),m.app.onKeyPress("f10",()=>m.debug.stepFrame())),m.globalOpt.burp&&m.app.onKeyPress("b",()=>Wo())}u(Jo,"initEvents");function Fc(t,e={}){let n=m.game.root.add([ds(t),ra()]),r=(e.speed||1)*5,s=e.scale||1;n.add([Qs(m.boomSprite),gs(0),ei("center"),Wi(r,s),...e.comps??[]]);let i=n.add([Qs(m.kaSprite),gs(0),ei("center"),Zs(),...e.comps??[]]);return i.wait(.4/r,()=>i.use(Wi(r,s))),i.onDestroy(()=>n.destroy()),n}u(Fc,"addKaboom");function Qo(t,e){if(m.game.layers)throw Error("Layers can only be assigned once.");let n=t.indexOf(e);if(n==-1)throw Error("The default layer name should be present in the layers list.");m.game.layers=t,m.game.defaultLayerIndex=n}u(Qo,"setLayers");function Nc(){return m.game.layers}u(Nc,"getLayers");function Lc(){var t;return((t=m.game.layers)==null?void 0:t[m.game.defaultLayerIndex])??null}u(Lc,"getDefaultLayer");function Uc(t,e){nr("layers","setLayers"),Qo(t,e)}u(Uc,"layers");function Zo(t){t.destroy()}u(Zo,"destroy");function _c(){return m.game.root}u(_c,"getTreeRoot");function jc(t,e){m.game.scenes[t]=e}u(jc,"scene");function $c(t,...e){if(!m.game.scenes[t])throw new Error(`Scene not found: ${t}`);m.game.events.onOnce("frameEnd",()=>{m.game.events.trigger("sceneLeave",t),m.app.events.clear(),m.game.events.clear(),m.game.objEvents.clear(),[...m.game.root.children].forEach(n=>{!n.stay||n.scenesToStay&&!n.scenesToStay.includes(t)?m.game.root.remove(n):n.trigger("sceneEnter",t)}),m.game.root.clearEvents(),Jo(),m.game.cam={pos:null,scale:L(1),angle:0,shake:0,transform:new nn},m.game.scenes[t](...e)}),m.game.currentScene=t}u($c,"go");function Vc(t){return m.game.events.on("sceneLeave",t)}u(Vc,"onSceneLeave");function Hc(){return m.game.currentScene}u(Hc,"getSceneName");function Qs(t,e={}){let n=null,r=null,s=null,i=new xt;if(!t)throw new Error("Please pass the resource name or data to sprite()");let a=u((h,A,y,g)=>{let b=L(1,1);return y&&g?(b.x=y/(h.width*A.w),b.y=g/(h.height*A.h)):y?(b.x=y/(h.width*A.w),b.y=b.x):g&&(b.y=g/(h.height*A.h),b.x=b.y),b},"calcTexScale"),f=u((h,A)=>{if(!A)return;let y=A.frames[0].clone();e.quad&&(y=y.scale(e.quad));let g=a(A.tex,y,e.width,e.height);if(h.width=A.tex.width*y.w*g.x,h.height=A.tex.height*y.h*g.y,A.anims)for(let b in A.anims){let E=A.anims[b];typeof E!="number"&&(E.frames=d(E))}n=A,i.trigger(n),e.anim&&h.play(e.anim)},"setSpriteData"),d=u(h=>{if(h.frames)return h.frames;let A=[];if(h.from===void 0||h.to===void 0)throw new Error("Sprite anim 'from' and 'to' must be defined if 'frames' is not defined");let y=Math.abs(h.to-h.from)+1;for(let g=0;g<y;g++)A.push(h.from+g*Math.sign(h.to-h.from));if(h.pingpong)for(let g=y-2;g>0;g--)A.push(A[g]);return A},"createAnimFrames");return{id:"sprite",width:0,height:0,frame:e.frame||0,quad:e.quad||new ze(0,0,1,1),animSpeed:e.animSpeed??1,flipX:e.flipX??!1,flipY:e.flipY??!1,get sprite(){return t.toString()},set sprite(h){let A=ss(h);A&&A.onLoad(y=>f(this,y))},get animFrame(){if(!n||!r||s===null)return this.frame;let h=n.anims[r.name];return typeof h=="number"?h:h.from===void 0||h.to===void 0?r.frameIndex:this.frame-Math.min(h.from,h.to)},draw(){if(!n)return;let h=n.frames[this.frame??0];if(!h)throw new Error(`Frame not found: ${this.frame??0}`);if(n.slice9){let{left:A,right:y,top:g,bottom:b}=n.slice9,E=n.tex.width*h.w,C=n.tex.height*h.h,v=this.width-A-y,S=this.height-g-b,j=A/E,W=y/E,ee=1-j-W,re=g/C,R=b/C,D=1-re-R,N=[Xe(0,0,j,re),Xe(j,0,ee,re),Xe(j+ee,0,W,re),Xe(0,re,j,D),Xe(j,re,ee,D),Xe(j+ee,re,W,D),Xe(0,re+D,j,R),Xe(j,re+D,ee,R),Xe(j+ee,re+D,W,R),Xe(0,0,A,g),Xe(A,0,v,g),Xe(A+v,0,y,g),Xe(0,g,A,S),Xe(A,g,v,S),Xe(A+v,g,y,S),Xe(0,g+S,A,b),Xe(A,g+S,v,b),Xe(A+v,g+S,y,b)];for(let Y=0;Y<9;Y++){let Q=N[Y],ie=N[Y+9];fs(Object.assign(Ln(this),{pos:ie.pos(),tex:n.tex,quad:h.scale(Q),flipX:this.flipX,flipY:this.flipY,tiled:e.tiled,width:ie.w,height:ie.h}))}}else fs(Object.assign(Ln(this),{tex:n.tex,quad:h.scale(this.quad??new ze(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:e.tiled,width:this.width,height:this.height}))},add(){let h=ss(t);h?h.onLoad(A=>f(this,A)):Ai(()=>f(this,ss(t).data))},update(){if(!n||!r||s===null)return;let h=n.anims[r.name];if(typeof h=="number"){this.frame=h;return}if(h.speed===0)throw new Error("Sprite anim speed cannot be 0");if(r.timer+=nt()*this.animSpeed,r.timer>=1/r.speed){r.timer=0,r.frameIndex+=s;let A=h.frames;if(r.frameIndex>=A.length)if(r.pingpong&&!h.pingpong)s=-1,r.frameIndex=A.length-2;else if(r.loop)r.frameIndex=0;else{this.frame=A.at(-1),r.onEnd(),this.stop();return}else if(r.frameIndex<0)if(r.pingpong&&r.loop)s=1,r.frameIndex=1;else if(r.loop)r.frameIndex=A.length-1;else{this.frame=A[0],r.onEnd(),this.stop();return}this.frame=A[r.frameIndex]}},play(h,A={}){if(!n){i.add(()=>this.play(h,A));return}let y=n.anims[h];if(y===void 0)throw new Error(`Anim not found: ${h}`);r&&this.stop(),r=typeof y=="number"?{name:h,timer:0,loop:!1,pingpong:!1,speed:0,frameIndex:0,onEnd:u(()=>{},"onEnd")}:{name:h,timer:0,loop:A.loop??y.loop??!1,pingpong:A.pingpong??y.pingpong??!1,speed:A.speed??y.speed??10,frameIndex:0,onEnd:A.onEnd??(()=>{})},s=typeof y=="number"?null:1,this.frame=typeof y=="number"?y:y.frames[0],this.trigger("animStart",h)},stop(){if(!r)return;let h=r.name;r=null,this.trigger("animEnd",h)},numFrames(){return(n==null?void 0:n.frames.length)??0},getCurAnim(){return r},curAnim(){return r==null?void 0:r.name},getAnim(h){return(n==null?void 0:n.anims[h])??null},hasAnim(h){return!!this.getAnim(h)},onAnimEnd(h){return this.on("animEnd",h)},onAnimStart(h){return this.on("animStart",h)},renderArea(){return new Ue(L(0),this.width,this.height)},inspect(){return typeof t=="string"?`sprite: "${t}"`:null}}}u(Qs,"sprite");function zc(t,e={}){function n(s){var a,f;let i=Fn(Object.assign(Ln(s),{text:s.text+"",size:s.textSize,font:s.font,width:e.width&&s.width,align:s.align,letterSpacing:s.letterSpacing,lineSpacing:s.lineSpacing,transform:s.textTransform,styles:s.textStyles,indentAll:e.indentAll}));return e.width||(s.width=i.width/(((a=s.scale)==null?void 0:a.x)||1)),s.height=i.height/(((f=s.scale)==null?void 0:f.y)||1),i}u(n,"update");let r={id:"text",set text(s){t=s,n(this),this.renderedText=Ys(t).text},get text(){return t},textSize:e.size??36,font:e.font,width:e.width??0,height:0,align:e.align,lineSpacing:e.lineSpacing,letterSpacing:e.letterSpacing,textTransform:e.transform,textStyles:e.styles,renderedText:t?Ys(t).text:"",add(){Ai(()=>n(this))},draw(){Nn(n(this))},renderArea(){return new Ue(L(0),this.width,this.height)}};return n(r),r}u(zc,"text");function Kc(t,e){return{id:"rect",width:t,height:e,draw(){Gr(Object.assign(Ln(this),{width:this.width,height:this.height}))},renderArea(){return new Ue(L(0),this.width,this.height)},inspect(){return`uvquad: (${Math.ceil(this.width)}w, ${Math.ceil(this.height)})h`}}}u(Kc,"uvquad");function Gc(t={}){let e=null,n=null,r=null,s=null;return{id:"agent",require:["pos","tile"],agentSpeed:t.speed??100,allowDiagonals:t.allowDiagonals??!0,getDistanceToTarget(){return e?this.pos.dist(e):0},getNextLocation(){return n&&r?n[r]:null},getPath(){return n?n.slice():null},getTarget(){return e},isNavigationFinished(){return n?r===null:!0},isTargetReachable(){return n!==null},isTargetReached(){return e?this.pos.eq(e):!0},setTarget(i){e=i,n=this.getLevel().getPath(this.pos,e,{allowDiagonals:this.allowDiagonals}),r=n?0:null,n&&r!==null?(s||(s=this.getLevel().onNavigationMapChanged(()=>{e&&n&&r!==null&&(n=this.getLevel().getPath(this.pos,e,{allowDiagonals:this.allowDiagonals}),n?(r=0,this.trigger("navigationNext",this,n[r])):(r=null,this.trigger("navigationEnded",this)))}),this.onDestroy(()=>s==null?void 0:s.cancel())),this.trigger("navigationStarted",this),this.trigger("navigationNext",this,n[r])):this.trigger("navigationEnded",this)},update(){if(e&&n&&r!==null){if(this.pos.sdist(n[r])<2)if(r===n.length-1){this.pos=e.clone(),r=null,this.trigger("navigationEnded",this),this.trigger("targetReached",this);return}else r++,this.trigger("navigationNext",this,n[r]);this.moveTo(n[r],this.agentSpeed)}},onNavigationStarted(i){return this.on("navigationStarted",i)},onNavigationNext(i){return this.on("navigationNext",i)},onNavigationEnded(i){return this.on("navigationEnded",i)},onTargetReached(i){return this.on("targetReached",i)},inspect(){return"agent: "+JSON.stringify({target:JSON.stringify(e),path:JSON.stringify(n)})}}}u(Gc,"agent");function Wc(t){let e=t.graph;return{id:"pathfinder",require:["pos"],navigateTo(n){var r;return(r=this.graph)==null?void 0:r.getWaypointPath(this.pos,n,t.navigationOpt)},get graph(){if(e)return e;let n=this.parent;for(;n;){if(n.has("pathfinderMap"))return n.graph;n=n.parent}},set graph(n){e=n}}}u(Wc,"pathfinder");function Yc(t={}){let e=t.waypoints,n=t.speed||100,r=t.endBehavior||"stop",s=0,i=e!=null;return{id:"patrol",require:["pos"],get patrolSpeed(){return n},set patrolSpeed(a){n=a},get waypoints(){return e},set waypoints(a){e=a,s=0,i=!1},get nextLocation(){return e?e[s]:void 0},update(){let a=this.nextLocation;if(!(!e||!a||i)&&(this.moveTo(a,n),this.pos.sdist(a)<9))switch(r){case"loop":s=(s+1)%e.length;break;case"ping-pong":s=s+1,s==e.length&&(e.reverse(),s=0);break;case"stop":s=Math.min(s+1,e.length-1),s==e.length-1&&(i=!0,this.trigger("patrolFinished"));break}},onPatrolFinished(a){return this.on("patrolFinished",a)}}}u(Yc,"patrol");function Xc(t,e={}){let n=typeof t=="function"?t:()=>m.game.root.query(t),r=e.checkFrequency||1,s=typeof e.direction=="number"?V.fromAngle(e.direction):e.direction,i=0;return{id:"sentry",require:["pos"],direction:typeof e.direction=="number"?V.fromAngle(e.direction):e.direction,spotted:[],set directionAngle(a){this.direction=a!==void 0?V.fromAngle(a):void 0},get directionAngle(){return this.direction?this.direction.angle():void 0},fieldOfView:e.fieldOfView||200,isWithinFieldOfView(a,f,d){let h=(typeof f=="number"?V.fromAngle(f):f)||s,A=d||e.fieldOfView;if(!h||!A||A>=360)return!0;let y=A/2;return a.pos&&h.angleBetween(a.pos.sub(this.pos))<=y},hasLineOfSight(a){let f=Lo(this.pos,a.pos.sub(this.pos),e.raycastExclude);return f!=null&&f.object===a},update(){if(i+=nt(),i>r){i-=r;let a=n();if(a.length&&s&&this.fieldOfView&&this.fieldOfView<360){let f=this.fieldOfView/2;a=a.filter(d=>d.pos&&s.angleBetween(d.pos.sub(this.pos))<=f)}a.length&&e.lineOfSight&&(a=a.filter(f=>f.pos&&this.hasLineOfSight(f))),a.length>0&&(this.spotted=a,this.trigger("objectSpotted",a))}},onObjectsSpotted(a){return this.on("objectSpotted",a)}}}u(Xc,"sentry");function ea(t={}){let e=L(0),n=t.isObstacle??!1,r=t.cost??0,s=t.edges??[],i=u(()=>{let f={left:1,top:2,right:4,bottom:8};return s.map(d=>f[d]||0).reduce((d,h)=>d|h,0)},"getEdgeMask"),a=i();return{id:"tile",tilePosOffset:t.offset??L(0),set tilePos(f){let d=this.getLevel();e=f.clone(),this.pos=L(this.tilePos.x*d.tileWidth(),this.tilePos.y*d.tileHeight()).add(this.tilePosOffset)},get tilePos(){return e},set isObstacle(f){n!==f&&(n=f,this.getLevel().invalidateNavigationMap())},get isObstacle(){return n},set cost(f){r!==f&&(r=f,this.getLevel().invalidateNavigationMap())},get cost(){return r},set edges(f){s=f,a=i(),this.getLevel().invalidateNavigationMap()},get edges(){return s},get edgeMask(){return a},getLevel(){return this.parent},tileMove(f){let d=this.getLevel();d.removeFromSpatialMap(this),this.tilePos=this.tilePos.add(f),d.insertIntoSpatialMap(this),d.trigger("spatialMapChanged")},moveLeft(){this.tileMove(L(-1,0))},moveRight(){this.tileMove(L(1,0))},moveUp(){this.tileMove(L(0,-1))},moveDown(){this.tileMove(L(0,1))}}}u(ea,"tile");var $r,ta=($r=class{constructor(e,n,r){q(this,"name");q(this,"duration");q(this,"loops");q(this,"direction");q(this,"easing");q(this,"interpolation");q(this,"isFinished");q(this,"timing");q(this,"easings");q(this,"relative");this.name=e,this.duration=n.duration,this.loops=n.loops||0,this.direction=n.direction||"forward",this.easing=n.easing||us.linear,this.interpolation=n.interpolation||"linear",this.isFinished=!1,this.timing=n.timing,this.easings=n.easings,this.relative=r}update(e,n){return!0}getLowerKeyIndexAndRelativeTime(e,n,r){let s=n-1,i=e/this.duration;if(this.loops!==0&&i>=this.loops)return[s,0,!0];let a=Math.trunc(i);if(i-=a,(this.direction=="reverse"||this.direction=="ping-pong"&&a&1)&&(i=1-i),r){let f=0;for(;r[f+1]!==void 0&&r[f+1]<i;)f++;return f>=s?[s,0,!0]:[f,(i-r[f])/(r[f+1]-r[f]),!1]}else{let f=Math.floor((n-1)*i);return[f,(i-f/s)*s,!1]}}setValue(e,n,r){if(this.relative)switch(n){case"pos":e.pos=e.base.pos.add(r);break;case"angle":e.angle=e.base.angle+r;break;case"scale":e.scale=e.base.scale.scale(r);break;case"opacity":e.opacity=e.base.opacity*r;break;default:e[n]=r}else e[n]=r}serialize(){let e={duration:this.duration,keys:[]};return this.loops&&(e.loops=this.loops),this.direction!=="forward"&&(e.direction=this.direction),this.easing!=us.linear&&(e.easing=this.easing.name),this.interpolation!=="linear"&&(e.interpolation=this.interpolation),this.timing&&(e.timing=this.timing),this.easings&&(e.easings=this.easings.map(n=>this.easing.name)),e}},u($r,"AnimateChannel"),$r);function Gi(t,e){return e.add(e.sub(t))}u(Gi,"reflect");var Vr,_d=(Vr=class extends ta{constructor(n,r,s,i){super(n,s,i);q(this,"keys");this.keys=r}update(n,r){let[s,i,a]=this.getLowerKeyIndexAndRelativeTime(r,this.keys.length,this.timing);if(i==0||this.interpolation==="none")this.setValue(n,this.name,this.keys[s]);else{let f=this.easings?this.easings[s]:this.easing;this.setValue(n,this.name,vt(this.keys[s],this.keys[s+1],f(i)))}return a}serialize(){return Object.assign(super.serialize(),{keys:this.keys})}},u(Vr,"AnimateChannelNumber"),Vr),Hr,jd=(Hr=class extends ta{constructor(n,r,s,i,a){var f;super(n,s,i);q(this,"keys");q(this,"curves");q(this,"dcurves");if(this.keys=r,this.interpolation==="spline"){this.curves=[],a&&(this.dcurves=[]);for(let d=0;d<this.keys.length-1;d++){let h=this.keys[d],A=d+1,y=this.keys[A],g=d>0?this.keys[d-1]:Gi(y,h),b=A<this.keys.length-1?this.keys[A+1]:Gi(h,y);this.curves.push(as(g,h,y,b)),a&&((f=this.dcurves)==null||f.push(as(g,h,y,b,Ul)))}}}update(n,r){let[s,i,a]=this.getLowerKeyIndexAndRelativeTime(r,this.keys.length,this.timing);if(i==0||this.interpolation==="none")this.setValue(n,this.name,this.keys[s]);else{let f=this.easings?this.easings[s]:this.easing;switch(this.interpolation){case"linear":this.setValue(n,this.name,this.keys[s].lerp(this.keys[s+1],f(i)));break;case"slerp":this.setValue(n,this.name,this.keys[s].slerp(this.keys[s+1],f(i)));break;case"spline":if(this.curves){this.setValue(n,this.name,this.curves[s](f(i))),this.dcurves&&this.setValue(n,"angle",this.dcurves[s](f(i)).angle());break}}}return a}serialize(){return Object.assign(super.serialize(),{keys:this.keys.map(n=>[n.x,n.y])})}},u(Hr,"AnimateChannelVec2"),Hr),zr,$d=(zr=class extends ta{constructor(n,r,s,i){super(n,s,i);q(this,"keys");this.keys=r}update(n,r){let[s,i,a]=this.getLowerKeyIndexAndRelativeTime(r,this.keys.length,this.timing);if(i==0||this.interpolation=="none")this.setValue(n,this.name,this.keys[s]);else{let f=this.easings?this.easings[s]:this.easing;this.setValue(n,this.name,this.keys[s].lerp(this.keys[s+1],f(i)))}return a}serialize(){return Object.assign(super.serialize(),{keys:this.keys})}},u(zr,"AnimateChannelColor"),zr);function Jc(t={}){let e=[],n=0,r=!1;return{id:"animate",require:t.followMotion?["rotate"]:void 0,base:{pos:L(0,0),angle:0,scale:L(1,1),opacity:1},animation:{paused:!1,seek(s){n=Kt(s,0,this.duration),e.forEach(i=>{i.isFinished=!1}),r=!1},get duration(){return e.reduce((s,i)=>Math.max(i.duration,s),0)}},add(){t.relative&&(this.has("pos")&&(this.base.pos=this.pos.clone()),this.has("rotate")&&(this.base.angle=this.angle),this.has("scale")&&(this.base.scale=this.scale),this.has("opacity")&&(this.base.opacity=this.opacity))},update(){if(this.animation.paused)return;let s=!0,i;n+=nt();for(let a of e)i=a.update(this,n),i&&!a.isFinished&&(a.isFinished=!0,this.trigger("animateChannelFinished",a.name)),s&&(s=i);s&&!r&&(r=!0,this.trigger("animateFinished"))},animate(s,i,a){r=!1,this.unanimate(s),typeof i[0]=="number"?e.push(new _d(s,i,a,t.relative||!1)):i[0]instanceof V?e.push(new jd(s,i,a,t.relative||!1,s==="pos"&&(t.followMotion||!1))):i[0]instanceof ve&&e.push(new $d(s,i,a,t.relative||!1))},unanimate(s){let i=e.findIndex(a=>a.name===s);i>=0&&e.splice(i,1)},unanimateAll(){e.splice(0,e.length)},onAnimateFinished(s){return this.on("animateFinished",s)},onAnimateChannelFinished(s){return this.on("animateChannelFinished",s)},serializeAnimationChannels(){return e.reduce((s,i)=>(s[i.name]=i.serialize(),s),{})},serializeAnimationOptions(){let s={};return t.followMotion&&(s.followMotion=!0),t.relative&&(s.relative=!0),s}}}u(Jc,"animate");function na(t,e){let n={name:t.name};return t.has("animate")&&(n.channels=t.serializeAnimationChannels(),Object.assign(n,t.serializeAnimationOptions())),t.children.length>0&&(n.children=t.children.filter(r=>r.has("named")).map(r=>na(r,r.name))),n}u(na,"serializeAnimation");function Wi(t=2,e=1){let n=0;return{require:["scale"],update(){let r=Math.sin(n*t)*e;r<0&&this.destroy(),this.scale=L(r),n+=nt()}}}u(Wi,"boom");function Qc(t,e){if(t==null)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(n=1){this.setHP(t-n),this.trigger("hurt",n)},heal(n=1){let r=t;this.setHP(t+n),this.trigger("heal",t-r)},hp(){return t},maxHP(){return e??null},setMaxHP(n){e=n},setHP(n){t=e?Math.min(e,n):n,t<=0&&this.trigger("death")},onHurt(n){return this.on("hurt",n)},onHeal(n){return this.on("heal",n)},onDeath(n){return this.on("death",n)},inspect(){return`health: ${t}`}}}u(Qc,"health");function Zc(t,e={}){if(t==null)throw new Error("lifespan() requires time");let n=e.fade??0;return{id:"lifespan",require:["opacity"],add(){m.game.root.wait(t,()=>{this.opacity=this.opacity??1,n>0?m.game.root.tween(this.opacity,0,n,r=>this.opacity=r,us.linear).onEnd(()=>{this.destroy()}):this.destroy()})}}}u(Zc,"lifespan");function eh(t){return{id:"named",name:t}}u(eh,"named");function th(t,e,n){if(!t)throw new Error("state() requires an initial state");let r={};function s(d){r[d]||(r[d]={enter:new xt,end:new xt,update:new xt,draw:new xt})}u(s,"initStateEvents");function i(d,h,A){return s(h),r[h][d].add(A)}u(i,"on");function a(d,h,...A){s(h),r[h][d].trigger(...A)}u(a,"trigger");let f=!1;return{id:"state",state:t,enterState(d,...h){if(f=!0,e&&!e.includes(d))throw new Error(`State not found: ${d}`);let A=this.state;if(n){if(!(n!=null&&n[A]))return;let y=typeof n[A]=="string"?[n[A]]:n[A];if(!y.includes(d))throw new Error(`Cannot transition state from "${A}" to "${d}". Available transitions: ${y.map(g=>`"${g}"`).join(", ")}`)}a("end",A,...h),this.state=d,a("enter",d,...h),a("enter",`${A} -> ${d}`,...h)},onStateTransition(d,h,A){return i("enter",`${d} -> ${h}`,A)},onStateEnter(d,h){return i("enter",d,h)},onStateUpdate(d,h){return i("update",d,h)},onStateDraw(d,h){return i("draw",d,h)},onStateEnd(d,h){return i("end",d,h)},update(){f||(a("enter",t),f=!0),a("update",this.state)},draw(){a("draw",this.state)},inspect(){return`state: ${this.state}`}}}u(th,"state");function ra(t){return{id:"stay",stay:!0,scenesToStay:t}}u(ra,"stay");function nh(t=!0,e){let n,r;return{id:"textInput",hasFocus:t,require:["text"],typedText:"",add(){let s=u(()=>{this.text=this.typedText.replace(/([\[\\])/g,"\\$1")},"flip");n=m.k.onCharInput(i=>{this.hasFocus&&(!e||this.typedText.length<e)&&(m.k.isKeyDown("shift")?this.typedText+=i.toUpperCase():this.typedText+=i,s())}),r=m.k.onKeyPressRepeat("backspace",()=>{this.hasFocus&&(this.typedText=this.typedText.slice(0,-1)),s()})},destroy(){n.cancel(),r.cancel()}}}u(nh,"textInput");function Zs(t=1e3){return{id:"timer",maxLoopsPerFrame:t,loop(e,n,r=-1,s=!1){let i=s?0:e,a=new xt,f=this.onUpdate(()=>{i+=m.app.state.dt;for(let d=0;i>=e&&d<this.maxLoopsPerFrame;d++){if(r!=-1&&(r--,r<0)){f.cancel(),a.trigger();return}n(),i-=e}});return{get paused(){return f.paused},set paused(d){f.paused=d},cancel:f.cancel,onEnd:a.add,then(d){return a.add(d),this}}},wait(e,n){return this.loop(e,n??(()=>{}),1,!0)},tween(e,n,r,s,i=us.linear){let a=0,f=[],d=this.onUpdate(()=>{a+=m.app.state.dt;let h=Math.min(a/r,1);s(vt(e,n,i(h))),h===1&&(d.cancel(),s(n),f.forEach(A=>A()))});return{get paused(){return d.paused},set paused(h){d.paused=h},onEnd(h){f.push(h)},then(h){return this.onEnd(h),this},cancel(){d.cancel()},finish(){d.cancel(),s(n),f.forEach(h=>h())}}}}}u(Zs,"timer");var Yi=0;function rh(){return Yi>0}u(rh,"usesArea");function sh(t={}){let e={},n=new Set,r=[];return{id:"area",collisionIgnore:t.collisionIgnore??[],add(){Yi++,this.area.cursor&&r.push(this.onHover(()=>m.app.setCursor(this.area.cursor))),r.push(this.onCollideUpdate((s,i)=>{if(!s.id)throw new Error("area() requires the object to have an id");e[s.id]||this.trigger("collide",s,i),i&&(e[s.id]=i,n.add(s.id))}))},destroy(){Yi--;for(let s of r)s.cancel()},fixedUpdate(){for(let s in e)n.has(Number(s))||(this.trigger("collideEnd",e[s].target),delete e[s]);n.clear()},drawInspect(){let s=this.localArea();Ot(),He(this.area.offset);let i={outline:{width:4/xo(),color:Re(0,0,255)},anchor:this.anchor,fill:!1,fixed:Rn(this)};s instanceof Ue?Mt({...i,pos:s.pos,width:s.width*this.area.scale.x,height:s.height*this.area.scale.y}):s instanceof Et?fn({...i,pts:s.pts,scale:this.area.scale}):s instanceof Tt&&sr({...i,pos:s.center,radius:s.radius}),bt()},area:{shape:t.shape??null,scale:t.scale?L(t.scale):L(1),offset:t.offset??L(0),cursor:t.cursor??null},isClicked(){return m.app.isMousePressed()&&this.isHovering()},isHovering(){let s=Rn(this)?m.k.mousePos():m.k.toWorld(m.k.mousePos());return this.hasPoint(s)},checkCollision(s){if(!s.id)throw new Error("checkCollision() requires the object to have an id");return e[s.id]??null},getCollisions(){return Object.values(e)},isColliding(s){if(!s.id)throw new Error("isColliding() requires the object to have an id");return!!e[s.id]},isOverlapping(s){if(!s.id)throw new Error("isOverlapping() requires the object to have an id");let i=e[s.id];return i&&i.hasOverlap()},onClick(s,i="left"){let a=m.app.onMousePress(i,()=>{this.isHovering()&&s()});return r.push(a),a},onHover(s){let i=!1;return this.onUpdate(()=>{i?i=this.isHovering():this.isHovering()&&(i=!0,s())})},onHoverUpdate(s){return this.onUpdate(()=>{this.isHovering()&&s()})},onHoverEnd(s){let i=!1;return this.onUpdate(()=>{i?this.isHovering()||(i=!1,s()):i=this.isHovering()})},onCollide(s,i){if(typeof s=="function"&&i===void 0)return this.on("collide",s);if(typeof s=="string")return this.onCollide((a,f)=>{a.is(s)&&(i==null||i(a,f))});throw new Error("onCollide() requires either a function or a tag")},onCollideUpdate(s,i){if(typeof s=="function"&&i===void 0)return this.on("collideUpdate",s);if(typeof s=="string")return this.on("collideUpdate",(a,f)=>a.is(s)&&(i==null?void 0:i(a,f)));throw new Error("onCollideUpdate() requires either a function or a tag")},onCollideEnd(s,i){if(typeof s=="function"&&i===void 0)return this.on("collideEnd",s);if(typeof s=="string")return this.on("collideEnd",a=>a.is(s)&&(i==null?void 0:i(a)));throw new Error("onCollideEnd() requires either a function or a tag")},hasPoint(s){return gn(this.worldArea(),s)},resolveCollision(s){let i=this.checkCollision(s);i&&!i.resolved&&(this.pos=this.pos.add(i.displacement),i.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let s=this.localArea();if(!(s instanceof Et||s instanceof Ue))throw new Error("Only support polygon and rect shapes for now");let i=this.transform.clone().translate(this.area.offset).scale(L(this.area.scale??1));if(s instanceof Ue){let a=rr(this.anchor||fi).add(1,1).scale(-.5).scale(s.width,s.height);i.translate(a)}return s.transform(i)},screenArea(){let s=this.worldArea();return Rn(this)?s:s.transform(m.game.cam.transform)},inspect(){var s,i,a,f,d,h,A;return((s=this.area.scale)==null?void 0:s.x)==((i=this.area.scale)==null?void 0:i.y)?`area: ${(f=(a=this.area.scale)==null?void 0:a.x)==null?void 0:f.toFixed(1)}x`:`area: (${(h=(d=this.area.scale)==null?void 0:d.x)==null?void 0:h.toFixed(1)}x, ${(A=this.area.scale.y)==null?void 0:A.toFixed(1)}y)`}}}u(sh,"area");function ih(t={}){let e=null,n=null,r=!1,s=L(0),i=null,a=null,f;return{id:"body",require:["pos"],vel:L(0),drag:t.drag??0,jumpForce:t.jumpForce??Gf,gravityScale:t.gravityScale??1,isStatic:t.isStatic??!1,mass:t.mass??1,add(){if(i=this.pos.clone(),a=this.pos.clone(),f=this.pos.clone(),this.mass===0)throw new Error("Can't set body mass to 0");this.has("area")&&(this.onCollideUpdate((d,h)=>{if(!h||!d.has("body")||h.resolved)return;this.trigger("beforePhysicsResolve",h);let A=h.reverse();if(d.trigger("beforePhysicsResolve",A),!(h.resolved||A.resolved)&&!(this.isStatic&&d.isStatic)){if(!this.isStatic&&!d.isStatic){let y=this.mass+d.mass;this.pos=this.pos.add(h.displacement.scale(d.mass/y)),d.pos=d.pos.add(h.displacement.scale(-this.mass/y)),this.transform=br(this),d.transform=br(d)}else{let y=!this.isStatic&&d.isStatic?h:h.reverse();y.source.pos=y.source.pos.add(y.displacement),y.source.transform=br(y.source)}h.resolved=!0,this.trigger("physicsResolve",h),d.trigger("physicsResolve",h.reverse())}}),this.onPhysicsResolve(d=>{if(m.game.gravity)if(d.isBottom()&&this.isFalling()){this.vel=this.vel.reject(m.game.gravity.unit());let h=e;e=d.target,h!=e&&(n=d.target.pos),r?r=!1:h||(this.trigger("ground",e),d.target.trigger("land",this))}else d.isTop()&&this.isJumping()&&(this.vel=this.vel.reject(m.game.gravity.unit()),this.trigger("headbutt",d.target),d.target.trigger("headbutted",this))}))},update(){e&&this.isColliding(e)&&e.exists()&&e.has("body")&&(n&&!e.pos.eq(n)&&t.stickToPlatform!==!1&&this.moveBy(e.pos.sub(n)),n=e.pos);let d=Ks();d&&(this.pos.x==f.x&&(this.pos.x=vt(i.x,a.x,d/zs()),f.x=this.pos.x),this.pos.y==f.y&&(this.pos.y=vt(i.y,a.y,d/zs()),f.y=this.pos.y))},fixedUpdate(){if(i&&(this.pos.x==f.x&&(this.pos.x=i.x),this.pos.y==f.y&&(this.pos.y=i.y),i=null),m.game.gravity&&!this.isStatic){r&&(e=null,n=null,this.trigger("fallOff"),r=!1),e&&(!this.isColliding(e)||!e.exists()||!e.has("body"))&&(r=!0);let d=this.vel.clone();this.vel=this.vel.add(m.game.gravity.scale(this.gravityScale*nt()));let h=t.maxVelocity??Wf;this.vel.slen()>h*h&&(this.vel=this.vel.unit().scale(h)),d.dot(m.game.gravity)<0&&this.vel.dot(m.game.gravity)>=0&&this.trigger("fall")}if(this.vel.x+=s.x*nt(),this.vel.y+=s.y*nt(),this.vel.x*=1-this.drag*nt(),this.vel.y*=1-this.drag*nt(),this.move(this.vel),Ks()){i=this.pos.clone();let d=this.vel.add(s.scale(nt()));a=this.pos.add(d.scale(nt())),f=this.pos.clone()}s.x=0,s.y=0},onPhysicsResolve(d){return this.on("physicsResolve",d)},onBeforePhysicsResolve(d){return this.on("beforePhysicsResolve",d)},curPlatform(){return e},isGrounded(){return e!==null},isFalling(){return this.vel.dot(Er())>0},isJumping(){return this.vel.dot(Er())<0},applyImpulse(d){this.isStatic||(this.vel=this.vel.add(d))},addForce(d){this.isStatic||(s.x+=d.x/this.mass,s.y+=d.y/this.mass)},jump(d){this.isStatic||(e=null,n=null,this.vel=Er().scale(-d||-this.jumpForce))},onGround(d){return this.on("ground",d)},onFall(d){return this.on("fall",d)},onFallOff(d){return this.on("fallOff",d)},onHeadbutt(d){return this.on("headbutt",d)},onLand(d){return this.on("land",d)},onHeadbutted(d){return this.on("headbutted",d)},inspect(){return`gravityScale: ${this.gravityScale}x`}}}u(ih,"body");function oh(t=2){let e=t;return{id:"doubleJump",require:["body"],numJumps:t,add(){this.onGround(()=>{e=this.numJumps})},doubleJump(n){e<=0||(e<this.numJumps&&this.trigger("doubleJump"),e--,this.jump(n))},onDoubleJump(n){return this.on("doubleJump",n)},inspect(){return`jumpsLeft: ${e}`}}}u(oh,"doubleJump");function ah(t){return{id:"surfaceEffector",require:["area"],speed:t.speed,speedVariation:t.speedVariation??0,forceScale:t.speedVariation??.9,add(){this.onCollideUpdate("body",(e,n)=>{var a;let r=n==null?void 0:n.normal.normal(),s=e.vel.project(r),i=(a=r==null?void 0:r.scale(this.speed))==null?void 0:a.sub(s);e.addForce(i==null?void 0:i.scale(e.mass*this.forceScale))})}}}u(ah,"surfaceEffector");function lh(t){return{id:"areaEffector",require:["area"],useGlobalAngle:t.useGlobalAngle||!1,forceAngle:t.forceAngle,forceMagnitude:t.forceMagnitude,forceVariation:t.forceVariation??0,linearDrag:t.linearDrag??0,add(){this.onCollideUpdate("body",(e,n)=>{if(!e.has("body"))return;let r=V.fromAngle(this.forceAngle).scale(this.forceMagnitude);e.addForce(r),this.linearDrag&&e.addForce(e.vel.scale(-this.linearDrag))})}}}u(lh,"areaEffector");function uh(t){return{id:"pointEffector",require:["area","pos"],forceMagnitude:t.forceMagnitude,forceVariation:t.forceVariation??0,distanceScale:t.distanceScale??1,forceMode:t.forceMode||"inverseLinear",linearDrag:t.linearDrag??0,add(){this.onCollideUpdate("body",(e,n)=>{let r=this.pos.sub(e.pos),s=r.len(),i=s*this.distanceScale/10,a=this.forceMode==="constant"?1:this.forceMode==="inverseLinear"?1/i:1/i**2,f=r.scale(this.forceMagnitude*a/s);e.addForce(f),this.linearDrag&&e.addForce(e.vel.scale(-this.linearDrag))})}}}u(uh,"pointEffector");function ch(t){return{id:"constantForce",require:["body"],force:t.force,update(){this.force&&this.addForce(this.force)}}}u(ch,"constantForce");function hh(t){return{id:"platformEffector",require:["area","body"],surfaceArc:t.surfaceArc??180,useOneWay:t.useOneWay??!1,add(){this.onBeforePhysicsResolve(e=>{let n=e.target.vel,r=Er().scale(-1).angleBetween(n);Math.abs(r)>this.surfaceArc/2&&e.preventResolution()})}}}u(hh,"platformEffector");function fh(t){return{id:"buoyancyEffector",require:["area"],surfaceLevel:t.surfaceLevel,density:t.density??1,linearDrag:t.linearDrag??1,angularDrag:t.angularDrag??.2,flowAngle:t.flowAngle??0,flowMagnitude:t.flowMagnitude??0,flowVariation:t.flowVariation??0,add(){this.onCollideUpdate("body",(e,n)=>{let r=e,s=r.worldArea(),[i,a]=s.cut(L(-100,this.surfaceLevel),L(100,this.surfaceLevel));i&&(this.applyBuoyancy(r,i),this.applyDrag(r,i)),this.flowMagnitude&&r.addForce(V.fromAngle(this.flowAngle).scale(this.flowMagnitude))})},applyBuoyancy(e,n){let r=this.density*n.area(),s=L(0,1).scale(-r);e.addForce(s)},applyDrag(e,n){let r=e.vel,s=this.density*this.linearDrag,i=r.scale(-s);e.addForce(i)}}}u(fh,"buoyancyEffector");function ei(t){if(!t)throw new Error("Please define an anchor");return{id:"anchor",anchor:t,inspect(){return typeof this.anchor=="string"?"anchor: "+this.anchor:"anchor: "+this.anchor.toString()}}}u(ei,"anchor");function sa(){return{id:"fixed",fixed:!0}}u(sa,"fixed");function dh(t,e){return{id:"follow",require:["pos"],follow:{obj:t,offset:e??L(0)},add(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}u(dh,"follow");function gh(t){var n;let e=(n=m.game.layers)==null?void 0:n.indexOf(t);return{id:"layer",get layerIndex(){return e??null},get layer(){var r;return e?((r=m.game.layers)==null?void 0:r[e])??null:null},set layer(r){var s;if(e=(s=m.game.layers)==null?void 0:s.indexOf(r),e==-1)throw Error("Invalid layer name")},inspect(){return`layer: ${this.layer}`}}}u(gh,"layer");function ph(t,e){let n=typeof t=="number"?V.fromAngle(t):t.unit();return{id:"move",require:["pos"],update(){this.move(n.scale(e))}}}u(ph,"move");function mh(t={}){let e=t.distance??Kf,n=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let r=this.screenPos();if(!r)return!1;let s=new Ue(L(0),st(),ot());return!ps(s,r)&&s.sdistToPoint(r)>e*e},onExitScreen(r){return this.on("exitView",r)},onEnterScreen(r){return this.on("enterView",r)},update(){this.isOffScreen()?(n||(this.trigger("exitView"),n=!0),t.hide&&(this.hidden=!0),t.pause&&(this.paused=!0),t.destroy&&this.destroy()):(n&&(this.trigger("enterView"),n=!1),t.hide&&(this.hidden=!1),t.pause&&(this.paused=!1))}}}u(mh,"offscreen");function ds(...t){return{id:"pos",pos:L(...t),moveBy(...e){this.pos=this.pos.add(L(...e))},move(...e){this.moveBy(L(...e).scale(nt()))},moveTo(...e){if(typeof e[0]=="number"&&typeof e[1]=="number")return this.moveTo(L(e[0],e[1]),e[2]);let n=e[0],r=e[1];if(r===void 0){this.pos=L(n);return}let s=n.sub(this.pos);if(s.len()<=r*nt()){this.pos=L(n);return}this.move(s.unit().scale(r))},worldPos(e=null){return e?(this.pos=this.pos.add(this.fromWorld(e)),null):this.parent?this.parent.transform.multVec2(this.pos):this.pos},toWorld(e){return this.parent?this.parent.transform.multVec2(this.pos.add(e)):this.pos.add(e)},fromWorld(e){return this.parent?this.parent.transform.invert().multVec2(e).sub(this.pos):e.sub(this.pos)},screenPos(e=null){if(e)return this.pos=this.pos.add(this.fromScreen(e)),null;{let n=this.worldPos();return n?Rn(this)?n:Js(n):null}},toScreen(e){let n=this.toWorld(e);return Rn(this)?n:Js(n)},fromScreen(e){return Rn(this)?this.fromWorld(e):this.fromWorld(Go(e))},toOther(e,n){return e.fromWorld(this.toWorld(n))},fromOther(e,n){return e.toOther(this,n)},inspect(){return`pos: (${Math.round(this.pos.x)}x, ${Math.round(this.pos.y)}y)`},drawInspect(){sr({color:Re(255,0,0),radius:4/xo()})}}}u(ds,"pos");function yh(t){return{id:"rotate",angle:t??0,rotateBy(e){this.angle+=e},rotateTo(e){this.angle=e},inspect(){return`angle: ${Math.round(this.angle)}`}}}u(yh,"rotate");function gs(...t){if(t.length===0)return gs(1);let e=L(...t);return{id:"scale",set scale(n){if(!(n instanceof V))throw Error("The scale property on scale is a vector. Use scaleTo or scaleBy to set the scale with a number.");e=L(n)},get scale(){return e},scaleTo(...n){e=L(...n)},scaleBy(...n){e=e.scale(L(...n))},inspect(){return e.x==e.y?`scale: ${e.x.toFixed(1)}x`:`scale: (${e.x.toFixed(1)}x, ${e.y.toFixed(1)}y)`}}}u(gs,"scale");function wh(t){return{id:"z",z:t,inspect(){return`z: ${this.z}`}}}u(wh,"z");var Vd="data:image/png;base64,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",Hd="data:image/png;base64,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",zd="3001.0.0",m={k:null,globalOpt:null,gfx:null,game:null,app:null,assets:null,fontCacheCanvas:null,fontCacheC2d:null,debug:null,audio:null,pixelDensity:null,canvas:null,gscale:null,kaSprite:null,boomSprite:null},Kd=u((t={tagsAsComponents:!0})=>{m.k&&(console.warn("KAPLAY already initialized, you are calling kaplay() multiple times, it may lead bugs!"),m.k.quit()),m.globalOpt=t;let e=t.root??document.body;e===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let n=t.canvas??e.appendChild(document.createElement("canvas"));m.canvas=n;let r=t.scale??1;m.gscale=r;let s=t.width&&t.height&&!t.stretch&&!t.letterbox;s?(n.width=t.width*r,n.height=t.height*r):(n.width=n.parentElement.offsetWidth,n.height=n.parentElement.offsetHeight);let i=["outline: none","cursor: default"];if(s){let pe=n.width,Ae=n.height;i.push(`width: ${pe}px`),i.push(`height: ${Ae}px`)}else i.push("width: 100%"),i.push("height: 100%");t.crisp&&(i.push("image-rendering: pixelated"),i.push("image-rendering: crisp-edges")),n.style.cssText=i.join(";");let a=t.pixelDensity||1;m.pixelDensity=a,n.width*=a,n.height*=a,n.tabIndex=0;let f=document.createElement("canvas");f.width=256,f.height=256,m.fontCacheCanvas=f;let d=f.getContext("2d",{willReadFrequently:!0});m.fontCacheC2d=d;let h=ld({canvas:n,touchToMouse:t.touchToMouse,gamepads:t.gamepads,pixelDensity:t.pixelDensity,maxFPS:t.maxFPS,buttons:t.buttons});m.app=h;let A=[],y=h.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});if(!y)throw new Error("WebGL not supported");let g=y,b=Wu(g,{texFilter:t.texFilter}),E=Od(t,b);m.gfx=E;let C=Ud();m.audio=C;let v=vd(b,t.spriteAtlasPadding??0);m.assets=v;let S=Nd();m.game=S,S.root.use(Zs());function j(pe,Ae){let xe=new Ws(b,pe,Ae);return{clear:u(()=>xe.clear(),"clear"),free:u(()=>xe.free(),"free"),toDataURL:u(()=>xe.toDataURL(),"toDataURL"),toImageData:u(()=>xe.toImageData(),"toImageData"),width:xe.width,height:xe.height,draw:u(Oe=>{Rt(),xe.bind(),Oe(),Rt(),xe.unbind()},"draw"),get fb(){return xe}}}u(j,"makeCanvas");function W(){g.clear(g.COLOR_BUFFER_BIT),E.frameBuffer.bind(),g.clear(g.COLOR_BUFFER_BIT),E.bgColor||cn(()=>{Gr({width:st(),height:ot(),quad:new ze(0,0,st()/64,ot()/64),tex:E.bgTex,fixed:!0})}),E.renderer.numDraws=0,E.fixed=!1,E.transformStack.length=0,E.transform=new nn}u(W,"frameStart");function ee(pe,Ae){E.postShader=pe,E.postShaderUniform=Ae??null}u(ee,"usePostEffect");function re(){Rt(),E.lastDrawCalls=E.renderer.numDraws,E.frameBuffer.unbind(),g.viewport(0,0,g.drawingBufferWidth,g.drawingBufferHeight);let pe=E.width,Ae=E.height;E.width=g.drawingBufferWidth/a,E.height=g.drawingBufferHeight/a,fs({flipY:!0,tex:E.frameBuffer.tex,pos:new V(E.viewport.x,E.viewport.y),width:E.viewport.width,height:E.viewport.height,shader:E.postShader,uniform:typeof E.postShaderUniform=="function"?E.postShaderUniform():E.postShaderUniform,fixed:!0}),Rt(),E.width=pe,E.height=Ae}u(re,"frameEnd");let R=!1,D={inspect:!1,set timeScale(pe){m.app.state.timeScale=pe},get timeScale(){return m.app.state.timeScale},showLog:!0,fps:u(()=>h.fps(),"fps"),numFrames:u(()=>h.numFrames(),"numFrames"),stepFrame:We,drawCalls:u(()=>E.lastDrawCalls,"drawCalls"),clearLog:u(()=>S.logs=[],"clearLog"),log:u((...pe)=>{let Ae=t.logMax??8,xe=pe.length>1?pe.concat(" ").join(" "):pe[0];S.logs.unshift({msg:xe,time:h.time()}),S.logs.length>Ae&&(S.logs=S.logs.slice(0,Ae))},"log"),error:u(pe=>D.log(new Error(pe.toString?pe.toString():pe)),"error"),curRecording:null,numObjects:u(()=>_("*",{recursive:!0}).length,"numObjects"),get paused(){return R},set paused(pe){R=pe,pe?C.ctx.suspend():C.ctx.resume()}};m.debug=D;function N(pe,Ae){try{return JSON.parse(window.localStorage[pe])}catch{return Ae?(Y(pe,Ae),Ae):null}}u(N,"getData");function Y(pe,Ae){window.localStorage[pe]=JSON.stringify(Ae)}u(Y,"setData");function Q(pe,...Ae){let xe=pe(Dt),Oe;typeof xe=="function"?Oe=xe(...Ae)(Dt):Oe=xe;for(let _e in Oe)Dt[_e]=Oe[_e],t.global!==!1&&(window[_e]=Oe[_e]);return Dt}u(Q,"plug");function ie(pe){let Ae=h.canvas.captureStream(pe),xe=C.ctx.createMediaStreamDestination();C.masterNode.connect(xe);let Oe=new MediaRecorder(Ae),_e=[];return Oe.ondataavailable=Ee=>{Ee.data.size>0&&_e.push(Ee.data)},Oe.onerror=()=>{C.masterNode.disconnect(xe),Ae.getTracks().forEach(Ee=>Ee.stop())},Oe.start(),{resume(){Oe.resume()},pause(){Oe.pause()},stop(){return Oe.stop(),C.masterNode.disconnect(xe),Ae.getTracks().forEach(Ee=>Ee.stop()),new Promise(Ee=>{Oe.onstop=()=>{Ee(new Blob(_e,{type:"video/mp4"}))}})},download(Ee="kaboom.mp4"){this.stop().then(Ce=>ji(Ee,Ce))}}}u(ie,"record");function fe(){return document.activeElement===h.canvas}u(fe,"isFocused");let M=S.root.add.bind(S.root),K=S.root.readd.bind(S.root),z=S.root.removeAll.bind(S.root),_=S.root.get.bind(S.root),$=S.root.wait.bind(S.root),te=S.root.loop.bind(S.root),he=S.root.query.bind(S.root),oe=S.root.tween.bind(S.root),ye=vr(null,Hd),le=vr(null,Vd);m.kaSprite=ye,m.boomSprite=le;function Fe(){S.root.fixedUpdate()}u(Fe,"fixedUpdateFrame");function We(){S.root.update()}u(We,"updateFrame");const on=class on{constructor(Ae,xe,Oe,_e,Ee=!1){q(this,"source");q(this,"target");q(this,"normal");q(this,"distance");q(this,"resolved",!1);this.source=Ae,this.target=xe,this.normal=Oe,this.distance=_e,this.resolved=Ee}get displacement(){return this.normal.scale(this.distance)}reverse(){return new on(this.target,this.source,this.normal.scale(-1),this.distance,this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.cross(S.gravity||L(0,1))>0}isRight(){return this.displacement.cross(S.gravity||L(0,1))<0}isTop(){return this.displacement.dot(S.gravity||L(0,1))>0}isBottom(){return this.displacement.dot(S.gravity||L(0,1))<0}preventResolution(){this.resolved=!0}};u(on,"Collision");let ct=on;function jn(){if(!rh())return;let pe={},Ae=t.hashGridSize||64,xe=new nn,Oe=[];function _e(Ee){if(Oe.push(xe.clone()),Ee.pos&&xe.translate(Ee.pos),Ee.scale&&xe.scale(Ee.scale),Ee.angle&&xe.rotate(Ee.angle),Ee.transform=xe.clone(),Ee.c("area")&&!Ee.paused){let Ce=Ee,lt=Ce.worldArea().bbox(),or=Math.floor(lt.pos.x/Ae),ar=Math.floor(lt.pos.y/Ae),$n=Math.ceil((lt.pos.x+lt.width)/Ae),Vn=Math.ceil((lt.pos.y+lt.height)/Ae),Hn=new Set;for(let It=or;It<=$n;It++)for(let _t=ar;_t<=Vn;_t++)if(!pe[It])pe[It]={},pe[It][_t]=[Ce];else if(!pe[It][_t])pe[It][_t]=[Ce];else{let yn=pe[It][_t];e:for(let ft of yn){if(ft.paused||!ft.exists()||Hn.has(ft.id))continue;for(let Ne of Ce.collisionIgnore)if(ft.is(Ne))continue e;for(let Ne of ft.collisionIgnore)if(Ce.is(Ne))continue e;let zn=zl(Ce.worldArea(),ft.worldArea());if(zn){let Ne=new ct(Ce,ft,zn.normal,zn.distance);Ce.trigger("collideUpdate",ft,Ne);let wn=Ne.reverse();wn.resolved=Ne.resolved,ft.trigger("collideUpdate",Ce,wn)}Hn.add(ft.id)}yn.push(Ce)}}Ee.children.forEach(_e),xe=Oe.pop()}u(_e,"checkObj"),_e(S.root)}u(jn,"checkFrame");function sn(pe){console.error(pe),C.ctx.suspend();let Ae=pe.message??String(pe)??"Unknown error, check console for more info";h.run(()=>{},()=>{W(),cn(()=>{let xe=st(),Oe=ot(),_e={size:36,width:xe-32*2,letterSpacing:4,lineSpacing:4,font:Vs,fixed:!0};Mt({width:xe,height:Oe,color:Re(0,0,255),fixed:!0});let Ee=Fn({..._e,text:"Error",pos:L(32),color:Re(255,128,0),fixed:!0});Nn(Ee),Ki({..._e,text:Ae,pos:L(32,32+Ee.height+16),fixed:!0}),bt(),S.events.trigger("error",pe)}),re()})}u(sn,"handleErr");function Qe(pe){A.push(pe)}u(Qe,"onCleanup");function Wt(){S.events.onOnce("frameEnd",()=>{h.quit(),g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT|g.STENCIL_BUFFER_BIT);let pe=g.getParameter(g.MAX_TEXTURE_IMAGE_UNITS);for(let Ae=0;Ae<pe;Ae++)g.activeTexture(g.TEXTURE0+Ae),g.bindTexture(g.TEXTURE_2D,null),g.bindTexture(g.TEXTURE_CUBE_MAP,null);g.bindBuffer(g.ARRAY_BUFFER,null),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,null),g.bindRenderbuffer(g.RENDERBUFFER,null),g.bindFramebuffer(g.FRAMEBUFFER,null),b.destroy(),A.forEach(Ae=>Ae())})}u(Wt,"quit");let ht=!0;h.run(()=>{try{v.loaded&&(D.paused||Fe(),jn())}catch(pe){sn(pe)}},(pe,Ae)=>{try{pe(),v.loaded||kn()===1&&!ht&&(v.loaded=!0,vo().forEach(xe=>S.events.trigger("loadError",...xe)),S.events.trigger("load")),!v.loaded&&t.loadingScreen!==!1||ht?(W(),Ju(),re()):(D.paused||We(),jn(),W(),Xu(),t.debug!==!1&&Yu(),re()),ht&&(ht=!1),S.events.trigger("frameEnd"),Ae()}catch(xe){sn(xe)}}),qo(),Jo();let Dt={_k:m,VERSION:zd,loadRoot:Tu,loadProgress:kn,loadSprite:vr,loadSpriteAtlas:Co,loadSound:$u,loadMusic:Vu,loadBitmapFont:Fu,loadFont:ku,loadShader:Uu,loadShaderURL:_u,loadAseprite:Bu,loadPedit:Nu,loadBean:Du,loadJSON:Cu,load:Gs,getSound:To,getFont:Oo,getBitmapFont:Ro,getSprite:Eo,getShader:Mo,getAsset:Pu,Asset:Ut,SpriteData:qn,SoundData:hs,width:st,height:ot,center:cs,dt:nt,fixedDt:zs,restDt:Ks,time:h.time,screenshot:h.screenshot,record:ie,isFocused:fe,setCursor:h.setCursor,getCursor:h.getCursor,setCursorLocked:h.setCursorLocked,isCursorLocked:h.isCursorLocked,setFullscreen:h.setFullscreen,isFullscreen:h.isFullscreen,isTouchscreen:h.isTouchscreen,onLoad:Ai,onLoadError:vc,onLoading:Ac,onResize:xc,onGamepadConnect:h.onGamepadConnect,onGamepadDisconnect:h.onGamepadDisconnect,onError:bc,onCleanup:Qe,flash:Ko,setCamPos:_o,getCamPos:jo,setCamRot:Ho,getCamRot:zo,setCamScale:$o,getCamScale:Vo,getCamTransform:Ec,camPos:Oc,camScale:Rc,camFlash:Tc,camRot:Mc,camTransform:Sc,shake:Ic,toScreen:Js,toWorld:Go,setGravity:Cc,getGravity:Pc,setGravityDirection:Dc,getGravityDirection:Er,setBackground:vu,getBackground:Eu,getGamepads:h.getGamepads,getTreeRoot:_c,add:M,make:xi,destroy:Zo,destroyAll:z,get:_,query:he,readd:K,pos:ds,scale:gs,rotate:yh,color:Fo,opacity:No,anchor:ei,area:sh,sprite:Qs,text:zc,polygon:ac,rect:Uo,circle:tc,uvquad:Kc,outline:ic,particles:oc,body:ih,platformEffector:hh,surfaceEffector:ah,areaEffector:lh,pointEffector:uh,buoyancyEffector:fh,constantForce:ch,doubleJump:oh,shader:lc,textInput:nh,timer:Zs,fixed:sa,stay:ra,health:Qc,lifespan:Zc,named:eh,state:th,z:wh,layer:gh,move:ph,offscreen:mh,follow:dh,fadeIn:rc,mask:sc,drawon:nc,raycast:Lo,tile:ea,animate:Jc,serializeAnimation:na,agent:Gc,sentry:Xc,patrol:Yc,pathfinder:Wc,trigger:Md,on:St,onFixedUpdate:Td,onUpdate:Cd,onDraw:Pd,onAdd:hc,onDestroy:Dd,onTag:fc,onUntag:qd,onUse:Bd,onUnuse:kd,onClick:Fd,onCollide:dc,onCollideUpdate:gc,onCollideEnd:pc,onHover:mc,onHoverUpdate:yc,onHoverEnd:wc,onKeyDown:h.onKeyDown,onKeyPress:h.onKeyPress,onKeyPressRepeat:h.onKeyPressRepeat,onKeyRelease:h.onKeyRelease,onMouseDown:h.onMouseDown,onMousePress:h.onMousePress,onMouseRelease:h.onMouseRelease,onMouseMove:h.onMouseMove,onCharInput:h.onCharInput,onTouchStart:h.onTouchStart,onTouchMove:h.onTouchMove,onTouchEnd:h.onTouchEnd,onScroll:h.onScroll,onHide:h.onHide,onShow:h.onShow,onGamepadButtonDown:h.onGamepadButtonDown,onGamepadButtonPress:h.onGamepadButtonPress,onGamepadButtonRelease:h.onGamepadButtonRelease,onGamepadStick:h.onGamepadStick,onButtonPress:h.onButtonPress,onButtonDown:h.onButtonDown,onButtonRelease:h.onButtonRelease,mousePos:bo,mouseDeltaPos:h.mouseDeltaPos,isKeyDown:h.isKeyDown,isKeyPressed:h.isKeyPressed,isKeyPressedRepeat:h.isKeyPressedRepeat,isKeyReleased:h.isKeyReleased,isMouseDown:h.isMouseDown,isMousePressed:h.isMousePressed,isMouseReleased:h.isMouseReleased,isMouseMoved:h.isMouseMoved,isGamepadButtonPressed:h.isGamepadButtonPressed,isGamepadButtonDown:h.isGamepadButtonDown,isGamepadButtonReleased:h.isGamepadButtonReleased,getGamepadStick:h.getGamepadStick,isButtonPressed:h.isButtonPressed,isButtonDown:h.isButtonDown,isButtonReleased:h.isButtonReleased,setButton:h.setButton,getButton:h.getButton,pressButton:h.pressButton,releaseButton:h.releaseButton,getLastInputDeviceType:h.getLastInputDeviceType,charInputted:h.charInputted,loop:te,wait:$,play:kc,setVolume:Yo,getVolume:Xo,volume:qc,burp:Wo,audioCtx:C.ctx,Line:Pt,Rect:Ue,Circle:Tt,Ellipse:pn,Point:Nf,Polygon:Et,Vec2:V,Color:ve,Mat4:nn,Quad:ze,RNG:ul,rand:tt,randi:ro,randSeed:cl,vec2:L,rgb:Re,hsl2rgb:kf,quad:Xe,choose:dl,chooseMultiple:fl,shuffle:so,chance:hl,lerp:vt,tween:oe,easings:us,map:zt,mapc:ll,wave:no,deg2rad:Je,rad2deg:Bn,clamp:Kt,evaluateQuadratic:Tl,evaluateQuadraticFirstDerivative:Cl,evaluateQuadraticSecondDerivative:Pl,evaluateBezier:hi,evaluateBezierFirstDerivative:Dl,evaluateBezierSecondDerivative:Bl,evaluateCatmullRom:kl,evaluateCatmullRomFirstDerivative:ql,curveLengthApproximation:go,normalizedCurve:Fl,hermite:Xr,cardinal:po,catmullRom:as,bezier:Nl,kochanekBartels:Ll,easingSteps:Hl,easingLinear:$l,easingCubicBezier:Vl,testLineLine:ii,testRectRect:io,testRectLine:oi,testRectPoint:ps,testCirclePolygon:ys,testLinePoint:ai,testLineCircle:Yr,isConvex:Xl,triangulate:yo,NavMesh:xd,drawSprite:Zu,drawText:Ki,formatText:Fn,drawRect:Mt,drawLine:xr,drawLines:wi,drawTriangle:Bo,drawCircle:sr,drawEllipse:Po,drawUVQuad:Gr,drawPolygon:fn,drawCurve:Do,drawBezier:Gu,drawFormattedText:Nn,drawMasked:Qu,drawSubtracted:ec,pushTransform:Ot,popTransform:bt,pushTranslate:He,pushScale:Kr,pushRotate:er,pushMatrix:Su,usePostEffect:ee,makeCanvas:j,debug:D,scene:jc,getSceneName:Hc,go:$c,onSceneLeave:Vc,layers:Uc,getLayers:Nc,setLayers:Qo,getDefaultLayer:Lc,addLevel:uc,getData:N,setData:Y,download:di,downloadJSON:su,downloadText:Ao,downloadBlob:ji,plug:Q,ASCII_CHARS:Jl,canvas:h.canvas,addKaboom:Fc,LEFT:V.LEFT,RIGHT:V.RIGHT,UP:V.UP,DOWN:V.DOWN,RED:ve.RED,GREEN:ve.GREEN,BLUE:ve.BLUE,YELLOW:ve.YELLOW,MAGENTA:ve.MAGENTA,CYAN:ve.CYAN,WHITE:ve.WHITE,BLACK:ve.BLACK,quit:Wt,KEvent:xt,KEventHandler:ls,KEventController:tr,cancel:u(()=>Zl,"cancel")};m.k=Dt;let ir=t.plugins;if(ir&&ir.forEach(Q),t.global!==!1)for(let pe in Dt)window[pe]=Dt[pe];return t.focus!==!1&&h.canvas.focus(),Dt},"kaplay"),Gd=Kd,Ah=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ia(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var s=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:function(){return t[r]}})}),n}var oa={};ArrayBuffer.isView||(ArrayBuffer.isView=t=>t!==null&&typeof t=="object"&&t.buffer instanceof ArrayBuffer);typeof FormData>"u"&&(Ah.FormData=class{});typeof globalThis>"u"&&typeof window<"u"&&(window.globalThis=window);var aa={},Xi=function(t,e){return Xi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(n[s]=r[s])},Xi(t,e)};function xh(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Xi(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var ti=function(){return ti=Object.assign||function(e){for(var n,r=1,s=arguments.length;r<s;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ti.apply(this,arguments)};function bh(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n}function vh(t,e,n,r){var s=arguments.length,i=s<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,n,r);else for(var f=t.length-1;f>=0;f--)(a=t[f])&&(i=(s<3?a(i):s>3?a(e,n,i):a(e,n))||i);return s>3&&i&&Object.defineProperty(e,n,i),i}function Eh(t,e){return function(n,r){e(n,r,t)}}function Sh(t,e,n,r,s,i){function a(S){if(S!==void 0&&typeof S!="function")throw new TypeError("Function expected");return S}for(var f=r.kind,d=f==="getter"?"get":f==="setter"?"set":"value",h=!e&&t?r.static?t:t.prototype:null,A=e||(h?Object.getOwnPropertyDescriptor(h,r.name):{}),y,g=!1,b=n.length-1;b>=0;b--){var E={};for(var C in r)E[C]=C==="access"?{}:r[C];for(var C in r.access)E.access[C]=r.access[C];E.addInitializer=function(S){if(g)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(S||null))};var v=(0,n[b])(f==="accessor"?{get:A.get,set:A.set}:A[d],E);if(f==="accessor"){if(v===void 0)continue;if(v===null||typeof v!="object")throw new TypeError("Object expected");(y=a(v.get))&&(A.get=y),(y=a(v.set))&&(A.set=y),(y=a(v.init))&&s.unshift(y)}else(y=a(v))&&(f==="field"?s.unshift(y):A[d]=y)}h&&Object.defineProperty(h,r.name,A),g=!0}function Ih(t,e,n){for(var r=arguments.length>2,s=0;s<e.length;s++)n=r?e[s].call(t,n):e[s].call(t);return r?n:void 0}function Oh(t){return typeof t=="symbol"?t:"".concat(t)}function Rh(t,e,n){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(t,"name",{configurable:!0,value:n?"".concat(n," ",e):e})}function Mh(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Th(t,e,n,r){function s(i){return i instanceof n?i:new n(function(a){a(i)})}return new(n||(n=Promise))(function(i,a){function f(A){try{h(r.next(A))}catch(y){a(y)}}function d(A){try{h(r.throw(A))}catch(y){a(y)}}function h(A){A.done?i(A.value):s(A.value).then(f,d)}h((r=r.apply(t,e||[])).next())})}function Ch(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=f(0),a.throw=f(1),a.return=f(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function f(h){return function(A){return d([h,A])}}function d(h){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,h[0]&&(n=0)),n;)try{if(r=1,s&&(i=h[0]&2?s.return:h[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,h[1])).done)return i;switch(s=0,i&&(h=[h[0]&2,i.value]),h[0]){case 0:case 1:i=h;break;case 4:return n.label++,{value:h[1],done:!1};case 5:n.label++,s=h[1],h=[0];continue;case 7:h=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(h[0]===6||h[0]===2)){n=0;continue}if(h[0]===3&&(!i||h[1]>i[0]&&h[1]<i[3])){n.label=h[1];break}if(h[0]===6&&n.label<i[1]){n.label=i[1],i=h;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(h);break}i[2]&&n.ops.pop(),n.trys.pop();continue}h=e.call(t,n)}catch(A){h=[6,A],s=0}finally{r=i=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}var bi=Object.create?function(t,e,n,r){r===void 0&&(r=n);var s=Object.getOwnPropertyDescriptor(e,n);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,s)}:function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]};function Ph(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&bi(e,t,n)}function ni(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function la(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),s,i=[],a;try{for(;(e===void 0||e-- >0)&&!(s=r.next()).done;)i.push(s.value)}catch(f){a={error:f}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return i}function Dh(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(la(arguments[e]));return t}function Bh(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),s=0,e=0;e<n;e++)for(var i=arguments[e],a=0,f=i.length;a<f;a++,s++)r[s]=i[a];return r}function kh(t,e,n){if(n||arguments.length===2)for(var r=0,s=e.length,i;r<s;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))}function Wr(t){return this instanceof Wr?(this.v=t,this):new Wr(t)}function qh(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),s,i=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),f("next"),f("throw"),f("return",a),s[Symbol.asyncIterator]=function(){return this},s;function a(b){return function(E){return Promise.resolve(E).then(b,y)}}function f(b,E){r[b]&&(s[b]=function(C){return new Promise(function(v,S){i.push([b,C,v,S])>1||d(b,C)})},E&&(s[b]=E(s[b])))}function d(b,E){try{h(r[b](E))}catch(C){g(i[0][3],C)}}function h(b){b.value instanceof Wr?Promise.resolve(b.value.v).then(A,y):g(i[0][2],b)}function A(b){d("next",b)}function y(b){d("throw",b)}function g(b,E){b(E),i.shift(),i.length&&d(i[0][0],i[0][1])}}function Fh(t){var e,n;return e={},r("next"),r("throw",function(s){throw s}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(s,i){e[s]=t[s]?function(a){return(n=!n)?{value:Wr(t[s](a)),done:!1}:i?i(a):a}:i}}function Nh(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof ni=="function"?ni(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(i){n[i]=t[i]&&function(a){return new Promise(function(f,d){a=t[i](a),s(f,d,a.done,a.value)})}}function s(i,a,f,d){Promise.resolve(d).then(function(h){i({value:h,done:f})},a)}}function Lh(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var Wd=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e},Ji=function(t){return Ji=Object.getOwnPropertyNames||function(e){var n=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[n.length]=r);return n},Ji(t)};function Uh(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n=Ji(t),r=0;r<n.length;r++)n[r]!=="default"&&bi(e,t,n[r]);return Wd(e,t),e}function _h(t){return t&&t.__esModule?t:{default:t}}function jh(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)}function $h(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n}function Vh(t,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof t=="function"?e===t:t.has(e)}function Hh(t,e,n){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],n&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),t.stack.push({value:e,dispose:r,async:n})}else n&&t.stack.push({async:!0});return e}var Yd=typeof SuppressedError=="function"?SuppressedError:function(t,e,n){var r=new Error(n);return r.name="SuppressedError",r.error=t,r.suppressed=e,r};function zh(t){function e(i){t.error=t.hasError?new Yd(i,t.error,"An error was suppressed during disposal."):i,t.hasError=!0}var n,r=0;function s(){for(;n=t.stack.pop();)try{if(!n.async&&r===1)return r=0,t.stack.push(n),Promise.resolve().then(s);if(n.dispose){var i=n.dispose.call(n.value);if(n.async)return r|=2,Promise.resolve(i).then(s,function(a){return e(a),s()})}else r|=1}catch(a){e(a)}if(r===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return s()}function Kh(t,e){return typeof t=="string"&&/^\.\.?\//.test(t)?t.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(n,r,s,i,a){return r?e?".jsx":".js":s&&(!i||!a)?n:s+i+"."+a.toLowerCase()+"js"}):t}const Xd={__extends:xh,__assign:ti,__rest:bh,__decorate:vh,__param:Eh,__esDecorate:Sh,__runInitializers:Ih,__propKey:Oh,__setFunctionName:Rh,__metadata:Mh,__awaiter:Th,__generator:Ch,__createBinding:bi,__exportStar:Ph,__values:ni,__read:la,__spread:Dh,__spreadArrays:Bh,__spreadArray:kh,__await:Wr,__asyncGenerator:qh,__asyncDelegator:Fh,__asyncValues:Nh,__makeTemplateObject:Lh,__importStar:Uh,__importDefault:_h,__classPrivateFieldGet:jh,__classPrivateFieldSet:$h,__classPrivateFieldIn:Vh,__addDisposableResource:Hh,__disposeResources:zh,__rewriteRelativeImportExtension:Kh},Jd=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:Hh,get __assign(){return ti},__asyncDelegator:Fh,__asyncGenerator:qh,__asyncValues:Nh,__await:Wr,__awaiter:Th,__classPrivateFieldGet:jh,__classPrivateFieldIn:Vh,__classPrivateFieldSet:$h,__createBinding:bi,__decorate:vh,__disposeResources:zh,__esDecorate:Sh,__exportStar:Ph,__extends:xh,__generator:Ch,__importDefault:_h,__importStar:Uh,__makeTemplateObject:Lh,__metadata:Mh,__param:Eh,__propKey:Oh,__read:la,__rest:bh,__rewriteRelativeImportExtension:Kh,__runInitializers:Ih,__setFunctionName:Rh,__spread:Dh,__spreadArray:kh,__spreadArrays:Bh,__values:ni,default:Xd},Symbol.toStringTag,{value:"Module"})),vi=ia(Jd);var bs={};(function(t){t.CloseCode=void 0,function(n){n[n.CONSENTED=4e3]="CONSENTED",n[n.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(t.CloseCode||(t.CloseCode={}));class e extends Error{constructor(r,s){super(s),this.name="ServerError",this.code=r}}t.ServerError=e})(bs);var ua={},Gh={},Wh={},Qi={exports:{}};(function(t,e){(function(n,r){r(e)})(Ah,function(n){n.OPERATION=void 0,function(w){w[w.ADD=128]="ADD",w[w.REPLACE=0]="REPLACE",w[w.DELETE=64]="DELETE",w[w.DELETE_AND_MOVE=96]="DELETE_AND_MOVE",w[w.MOVE_AND_ADD=160]="MOVE_AND_ADD",w[w.DELETE_AND_ADD=192]="DELETE_AND_ADD",w[w.CLEAR=10]="CLEAR",w[w.REVERSE=15]="REVERSE",w[w.MOVE=32]="MOVE",w[w.DELETE_BY_REFID=33]="DELETE_BY_REFID",w[w.ADD_BY_REFID=129]="ADD_BY_REFID"}(n.OPERATION||(n.OPERATION={})),Symbol.metadata??(Symbol.metadata=Symbol.for("Symbol.metadata"));const i=Symbol("$track"),a=Symbol("$encoder"),f=Symbol("$decoder"),d=Symbol("$filter"),h=Symbol("$getByIndex"),A=Symbol("$deleteByIndex"),y=Symbol("$changes"),g=Symbol("$childType"),b=Symbol("$onEncodeEnd"),E=Symbol("$onDecodeEnd"),C=Symbol("$descriptors"),v="$__numFields",S="$__refTypeFieldIndexes",j="$__viewFieldIndexes",W="$__fieldIndexesByViewTag";let ee;try{ee=new TextEncoder}catch{}const re=new ArrayBuffer(8),R=new Int32Array(re),D=new Float32Array(re),N=new Float64Array(re),Y=new BigInt64Array(re),ie=typeof Buffer<"u"&&Buffer.byteLength?Buffer.byteLength:function(w,o){for(var l=0,c=0,p=0,x=w.length;p<x;p++)l=w.charCodeAt(p),l<128?c+=1:l<2048?c+=2:l<55296||l>=57344?c+=3:(p++,c+=4);return c};function fe(w,o,l){for(var c=0,p=0,x=o.length;p<x;p++)c=o.charCodeAt(p),c<128?w[l.offset++]=c:c<2048?(w[l.offset]=192|c>>6,w[l.offset+1]=128|c&63,l.offset+=2):c<55296||c>=57344?(w[l.offset]=224|c>>12,w[l.offset+1]=128|c>>6&63,w[l.offset+2]=128|c&63,l.offset+=3):(p++,c=65536+((c&1023)<<10|o.charCodeAt(p)&1023),w[l.offset]=240|c>>18,w[l.offset+1]=128|c>>12&63,w[l.offset+2]=128|c>>6&63,w[l.offset+3]=128|c&63,l.offset+=4)}function M(w,o,l){w[l.offset++]=o&255}function K(w,o,l){w[l.offset++]=o&255}function z(w,o,l){w[l.offset++]=o&255,w[l.offset++]=o>>8&255}function _(w,o,l){w[l.offset++]=o&255,w[l.offset++]=o>>8&255}function $(w,o,l){w[l.offset++]=o&255,w[l.offset++]=o>>8&255,w[l.offset++]=o>>16&255,w[l.offset++]=o>>24&255}function te(w,o,l){const c=o>>24,p=o>>16,x=o>>8,O=o;w[l.offset++]=O&255,w[l.offset++]=x&255,w[l.offset++]=p&255,w[l.offset++]=c&255}function he(w,o,l){const c=Math.floor(o/Math.pow(2,32)),p=o>>>0;te(w,p,l),te(w,c,l)}function oe(w,o,l){const c=o/Math.pow(2,32)>>0,p=o>>>0;te(w,p,l),te(w,c,l)}function ye(w,o,l){Y[0]=BigInt.asIntN(64,o),$(w,R[0],l),$(w,R[1],l)}function le(w,o,l){Y[0]=BigInt.asIntN(64,o),$(w,R[0],l),$(w,R[1],l)}function Fe(w,o,l){D[0]=o,$(w,R[0],l)}function We(w,o,l){N[0]=o,$(w,R[0],l),$(w,R[1],l)}function ct(w,o,l){w[l.offset++]=o?1:0}function jn(w,o,l){o||(o="");let c=ie(o,"utf8"),p=0;if(c<32)w[l.offset++]=c|160,p=1;else if(c<256)w[l.offset++]=217,w[l.offset++]=c%255,p=2;else if(c<65536)w[l.offset++]=218,_(w,c,l),p=3;else if(c<4294967296)w[l.offset++]=219,te(w,c,l),p=5;else throw new Error("String too long");return fe(w,o,l),p+c}function sn(w,o,l){if(isNaN(o))return sn(w,0,l);if(isFinite(o)){if(o!==(o|0))return Math.abs(o)<=34028235e31&&(D[0]=o,Math.abs(Math.abs(D[0])-Math.abs(o))<1e-4)?(w[l.offset++]=202,Fe(w,o,l),5):(w[l.offset++]=203,We(w,o,l),9)}else return sn(w,o>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER,l);return o>=0?o<128?(w[l.offset++]=o&255,1):o<256?(w[l.offset++]=204,w[l.offset++]=o&255,2):o<65536?(w[l.offset++]=205,_(w,o,l),3):o<4294967296?(w[l.offset++]=206,te(w,o,l),5):(w[l.offset++]=207,oe(w,o,l),9):o>=-32?(w[l.offset++]=224|o+32,1):o>=-128?(w[l.offset++]=208,M(w,o,l),2):o>=-32768?(w[l.offset++]=209,z(w,o,l),3):o>=-2147483648?(w[l.offset++]=210,$(w,o,l),5):(w[l.offset++]=211,he(w,o,l),9)}const Qe={int8:M,uint8:K,int16:z,uint16:_,int32:$,uint32:te,int64:he,uint64:oe,bigint64:ye,biguint64:le,float32:Fe,float64:We,boolean:ct,string:jn,number:sn,utf8Write:fe,utf8Length:ie},Wt=new ArrayBuffer(8),ht=new Int32Array(Wt),Dt=new Float32Array(Wt),ir=new Float64Array(Wt),on=new BigUint64Array(Wt),pe=new BigInt64Array(Wt);function Ae(w,o,l){for(var c="",p=0,x=o.offset,O=o.offset+l;x<O;x++){var B=w[x];if(!(B&128)){c+=String.fromCharCode(B);continue}if((B&224)===192){c+=String.fromCharCode((B&31)<<6|w[++x]&63);continue}if((B&240)===224){c+=String.fromCharCode((B&15)<<12|(w[++x]&63)<<6|(w[++x]&63)<<0);continue}if((B&248)===240){p=(B&7)<<18|(w[++x]&63)<<12|(w[++x]&63)<<6|(w[++x]&63)<<0,p>=65536?(p-=65536,c+=String.fromCharCode((p>>>10)+55296,(p&1023)+56320)):c+=String.fromCharCode(p);continue}console.error("Invalid byte "+B.toString(16))}return o.offset+=l,c}function xe(w,o){return Oe(w,o)<<24>>24}function Oe(w,o){return w[o.offset++]}function _e(w,o){return Ee(w,o)<<16>>16}function Ee(w,o){return w[o.offset++]|w[o.offset++]<<8}function Ce(w,o){return w[o.offset++]|w[o.offset++]<<8|w[o.offset++]<<16|w[o.offset++]<<24}function lt(w,o){return Ce(w,o)>>>0}function or(w,o){return ht[0]=Ce(w,o),Dt[0]}function ar(w,o){return ht[0]=Ce(w,o),ht[1]=Ce(w,o),ir[0]}function $n(w,o){const l=lt(w,o);return Ce(w,o)*Math.pow(2,32)+l}function Vn(w,o){const l=lt(w,o);return lt(w,o)*Math.pow(2,32)+l}function Hn(w,o){return ht[0]=Ce(w,o),ht[1]=Ce(w,o),pe[0]}function It(w,o){return ht[0]=Ce(w,o),ht[1]=Ce(w,o),on[0]}function _t(w,o){return Oe(w,o)>0}function yn(w,o){const l=w[o.offset++];let c;return l<192?c=l&31:l===217?c=Oe(w,o):l===218?c=Ee(w,o):l===219&&(c=lt(w,o)),Ae(w,o,c)}function ft(w,o){const l=w[o.offset++];if(l<128)return l;if(l===202)return or(w,o);if(l===203)return ar(w,o);if(l===204)return Oe(w,o);if(l===205)return Ee(w,o);if(l===206)return lt(w,o);if(l===207)return Vn(w,o);if(l===208)return xe(w,o);if(l===209)return _e(w,o);if(l===210)return Ce(w,o);if(l===211)return $n(w,o);if(l>223)return(255-l+1)*-1}function zn(w,o){const l=w[o.offset];return l<192&&l>160||l===217||l===218||l===219}const Ne={utf8Read:Ae,int8:xe,uint8:Oe,int16:_e,uint16:Ee,int32:Ce,uint32:lt,float32:or,float64:ar,int64:$n,uint64:Vn,bigint64:Hn,biguint64:It,boolean:_t,string:yn,number:ft,stringCheck:zn},wn={},Ss=new Map;function dt(w,o){o.constructor&&(Ss.set(o.constructor,w),wn[w]=o),o.encode&&(Qe[w]=o.encode),o.decode&&(Ne[w]=o.decode)}function An(w){return wn[w]}function Is(w){for(const o in w)dt(o,w[o]);return o=>jt(o)}const Xt=class Xt{static register(o){const l=Object.getPrototypeOf(o);if(l!==Ye){let c=Xt.inheritedTypes.get(l);c||(c=new Set,Xt.inheritedTypes.set(l,c)),c.add(o)}}static cache(o){let l=Xt.cachedContexts.get(o);return l||(l=new Xt(o),Xt.cachedContexts.set(o,l)),l}constructor(o){this.types={},this.schemas=new Map,this.hasFilters=!1,this.parentFiltered={},o&&this.discoverTypes(o)}has(o){return this.schemas.has(o)}get(o){return this.types[o]}add(o,l=this.schemas.size){return this.schemas.has(o)?!1:(this.types[l]=o,o[Symbol.metadata]===void 0&&je.initialize(o),this.schemas.set(o,l),!0)}getTypeId(o){return this.schemas.get(o)}discoverTypes(o,l,c,p){var B,k;if(p&&this.registerFilteredByParent(o,l,c),!this.add(o))return;(B=Xt.inheritedTypes.get(o))==null||B.forEach(H=>{this.discoverTypes(H,l,c,p)});let x=o;for(;(x=Object.getPrototypeOf(x))&&x!==Ye&&x!==Function.prototype;)this.discoverTypes(x);const O=o[k=Symbol.metadata]??(o[k]={});O[j]&&(this.hasFilters=!0);for(const H in O){const J=H,ne=O[J].type,Z=O[J].tag!==void 0;if(typeof ne!="string")if(Array.isArray(ne)){const ce=ne[0];if(ce==="string")continue;this.discoverTypes(ce,o,J,p||Z)}else if(typeof ne=="function")this.discoverTypes(ne,o,J,p||Z);else{const ce=Object.values(ne)[0];if(typeof ce=="string")continue;this.discoverTypes(ce,o,J,p||Z)}}}registerFilteredByParent(o,l,c){let x=`${this.schemas.get(o)??this.schemas.size}`;l&&(x+=`-${this.schemas.get(l)}`),x+=`-${c}`,this.parentFiltered[x]=!0}debug(){let o="";for(const l in this.parentFiltered){const c=l.split("-").map(Number),p=c.pop();o+=`
		`,o+=`${l}: ${c.reverse().map((x,O)=>{const B=this.types[x],k=B[Symbol.metadata];let H=B.name;return O===0&&(H+=`[${k[p].name}]`),`${H}`}).join(" -> ")}`}return`TypeContext ->
	Schema types: ${this.schemas.size}
	hasFilters: ${this.hasFilters}
	parentFiltered:${o}`}};Xt.inheritedTypes=new Map,Xt.cachedContexts=new Map;let ke=Xt;function lr(w){return Array.isArray(w)?{array:w[0]}:typeof w.type<"u"?w.type:w}const je={addField(w,o,l,c,p){if(o>64)throw new Error(`Can't define field '${l}'.
Schema instances may only have up to 64 fields.`);w[o]=Object.assign(w[o]||{},{type:lr(c),index:o,name:l}),Object.defineProperty(w,C,{value:w[C]||{},enumerable:!1,configurable:!0}),p?(w[C][l]=p,w[C][`_${l}`]={value:void 0,writable:!0,enumerable:!1,configurable:!0}):w[C][l]={value:void 0,writable:!0,enumerable:!0,configurable:!0},Object.defineProperty(w,v,{value:o,enumerable:!1,configurable:!0}),Object.defineProperty(w,l,{value:o,enumerable:!1,configurable:!0}),typeof w[o].type!="string"&&(w[S]===void 0&&Object.defineProperty(w,S,{value:[],enumerable:!1,configurable:!0}),w[S].push(o))},setTag(w,o,l){const c=w[o],p=w[c];p.tag=l,w[j]||(Object.defineProperty(w,j,{value:[],enumerable:!1,configurable:!0}),Object.defineProperty(w,W,{value:{},enumerable:!1,configurable:!0})),w[j].push(c),w[W][l]||(w[W][l]=[]),w[W][l].push(c)},setFields(w,o){const l=w.prototype.constructor;ke.register(l);const c=Object.getPrototypeOf(l),p=c&&c[Symbol.metadata],x=je.initialize(l);l[i]||(l[i]=Ye[i]),l[a]||(l[a]=Ye[a]),l[f]||(l[f]=Ye[f]),l.prototype.toJSON||(l.prototype.toJSON=Ye.prototype.toJSON);let O=x[v]??(p&&p[v])??-1;O++;for(const B in o){const k=o[B],H=Array.isArray(k)?An("array"):typeof Object.keys(k)[0]=="string"&&An(Object.keys(k)[0]),J=H?Object.values(k)[0]:lr(k);je.addField(x,O,B,k,Ia(`_${B}`,O,J,H)),O++}return w},isDeprecated(w,o){return w[o].deprecated===!0},init(w){const o={};w[Symbol.metadata]=o,Object.defineProperty(o,v,{value:0,enumerable:!1,configurable:!0})},initialize(w){const o=Object.getPrototypeOf(w),l=o[Symbol.metadata];let c=w[Symbol.metadata]??Object.create(null);return o!==Ye&&c===l&&(c=Object.create(null),l&&(Object.setPrototypeOf(c,l),Object.defineProperty(c,v,{value:l[v],enumerable:!1,configurable:!0,writable:!0}),l[j]!==void 0&&(Object.defineProperty(c,j,{value:[...l[j]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(c,W,{value:{...l[W]},enumerable:!1,configurable:!0,writable:!0})),l[S]!==void 0&&Object.defineProperty(c,S,{value:[...l[S]],enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(c,C,{value:{...l[C]},enumerable:!1,configurable:!0,writable:!0}))),w[Symbol.metadata]=c,c},isValidInstance(w){return w.constructor[Symbol.metadata]&&Object.prototype.hasOwnProperty.call(w.constructor[Symbol.metadata],v)},getFields(w){const o=w[Symbol.metadata],l={};for(let c=0;c<=o[v];c++)l[o[c].name]=o[c].type;return l}};function gt(w,o){const l=w.indexes[o];l===void 0?w.indexes[o]=w.operations.push(o)-1:w.operations[l]=o}function Jr(w,o){const l=w.indexes[o];l!==void 0&&(w.operations[l]=void 0),delete w.indexes[o]}function pt(w,o,l,c=o[l].queueRootIndex){w&&w[l][c]!==o&&(o[l].queueRootIndex=w[l].push(o)-1)}class an{constructor(o){this.isFiltered=!1,this.indexedOperations={},this.changes={indexes:{},operations:[]},this.allChanges={indexes:{},operations:[]},this.isNew=!0,this.ref=o;const l=o.constructor[Symbol.metadata];l!=null&&l[j]&&(this.allFilteredChanges={indexes:{},operations:[]},this.filteredChanges={indexes:{},operations:[]})}setRoot(o){var c;this.root=o,this.checkIsFiltered(this.parent,this.parentIndex);const l=this.ref.constructor[Symbol.metadata];l?(c=l[S])==null||c.forEach(p=>{const x=l[p],O=this.ref[x.name];O==null||O[y].setRoot(o)}):this.ref[g]&&typeof this.ref[g]!="string"&&this.ref.forEach((p,x)=>{p[y].setRoot(o)})}setParent(o,l,c){var x;if(this.parent=o,this.parentIndex=c,!l)return;l!==this.root?(this.root=l,this.checkIsFiltered(o,c)):l.add(this);const p=this.ref.constructor[Symbol.metadata];p?(x=p[S])==null||x.forEach(O=>{const B=p[O],k=this.ref[B.name];k==null||k[y].setParent(this.ref,l,O)}):this.ref[g]&&typeof this.ref[g]!="string"&&this.ref.forEach((O,B)=>{O[y].setParent(this.ref,l,this.indexes[B]??B)})}forEachChild(o){var c;const l=this.ref.constructor[Symbol.metadata];l?(c=l[S])==null||c.forEach(p=>{const x=l[p],O=this.ref[x.name];O&&o(O[y],p)}):this.ref[g]&&typeof this.ref[g]!="string"&&this.ref.forEach((p,x)=>{o(p[y],this.indexes[x]??x)})}operation(o){this.changes.operations.push(-o),pt(this.root,this,"changes")}change(o,l=n.OPERATION.ADD){var B;const c=this.ref.constructor[Symbol.metadata],p=this.isFiltered||((B=c==null?void 0:c[o])==null?void 0:B.tag)!==void 0,x=p?this.filteredChanges:this.changes,O=this.indexedOperations[o];if(!O||O===n.OPERATION.DELETE){const k=O&&O===n.OPERATION.DELETE?n.OPERATION.DELETE_AND_ADD:l;this.indexedOperations[o]=k}gt(x,o),p?(gt(this.allFilteredChanges,o),this.root&&(pt(this.root,this,"filteredChanges"),pt(this.root,this,"allFilteredChanges"))):(gt(this.allChanges,o),pt(this.root,this,"changes"))}shiftChangeIndexes(o){const l=this.isFiltered?this.filteredChanges:this.changes,c={},p={};for(const x in this.indexedOperations)c[Number(x)+o]=this.indexedOperations[x],p[Number(x)+o]=l[x];this.indexedOperations=c,l.indexes=p,l.operations=l.operations.map(x=>x+o)}shiftAllChangeIndexes(o,l=0){this.filteredChanges!==void 0?(this._shiftAllChangeIndexes(o,l,this.allFilteredChanges),this._shiftAllChangeIndexes(o,l,this.allChanges)):this._shiftAllChangeIndexes(o,l,this.allChanges)}_shiftAllChangeIndexes(o,l=0,c){const p={};for(const x in c.indexes){const O=c.indexes[x];O>l?p[Number(x)+o]=O:p[x]=O}c.indexes=p;for(let x=0;x<c.operations.length;x++){const O=c.operations[x];O>l&&(c.operations[x]=O+o)}}indexedOperation(o,l,c=o){this.indexedOperations[o]=l,this.filteredChanges!==void 0?(gt(this.allFilteredChanges,c),gt(this.filteredChanges,o),pt(this.root,this,"filteredChanges")):(gt(this.allChanges,c),gt(this.changes,o),pt(this.root,this,"changes"))}getType(o){return je.isValidInstance(this.ref)?this.ref.constructor[Symbol.metadata][o].type:this.ref[g]}getChange(o){return this.indexedOperations[o]}getValue(o,l=!1){return this.ref[h](o,l)}delete(o,l,c=o){var O;if(o===void 0){try{throw new Error(`@colyseus/schema ${this.ref.constructor.name}: trying to delete non-existing index '${o}'`)}catch(B){console.warn(B)}return}const p=this.filteredChanges!==void 0?this.filteredChanges:this.changes;this.indexedOperations[o]=l??n.OPERATION.DELETE,gt(p,o);const x=this.getValue(o);return x&&x[y]&&((O=this.root)==null||O.remove(x[y])),Jr(this.allChanges,c),this.filteredChanges!==void 0?(Jr(this.allFilteredChanges,c),pt(this.root,this,"filteredChanges")):pt(this.root,this,"changes"),x}endEncode(){var o,l;this.indexedOperations={},(l=(o=this.ref)[b])==null||l.call(o),this.isNew=!1}discard(o=!1){var l,c;(c=(l=this.ref)[b])==null||c.call(l),this.indexedOperations={},this.changes.indexes={},this.changes.operations.length=0,this.changes.queueRootIndex=void 0,this.filteredChanges!==void 0&&(this.filteredChanges.indexes={},this.filteredChanges.operations.length=0,this.filteredChanges.queueRootIndex=void 0),o&&(this.allChanges.indexes={},this.allChanges.operations.length=0,this.allFilteredChanges!==void 0&&(this.allFilteredChanges.indexes={},this.allFilteredChanges.operations.length=0),this.forEachChild((p,x)=>{var O;return(O=this.root)==null?void 0:O.remove(p)}))}discardAll(){const o=Object.keys(this.indexedOperations);for(let l=0,c=o.length;l<c;l++){const p=this.getValue(Number(o[l]));p&&p[y]&&p[y].discardAll()}this.discard()}ensureRefId(){this.refId===void 0&&(this.refId=this.root.getNextUniqueId())}get changed(){return Object.entries(this.indexedOperations).length>0}checkIsFiltered(o,l){const c=this.root.add(this);this.root.types.hasFilters&&(this._checkFilteredByParent(o,l),this.filteredChanges!==void 0&&(pt(this.root,this,"filteredChanges"),c&&this.root.allFilteredChanges.push(this))),this.isFiltered||(pt(this.root,this,"changes"),c&&this.root.allChanges.push(this))}_checkFilteredByParent(o,l){var O,B;if(!o)return;const c=je.isValidInstance(this.ref)?this.ref.constructor:this.ref[g];if(!je.isValidInstance(o)){const k=o[y];o=k.parent,l=k.parentIndex}const p=o.constructor;let x=`${this.root.types.getTypeId(c)}`;if(p&&(x+=`-${this.root.types.schemas.get(p)}`),x+=`-${l}`,this.isFiltered=o[y].isFiltered||this.root.types.parentFiltered[x]||((B=(O=p==null?void 0:p[Symbol.metadata])==null?void 0:O[j])==null?void 0:B.includes(l)),this.isFiltered&&(this.filteredChanges={indexes:{},operations:[]},this.allFilteredChanges={indexes:{},operations:[]},this.changes.operations.length>0)){const k=this.changes;this.changes=this.filteredChanges,this.filteredChanges=k;const H=this.allFilteredChanges;this.allFilteredChanges=this.allChanges,this.allChanges=H}}}function ur(w,o,l,c,p,x){var O;typeof l=="string"?(O=Qe[l])==null||O.call(Qe,o,c,x):l[Symbol.metadata]!==void 0?(Qe.number(o,c[y].refId,x),(p&n.OPERATION.ADD)===n.OPERATION.ADD&&w.tryEncodeTypeId(o,l,c.constructor,x)):Qe.number(o,c[y].refId,x)}const I=function(w,o,l,c,p,x,O,B,k){if(o[x.offset++]=(c|p)&255,p===n.OPERATION.DELETE)return;const H=l.ref,J=k[c];ur(w,o,k[c].type,H[J.name],p,x)},U=function(w,o,l,c,p,x){if(o[x.offset++]=p&255,p===n.OPERATION.CLEAR||(Qe.number(o,c,x),p===n.OPERATION.DELETE))return;const O=l.ref;if((p&n.OPERATION.ADD)===n.OPERATION.ADD&&typeof O.set=="function"){const H=l.ref.$indexes.get(c);Qe.string(o,H,x)}const B=O[g],k=O[h](c);ur(w,o,B,k,p,x)},G=function(w,o,l,c,p,x,O,B){const k=l.ref,H=B&&l.isFiltered&&typeof l.getType(c)!="string";let J;if(H?(J=k.tmpItems[c][y].refId,p===n.OPERATION.DELETE?p=n.OPERATION.DELETE_BY_REFID:p===n.OPERATION.ADD&&(p=n.OPERATION.ADD_BY_REFID)):J=c,o[x.offset++]=p&255,p===n.OPERATION.CLEAR||p===n.OPERATION.REVERSE||(Qe.number(o,J,x),p===n.OPERATION.DELETE))return;const ne=l.getType(c),Z=l.getValue(c,O);ur(w,o,ne,Z,p,x)},se=-1;function we(w,o,l,c,p,x,O,B){const k=w.root,H=l[h](c);let J;if((o&n.OPERATION.DELETE)===n.OPERATION.DELETE){const ne=k.refIds.get(H);ne!==void 0&&k.removeRef(ne),o!==n.OPERATION.DELETE_AND_ADD&&l[A](c),J=void 0}if(o!==n.OPERATION.DELETE)if(Ye.is(p)){const ne=Ne.number(x,O);if(J=k.refs.get(ne),(o&n.OPERATION.ADD)===n.OPERATION.ADD){const Z=w.getInstanceType(x,O,p);J||(J=w.createInstanceOfType(Z)),k.addRef(ne,J,J!==H||o===n.OPERATION.DELETE_AND_ADD&&J===H)}}else if(typeof p=="string")J=Ne[p](x,O);else{const ne=An(Object.keys(p)[0]),Z=Ne.number(x,O),ce=k.refs.has(Z)?H||k.refs.get(Z):new ne.constructor;if(J=ce.clone(!0),J[g]=Object.values(p)[0],H){let ge=k.refIds.get(H);if(ge!==void 0&&Z!==ge){const ae=H.entries();let X;for(;(X=ae.next())&&!X.done;){const[de,Me]=X.value;typeof Me=="object"&&(ge=k.refIds.get(Me),k.removeRef(ge)),B.push({ref:H,refId:ge,op:n.OPERATION.DELETE,field:de,value:void 0,previousValue:Me})}}}k.addRef(Z,J,ce!==H||o===n.OPERATION.DELETE_AND_ADD&&ce===H)}return{value:J,previousValue:H}}const Pe=function(w,o,l,c,p){const x=o[l.offset++],O=c.constructor[Symbol.metadata],B=x>>6<<6,k=x%(B||255),H=O[k];if(H===void 0)return console.warn("@colyseus/schema: field not defined at",{index:k,ref:c.constructor.name,metadata:O}),se;const{value:J,previousValue:ne}=we(w,B,c,k,H.type,o,l,p);J!=null&&(c[H.name]=J),ne!==J&&p.push({ref:c,refId:w.currentRefId,op:B,field:H.name,value:J,previousValue:ne})},Ke=function(w,o,l,c,p){const x=o[l.offset++];if(x===n.OPERATION.CLEAR){w.removeChildRefs(c,p),c.clear();return}const O=Ne.number(o,l),B=c[g];let k;(x&n.OPERATION.ADD)===n.OPERATION.ADD?typeof c.set=="function"?(k=Ne.string(o,l),c.setIndex(O,k)):k=O:k=c.getIndex(O);const{value:H,previousValue:J}=we(w,x,c,O,B,o,l,p);if(H!=null){if(typeof c.set=="function")c.$items.set(k,H);else if(typeof c.$setAt=="function")c.$setAt(O,H,x);else if(typeof c.add=="function"){const ne=c.add(H);typeof ne=="number"&&c.setIndex(ne,ne)}}J!==H&&p.push({ref:c,refId:w.currentRefId,op:x,field:"",dynamicIndex:k,value:H,previousValue:J})},$e=function(w,o,l,c,p){let x=o[l.offset++],O;if(x===n.OPERATION.CLEAR){w.removeChildRefs(c,p),c.clear();return}else if(x===n.OPERATION.REVERSE){c.reverse();return}else if(x===n.OPERATION.DELETE_BY_REFID){const ne=Ne.number(o,l),Z=w.root.refs.get(ne);O=c.findIndex(ce=>ce===Z),c[A](O),p.push({ref:c,refId:w.currentRefId,op:n.OPERATION.DELETE,field:"",dynamicIndex:O,value:void 0,previousValue:Z});return}else if(x===n.OPERATION.ADD_BY_REFID){const ne=Ne.number(o,l),Z=w.root.refs.get(ne);O=Z?c.findIndex(ce=>ce===Z):c.length}else O=Ne.number(o,l);const B=c[g];let k=O;const{value:H,previousValue:J}=we(w,x,c,O,B,o,l,p);H!=null&&H!==J&&c.$setAt(O,H,x),J!==H&&p.push({ref:c,refId:w.currentRefId,op:x,field:"",dynamicIndex:k,value:H,previousValue:J})};class Bt extends Error{}function kt(w,o,l,c){let p,x=!1;switch(o){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":p="number",isNaN(w)&&console.log(`trying to encode "NaN" in ${l.constructor.name}#${c}`);break;case"bigint64":case"biguint64":p="bigint";break;case"string":p="string",x=!0;break;case"boolean":return;default:return}if(typeof w!==p&&(!x||x&&w!==null)){let O=`'${JSON.stringify(w)}'${w&&w.constructor&&` (${w.constructor.name})`||""}`;throw new Bt(`a '${p}' was expected, but ${O} was provided in ${l.constructor.name}#${c}`)}}function mt(w,o,l,c){if(!(w instanceof o))throw new Bt(`a '${o.name}' was expected, but '${w&&w.constructor.name}' was provided in ${l.constructor.name}#${c}`)}var xa,ba;const xf=(w,o)=>{const l=w.toString(),c=o.toString();return l<c?-1:l>c?1:0},$t=class $t{static[(xa=a,ba=f,d)](o,l,c){var p;return!c||typeof o[g]=="string"||c.visible.has((p=o.tmpItems[l])==null?void 0:p[y])}static is(o){return Array.isArray(o)||o.array!==void 0}static from(o){return new $t(...Array.from(o))}constructor(...o){this.items=[],this.tmpItems=[],this.deletedIndexes={},Object.defineProperty(this,g,{value:void 0,enumerable:!1,writable:!0,configurable:!0});const l=new Proxy(this,{get:(c,p)=>typeof p!="symbol"&&!isNaN(p)?this.items[p]:Reflect.get(c,p),set:(c,p,x)=>{var O;if(typeof p!="symbol"&&!isNaN(p)){if(x==null)c.$deleteAt(p);else{if(x[y]){mt(x,c[g],c,p);const B=c.items[p];B!==void 0?(x[y].isNew?this[y].indexedOperation(Number(p),n.OPERATION.MOVE_AND_ADD):(c[y].getChange(Number(p))&n.OPERATION.DELETE)===n.OPERATION.DELETE?this[y].indexedOperation(Number(p),n.OPERATION.DELETE_AND_MOVE):this[y].indexedOperation(Number(p),n.OPERATION.MOVE),(O=B[y].root)==null||O.remove(B[y])):x[y].isNew&&this[y].indexedOperation(Number(p),n.OPERATION.ADD),x[y].setParent(this,c[y].root,p)}else c.$changeAt(Number(p),x);this.items[p]=x,this.tmpItems[p]=x}return!0}else return Reflect.set(c,p,x)},deleteProperty:(c,p)=>(typeof p=="number"?c.$deleteAt(p):delete c[p],!0),has:(c,p)=>typeof p!="symbol"&&!isNaN(Number(p))?Reflect.has(this.items,p):Reflect.has(c,p)});return this[y]=new an(l),this[y].indexes={},o.length>0&&this.push(...o),l}set length(o){o===0?this.clear():o<this.items.length?this.splice(o,this.length-o):console.warn("ArraySchema: can't set .length to a higher value than its length.")}get length(){return this.items.length}push(...o){var p;let l=this.tmpItems.length;const c=this[y];for(let x=0,O=o.length;x<o.length;x++,l++){const B=o[x];if(B==null)return;typeof B=="object"&&this[g]&&mt(B,this[g],this,x),c.indexedOperation(l,n.OPERATION.ADD,this.items.length),this.items.push(B),this.tmpItems.push(B),(p=B[y])==null||p.setParent(this,c.root,l)}return l}pop(){let o=-1;for(let l=this.tmpItems.length-1;l>=0;l--)if(this.deletedIndexes[l]!==!0){o=l;break}if(!(o<0))return this[y].delete(o,void 0,this.items.length-1),this.deletedIndexes[o]=!0,this.items.pop()}at(o){return o<0&&(o+=this.length),this.items[o]}$changeAt(o,l){var x,O,B;if(l==null){console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.");return}if(this.items[o]===l)return;const c=this[y],p=((O=(x=c.indexes)==null?void 0:x[o])==null?void 0:O.op)??n.OPERATION.ADD;c.change(o,p),(B=l[y])==null||B.setParent(this,c.root,o)}$deleteAt(o,l){this[y].delete(o,l)}$setAt(o,l,c){o===0&&c===n.OPERATION.ADD&&this.items[o]!==void 0?this.items.unshift(l):c===n.OPERATION.DELETE_AND_MOVE?(this.items.splice(o,1),this.items[o]=l):this.items[o]=l}clear(){if(this.items.length===0)return;const o=this[y];o.forEachChild((l,c)=>{l.discard(!0);const p=l.root;p!==void 0&&(p.removeChangeFromChangeSet("changes",l),p.removeChangeFromChangeSet("allChanges",l),p.removeChangeFromChangeSet("allFilteredChanges",l))}),o.discard(!0),o.operation(n.OPERATION.CLEAR),this.items.length=0,this.tmpItems.length=0}concat(...o){return new $t(...this.items.concat(...o))}join(o){return this.items.join(o)}reverse(){return this[y].operation(n.OPERATION.REVERSE),this.items.reverse(),this.tmpItems.reverse(),this}shift(){if(this.items.length===0)return;const o=this.tmpItems.findIndex((c,p)=>c===this.items[0]),l=this[y];return l.delete(o),l.shiftAllChangeIndexes(-1,o),this.items.shift()}slice(o,l){const c=new $t;return c.push(...this.items.slice(o,l)),c}sort(o=xf){const l=this[y];return this.items.sort(o).forEach((p,x)=>l.change(x,n.OPERATION.REPLACE)),this.tmpItems.sort(o),this}splice(o,l=this.items.length-o,...c){var k;const p=this[y],x=this.tmpItems.length,O=c.length,B=[];for(let H=0;H<x;H++)this.deletedIndexes[H]!==!0&&B.push(H);for(let H=o;H<o+l;H++){const J=B[H];p.delete(J),this.deletedIndexes[J]=!0}for(let H=0;H<O;H++){const J=B[o]+H;p.indexedOperation(J,n.OPERATION.ADD),(k=c[H][y])==null||k.setParent(this,p.root,J)}return l>O&&p.shiftAllChangeIndexes(-(l-O),B[o+O]),this.items.splice(o,l,...c)}unshift(...o){const l=this[y];return l.shiftChangeIndexes(o.length),l.isFiltered?gt(l.filteredChanges,this.items.length):gt(l.allChanges,this.items.length),o.forEach((c,p)=>{l.change(p,n.OPERATION.ADD)}),this.tmpItems.unshift(...o),this.items.unshift(...o)}indexOf(o,l){return this.items.indexOf(o,l)}lastIndexOf(o,l=this.length-1){return this.items.lastIndexOf(o,l)}every(o,l){return this.items.every(o,l)}some(o,l){return this.items.some(o,l)}forEach(o,l){return this.items.forEach(o,l)}map(o,l){return this.items.map(o,l)}filter(o,l){return this.items.filter(o,l)}reduce(o,l){return this.items.reduce(o,l)}reduceRight(o,l){return this.items.reduceRight(o,l)}find(o,l){return this.items.find(o,l)}findIndex(o,l){return this.items.findIndex(o,l)}fill(o,l,c){throw new Error("ArraySchema#fill() not implemented")}copyWithin(o,l,c){throw new Error("ArraySchema#copyWithin() not implemented")}toString(){return this.items.toString()}toLocaleString(){return this.items.toLocaleString()}[Symbol.iterator](){return this.items[Symbol.iterator]()}static get[Symbol.species](){return $t}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}includes(o,l){return this.items.includes(o,l)}flatMap(o,l){throw new Error("ArraySchema#flatMap() is not supported.")}flat(o){throw new Error("ArraySchema#flat() is not supported.")}findLast(){return this.items.findLast.apply(this.items,arguments)}findLastIndex(...o){return this.items.findLastIndex.apply(this.items,arguments)}with(o,l){const c=this.items.slice();return o<0&&(o+=this.length),c[o]=l,new $t(...c)}toReversed(){return this.items.slice().reverse()}toSorted(o){return this.items.slice().sort(o)}toSpliced(o,l,...c){return this.items.toSpliced.apply(copy,arguments)}[h](o,l=!1){return l?this.items[o]:this.deletedIndexes[o]?this.items[o]:this.tmpItems[o]||this.items[o]}[A](o){this.items[o]=void 0,this.tmpItems[o]=void 0}[b](){this.tmpItems=this.items.slice(),this.deletedIndexes={}}[E](){this.items=this.items.filter(o=>o!==void 0),this.tmpItems=this.items.slice()}toArray(){return this.items.slice(0)}toJSON(){return this.toArray().map(o=>typeof o.toJSON=="function"?o.toJSON():o)}clone(o){let l;return o?(l=new $t,l.push(...this.items)):l=new $t(...this.map(c=>c[y]?c.clone():c)),l}};$t[xa]=G,$t[ba]=$e;let Yt=$t;dt("array",{constructor:Yt});var va,Ea;const vn=class vn{static[(va=a,Ea=f,d)](o,l,c){return!c||typeof o[g]=="string"||c.visible.has((o[h](l)??o.deletedItems[l])[y])}static is(o){return o.map!==void 0}constructor(o){if(this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this[y]=new an(this),this[y].indexes={},o)if(o instanceof Map||o instanceof vn)o.forEach((l,c)=>this.set(c,l));else for(const l in o)this.set(l,o[l]);Object.defineProperty(this,g,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}[Symbol.iterator](){return this.$items[Symbol.iterator]()}get[Symbol.toStringTag](){return this.$items[Symbol.toStringTag]}static get[Symbol.species](){return vn}set(o,l){var B;if(l==null)throw new Error(`MapSchema#set('${o}', ${l}): trying to set ${l} value on '${o}'.`);typeof l=="object"&&this[g]&&mt(l,this[g],this,o),o=o.toString();const c=this[y],p=l[y]!==void 0;let x,O;if(typeof c.indexes[o]<"u"){x=c.indexes[o],O=n.OPERATION.REPLACE;const k=this.$items.get(o);if(k===l)return;p&&(O=n.OPERATION.DELETE_AND_ADD,k!==void 0&&((B=k[y].root)==null||B.remove(k[y])))}else x=c.indexes[v]??0,O=n.OPERATION.ADD,this.$indexes.set(x,o),c.indexes[o]=x,c.indexes[v]=x+1;return this.$items.set(o,l),c.change(x,O),p&&l[y].setParent(this,c.root,x),this}get(o){return this.$items.get(o)}delete(o){const l=this[y].indexes[o];return this.deletedItems[l]=this[y].delete(l),this.$items.delete(o)}clear(){const o=this[y];o.discard(!0),o.indexes={},this.$indexes.clear(),this.$items.clear(),o.operation(n.OPERATION.CLEAR)}has(o){return this.$items.has(o)}forEach(o){this.$items.forEach(o)}entries(){return this.$items.entries()}keys(){return this.$items.keys()}values(){return this.$items.values()}get size(){return this.$items.size}setIndex(o,l){this.$indexes.set(o,l)}getIndex(o){return this.$indexes.get(o)}[h](o){return this.$items.get(this.$indexes.get(o))}[A](o){const l=this.$indexes.get(o);this.$items.delete(l),this.$indexes.delete(o)}[b](){this.deletedItems={}}toJSON(){const o={};return this.forEach((l,c)=>{o[c]=typeof l.toJSON=="function"?l.toJSON():l}),o}clone(o){let l;return o?l=Object.assign(new vn,this):(l=new vn,this.forEach((c,p)=>{c[y]?l.set(p,c.clone()):l.set(p,c)})),l}};vn[va]=U,vn[Ea]=Ke;let xn=vn;dt("map",{constructor:xn});const ln=-1;function bf(w){return ke.register(w),w}function Sa(w=ln){return function(o,l){var B;const c=o.constructor,x=Object.getPrototypeOf(c)[Symbol.metadata],O=c[B=Symbol.metadata]??(c[B]=Object.assign({},c[Symbol.metadata],x??Object.create(null)));je.setTag(O,l,w)}}function jt(w,o){return function(l,c){const p=l.constructor;if(!w)throw new Error(`${p.name}: @type() reference provided for "${c}" is undefined. Make sure you don't have any circular dependencies.`);ke.register(p);const O=Object.getPrototypeOf(p)[Symbol.metadata],B=je.initialize(p);let k=B[c];if(B[k]!==void 0){if(B[k].deprecated)return;if(B[k].type!==void 0)try{throw new Error(`@colyseus/schema: Duplicate '${c}' definition on '${p.name}'.
Check @type() annotation`)}catch(H){const J=H.stack.split(`
`)[4].trim();throw new Error(`${H.message} ${J}`)}}else k=B[v]??(O&&O[v])??-1,k++;if(o&&o.manual)je.addField(B,k,c,w,{enumerable:!0,configurable:!0,writable:!0});else{const H=Array.isArray(w)?An("array"):typeof Object.keys(w)[0]=="string"&&An(Object.keys(w)[0]),J=H?Object.values(w)[0]:w;je.addField(B,k,c,w,Ia(`_${c}`,k,J,H))}}}function Ia(w,o,l,c){return{get:function(){return this[w]},set:function(p){var O,B;const x=this[w]??void 0;if(p!==x){if(p!=null){c?(c.constructor===Yt&&!(p instanceof Yt)&&(p=new Yt(...p)),c.constructor===xn&&!(p instanceof xn)&&(p=new xn(p)),p[g]=l):typeof l!="string"?mt(p,l,this,w.substring(1)):kt(p,l,this,w.substring(1));const k=this[y];x!==void 0&&x[y]?((O=k.root)==null||O.remove(x[y]),this.constructor[i](k,o,n.OPERATION.DELETE_AND_ADD)):this.constructor[i](k,o,n.OPERATION.ADD),(B=p[y])==null||B.setParent(this,k.root,o)}else x!==void 0&&this[y].delete(o);this[w]=p}},enumerable:!0,configurable:!0}}function vf(w=!0){return function(o,l){var k;const c=o.constructor,x=Object.getPrototypeOf(c)[Symbol.metadata],O=c[k=Symbol.metadata]??(c[k]=Object.assign({},c[Symbol.metadata],x??Object.create(null))),B=O[l];O[B].deprecated=!0,w&&(O[C]??(O[C]={}),O[C][l]={get:function(){throw new Error(`${l} is deprecated.`)},set:function(H){},enumerable:!1,configurable:!0}),Object.defineProperty(O,B,{value:O[B],enumerable:!1,configurable:!0})}}function Ef(w,o,l){for(let c in o)jt(o[c],l)(w.prototype,c);return w}function Oa(w,o,l=Ye){const c={},p={};for(let O in w){const B=w[O];typeof B=="object"&&(B.default!==void 0&&(c[O]=B.default),B.view!==void 0&&(p[O]=typeof B.view=="boolean"?ln:B.view))}const x=je.setFields(class extends l{constructor(...O){O[0]=Object.assign({},c,O[0]),super(...O)}},w);for(let O in p)Sa(p[O])(x.prototype,O);return o&&Object.defineProperty(x,"name",{value:o}),x.extends=(O,B)=>Oa(O,B,x),x}function Os(w){return new Array(w).fill(0).map((o,l)=>l===w-1?" ":"   ").join("")}function Sf(w){const o=w[y].root,l={ops:{},refs:[]};return o.changes.forEach(c=>{const p=c.indexedOperations;l.refs.push(`refId#${c.refId}`);for(const x in p){const O=p[x],B=n.OPERATION[O];l.ops[B]||(l.ops[B]=0),l.ops[n.OPERATION[O]]++}}),l}var Ra,Ma;const es=class es{static initialize(o){var l;Object.defineProperty(o,y,{value:new an(o),enumerable:!1,writable:!0}),Object.defineProperties(o,((l=o.constructor[Symbol.metadata])==null?void 0:l[C])||{})}static is(o){return typeof o[Symbol.metadata]=="object"}static[(Ra=a,Ma=f,i)](o,l,c=n.OPERATION.ADD){o.change(l,c)}static[d](o,l,c){var O,B;const x=(O=o.constructor[Symbol.metadata][l])==null?void 0:O.tag;if(c===void 0)return x===void 0;if(x===void 0)return!0;if(x===ln)return c.visible.has(o[y]);{const k=(B=c.tags)==null?void 0:B.get(o[y]);return k&&k.has(x)}}constructor(...o){es.initialize(this),o[0]&&Object.assign(this,o[0])}assign(o){return Object.assign(this,o),this}setDirty(o,l){const c=this.constructor[Symbol.metadata];this[y].change(c[c[o]].index,l)}clone(){var c;const o=new this.constructor,l=this.constructor[Symbol.metadata];for(const p in l){const x=l[p].name;typeof this[x]=="object"&&typeof((c=this[x])==null?void 0:c.clone)=="function"?o[x]=this[x].clone():o[x]=this[x]}return o}toJSON(){const o={},l=this.constructor[Symbol.metadata];for(const c in l){const p=l[c],x=p.name;!p.deprecated&&this[x]!==null&&typeof this[x]<"u"&&(o[x]=typeof this[x].toJSON=="function"?this[x].toJSON():this[x])}return o}discardAllChanges(){this[y].discardAll()}[h](o){const l=this.constructor[Symbol.metadata];return this[l[o].name]}[A](o){const l=this.constructor[Symbol.metadata];this[l[o].name]=void 0}static debugRefIds(o,l=!1,c=0){const p=l?` - ${JSON.stringify(o.toJSON())}`:"",x=o[y],O=x.refId;let B="";return B+=`${Os(c)}${o.constructor.name} (refId: ${O})${p}
`,x.forEachChild(k=>B+=this.debugRefIds(k.ref,l,c+1)),B}static debugChanges(o,l=!1){const c=o[y],p=l?c.allChanges:c.changes,x=l?"allChanges":"changes";let O=`${o.constructor.name} (${c.refId}) -> .${x}:
`;function B(k){k.operations.filter(H=>H).forEach(H=>{const J=c.indexedOperations[H];console.log({index:H,operation:J}),O+=`- [${H}]: ${n.OPERATION[J]} (${JSON.stringify(c.getValue(Number(H),l))})
`})}return B(p),!l&&c.filteredChanges&&c.filteredChanges.operations.filter(k=>k).length>0&&(O+=`${o.constructor.name} (${c.refId}) -> .filteredChanges:
`,B(c.filteredChanges)),l&&c.allFilteredChanges&&c.allFilteredChanges.operations.filter(k=>k).length>0&&(O+=`${o.constructor.name} (${c.refId}) -> .allFilteredChanges:
`,B(c.allFilteredChanges)),O}static debugChangesDeep(o,l="changes"){var J,ne;let c="";const p=o[y],x=p.root,O=new Map,B=[];let k=0;for(const[Z,ce]of Object.entries(x[l])){const ge=x.changeTrees[Z];let ae=!1,X=[],de=(J=ge.parent)==null?void 0:J[y];if(ge===p)ae=!0;else for(;de!==void 0;){if(X.push(de),de.ref===o){ae=!0;break}de=(ne=de.parent)==null?void 0:ne[y]}ae&&(B.push(ge.refId),k+=Object.keys(ce).length,O.set(ge,X.reverse()))}c+=`---
`,c+=`root refId: ${p.refId}
`,c+=`Total instances: ${B.length} (refIds: ${B.join(", ")})
`,c+=`Total changes: ${k}
`,c+=`---
`;const H=new WeakSet;for(const[Z,ce]of O.entries()){ce.forEach((Me,Ve)=>{H.has(Me)||(c+=`${Os(Ve)}${Me.ref.constructor.name} (refId: ${Me.refId})
`,H.add(Me))});const ge=Z.indexedOperations,ae=ce.length,X=Os(ae),de=ae>0?`(${Z.parentIndex}) `:"";c+=`${X}${de}${Z.ref.constructor.name} (refId: ${Z.refId}) - changes: ${Object.keys(ge).length}
`;for(const Me in ge){const Ve=ge[Me];c+=`${Os(ae+1)}${n.OPERATION[Ve]}: ${Me}
`}}return`${c}`}};es[Ra]=I,es[Ma]=Pe;let Ye=es;var Ta,Ca;const dr=class dr{static[(Ta=a,Ca=f,d)](o,l,c){return!c||typeof o[g]=="string"||c.visible.has((o[h](l)??o.deletedItems[l])[y])}static is(o){return o.collection!==void 0}constructor(o){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[y]=new an(this),this[y].indexes={},o&&o.forEach(l=>this.add(l)),Object.defineProperty(this,g,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(o){const l=this.$refId++;return o[y]!==void 0&&o[y].setParent(this,this[y].root,l),this[y].indexes[l]=l,this.$indexes.set(l,l),this.$items.set(l,o),this[y].change(l),l}at(o){const l=Array.from(this.$items.keys())[o];return this.$items.get(l)}entries(){return this.$items.entries()}delete(o){const l=this.$items.entries();let c,p;for(;(p=l.next())&&!p.done;)if(o===p.value[1]){c=p.value[0];break}return c===void 0?!1:(this.deletedItems[c]=this[y].delete(c),this.$indexes.delete(c),this.$items.delete(c))}clear(){const o=this[y];o.discard(!0),o.indexes={},this.$indexes.clear(),this.$items.clear(),o.operation(n.OPERATION.CLEAR)}has(o){return Array.from(this.$items.values()).some(l=>l===o)}forEach(o){this.$items.forEach((l,c,p)=>o(l,c,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(o,l){this.$indexes.set(o,l)}getIndex(o){return this.$indexes.get(o)}[h](o){return this.$items.get(this.$indexes.get(o))}[A](o){const l=this.$indexes.get(o);this.$items.delete(l),this.$indexes.delete(o)}[b](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const o=[];return this.forEach((l,c)=>{o.push(typeof l.toJSON=="function"?l.toJSON():l)}),o}clone(o){let l;return o?l=Object.assign(new dr,this):(l=new dr,this.forEach(c=>{c[y]?l.add(c.clone()):l.add(c)})),l}};dr[Ta]=U,dr[Ca]=Ke;let Qr=dr;dt("collection",{constructor:Qr});var Pa,Da;const gr=class gr{static[(Pa=a,Da=f,d)](o,l,c){return!c||typeof o[g]=="string"||c.visible.has((o[h](l)??o.deletedItems[l])[y])}static is(o){return o.set!==void 0}constructor(o){this.$items=new Map,this.$indexes=new Map,this.deletedItems={},this.$refId=0,this[y]=new an(this),this[y].indexes={},o&&o.forEach(l=>this.add(l)),Object.defineProperty(this,g,{value:void 0,enumerable:!1,writable:!0,configurable:!0})}add(o){var p;if(this.has(o))return!1;const l=this.$refId++;o[y]!==void 0&&o[y].setParent(this,this[y].root,l);const c=((p=this[y].indexes[l])==null?void 0:p.op)??n.OPERATION.ADD;return this[y].indexes[l]=l,this.$indexes.set(l,l),this.$items.set(l,o),this[y].change(l,c),l}entries(){return this.$items.entries()}delete(o){const l=this.$items.entries();let c,p;for(;(p=l.next())&&!p.done;)if(o===p.value[1]){c=p.value[0];break}return c===void 0?!1:(this.deletedItems[c]=this[y].delete(c),this.$indexes.delete(c),this.$items.delete(c))}clear(){const o=this[y];o.discard(!0),o.indexes={},this.$indexes.clear(),this.$items.clear(),o.operation(n.OPERATION.CLEAR)}has(o){const l=this.$items.values();let c=!1,p;for(;(p=l.next())&&!p.done;)if(o===p.value){c=!0;break}return c}forEach(o){this.$items.forEach((l,c,p)=>o(l,c,this))}values(){return this.$items.values()}get size(){return this.$items.size}[Symbol.iterator](){return this.$items.values()}setIndex(o,l){this.$indexes.set(o,l)}getIndex(o){return this.$indexes.get(o)}[h](o){return this.$items.get(this.$indexes.get(o))}[A](o){const l=this.$indexes.get(o);this.$items.delete(l),this.$indexes.delete(o)}[b](){this.deletedItems={}}toArray(){return Array.from(this.$items.values())}toJSON(){const o=[];return this.forEach((l,c)=>{o.push(typeof l.toJSON=="function"?l.toJSON():l)}),o}clone(o){let l;return o?l=Object.assign(new gr,this):(l=new gr,this.forEach(c=>{c[y]?l.add(c.clone()):l.add(c)})),l}};gr[Pa]=U,gr[Da]=Ke;let Zr=gr;dt("set",{constructor:Zr});function bn(w,o,l,c){var p=arguments.length,x=p<3?o:c,O;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(w,o,l,c);else for(var B=w.length-1;B>=0;B--)(O=w[B])&&(x=(p<3?O(x):p>3?O(o,l,x):O(o,l))||x);return p>3&&x&&Object.defineProperty(o,l,x),x}typeof SuppressedError=="function"&&SuppressedError;function Ci(w,o){if(o===-1||o>=w.length)return!1;const l=w.length-1;for(let c=o;c<l;c++)w[c]=w[c+1];return w.length=l,!0}class If{constructor(o){this.types=o,this.nextUniqueId=0,this.refCount={},this.changeTrees={},this.allChanges=[],this.allFilteredChanges=[],this.changes=[],this.filteredChanges=[]}getNextUniqueId(){return this.nextUniqueId++}add(o){o.ensureRefId();const l=this.changeTrees[o.refId]===void 0;l&&(this.changeTrees[o.refId]=o);const c=this.refCount[o.refId];if(c===0){const p=o.allChanges.operations;let x=p.length;for(;x--;)o.indexedOperations[p[x]]=n.OPERATION.ADD,gt(o.changes,x)}return this.refCount[o.refId]=(c||0)+1,l}remove(o){const l=this.refCount[o.refId]-1;return l<=0?(o.root=void 0,delete this.changeTrees[o.refId],this.removeChangeFromChangeSet("allChanges",o),this.removeChangeFromChangeSet("changes",o),o.filteredChanges&&(this.removeChangeFromChangeSet("allFilteredChanges",o),this.removeChangeFromChangeSet("filteredChanges",o)),this.refCount[o.refId]=0):(this.refCount[o.refId]=l,o.filteredChanges!==void 0?(this.removeChangeFromChangeSet("filteredChanges",o),pt(this,o,"filteredChanges")):(this.removeChangeFromChangeSet("changes",o),pt(this,o,"changes"))),o.forEachChild((c,p)=>this.remove(c)),l}removeChangeFromChangeSet(o,l){const c=this[o];if(Ci(c,c.indexOf(l)))return l[o].queueRootIndex=-1,!0}clear(){this.changes.length=0}}const Ms=class Ms{constructor(o){this.sharedBuffer=Buffer.allocUnsafe(Ms.BUFFER_SIZE),this.context=ke.cache(o.constructor),this.root=new If(this.context),this.setState(o)}setState(o){this.state=o,this.state[y].setRoot(this.root)}encode(o={offset:0},l,c=this.sharedBuffer,p="changes",x=p==="allChanges",O=o.offset){const B=l!==void 0,k=this.state[y],H=!x&&!B,J=this.root[p];for(let ne=0,Z=J.length;ne<Z;ne++){const ce=J[ne];if(B)if(l.visible.has(ce))l.invisible.delete(ce);else{l.invisible.add(ce);continue}const ge=ce[p],ae=ce.ref,X=ge.operations.length;if(X===0)continue;const de=ae.constructor,Me=de[a],Ve=de[d],yt=de[Symbol.metadata];(B||o.offset>O||ce!==k)&&(c[o.offset++]=255,Qe.number(c,ce.refId,o));for(let wt=0;wt<X;wt++){const qt=ge.operations[wt],ka=qt<0?Math.abs(qt):x?n.OPERATION.ADD:ce.indexedOperations[qt];qt===void 0||ka===void 0||Ve&&!Ve(ae,qt,l)||Me(this,c,ce,qt,ka,o,x,B,yt)}}if(o.offset>c.byteLength){const ne=Math.ceil(o.offset/(Buffer.poolSize??8192))*(Buffer.poolSize??8192);return console.warn(`@colyseus/schema buffer overflow. Encoded state is higher than default BUFFER_SIZE. Use the following to increase default BUFFER_SIZE:

    import { Encoder } from "@colyseus/schema";
    Encoder.BUFFER_SIZE = ${Math.round(ne/1024)} * 1024; // ${Math.round(ne/1024)} KB
`),c=Buffer.alloc(ne,c),c===this.sharedBuffer&&(this.sharedBuffer=c),this.encode({offset:O},l,c,p,x)}else{if(H)for(let ne=0,Z=J.length;ne<Z;ne++){const ce=J[ne];ce.discard(),ce.isNew=!1}return c.subarray(0,o.offset)}}encodeAll(o={offset:0},l=this.sharedBuffer){return this.encode(o,void 0,l,"allChanges",!0)}encodeAllView(o,l,c,p=this.sharedBuffer){const x=c.offset;return this.encode(c,o,p,"allFilteredChanges",!0,x),Buffer.concat([p.subarray(0,l),p.subarray(x,c.offset)])}debugChanges(o){(typeof o=="string"?this.root[o]:o).forEach(c=>{const p=c[o],x=c.ref.constructor[Symbol.metadata];console.log("->",{ref:c.ref.constructor.name,refId:c.refId,changes:Object.keys(p).length});for(const O in p){const B=p[O];console.log("  ->",{index:O,field:x==null?void 0:x[O],op:n.OPERATION[B]})}})}encodeView(o,l,c,p=this.sharedBuffer){const x=c.offset;for(const[O,B]of o.changes){const k=this.root.changeTrees[O];if(k===void 0){o.changes.delete(O);continue}const H=Object.keys(B);if(H.length===0)continue;const ne=k.ref.constructor,Z=ne[a],ce=ne[Symbol.metadata];p[c.offset++]=255,Qe.number(p,k.refId,c);for(let ge=0,ae=H.length;ge<ae;ge++){const X=Number(H[ge]),Me=k.ref[h](X)!==void 0&&B[X]||n.OPERATION.DELETE;Z(this,p,k,X,Me,c,!1,!0,ce)}}return o.changes.clear(),this.encode(c,o,p,"filteredChanges",!1,x),Buffer.concat([p.subarray(0,l),p.subarray(x,c.offset)])}discardChanges(){var l,c;let o=this.root.changes.length;if(o>0){for(;o--;)(l=this.root.changes[o])==null||l.endEncode();this.root.changes.length=0}if(o=this.root.filteredChanges.length,o>0){for(;o--;)(c=this.root.filteredChanges[o])==null||c.endEncode();this.root.filteredChanges.length=0}}tryEncodeTypeId(o,l,c,p){const x=this.context.getTypeId(l),O=this.context.getTypeId(c);if(O===void 0){console.warn(`@colyseus/schema WARNING: Class "${c.name}" is not registered on TypeRegistry - Please either tag the class with @entity or define a @type() field.`);return}x!==O&&(o[p.offset++]=213,Qe.number(o,O,p))}get hasChanges(){return this.root.changes.length>0||this.root.filteredChanges.length>0}};Ms.BUFFER_SIZE=typeof Buffer<"u"&&Buffer.poolSize||8*1024;let Rs=Ms;class Ba extends Error{constructor(o){super(o),this.name="DecodingWarning"}}class Of{constructor(){this.refs=new Map,this.refIds=new WeakMap,this.refCounts={},this.deletedRefs=new Set,this.callbacks={},this.nextUniqueId=0}getNextUniqueId(){return this.nextUniqueId++}addRef(o,l,c=!0){this.refs.set(o,l),this.refIds.set(l,o),c&&(this.refCounts[o]=(this.refCounts[o]||0)+1),this.deletedRefs.has(o)&&this.deletedRefs.delete(o)}removeRef(o){const l=this.refCounts[o];if(l===void 0){try{throw new Ba("trying to remove refId that doesn't exist: "+o)}catch(c){console.warn(c)}return}if(l===0){try{const c=this.refs.get(o);throw new Ba(`trying to remove refId '${o}' with 0 refCount (${c.constructor.name}: ${JSON.stringify(c)})`)}catch(c){console.warn(c)}return}(this.refCounts[o]=l-1)<=0&&this.deletedRefs.add(o)}clearRefs(){this.refs.clear(),this.deletedRefs.clear(),this.callbacks={},this.refCounts={}}garbageCollectDeletedRefs(){this.deletedRefs.forEach(o=>{if(this.refCounts[o]>0)return;const l=this.refs.get(o);if(l.constructor[Symbol.metadata]!==void 0){const c=l.constructor[Symbol.metadata];for(const p in c){const x=c[p].name,O=typeof l[x]=="object"&&this.refIds.get(l[x]);O&&!this.deletedRefs.has(O)&&this.removeRef(O)}}else typeof l[g]=="function"&&Array.from(l.values()).forEach(c=>{const p=this.refIds.get(c);this.deletedRefs.has(p)||this.removeRef(p)});this.refs.delete(o),delete this.refCounts[o],delete this.callbacks[o]}),this.deletedRefs.clear()}addCallback(o,l,c){if(o===void 0){const p=typeof l=="number"?n.OPERATION[l]:l;throw new Error(`Can't addCallback on '${p}' (refId is undefined)`)}return this.callbacks[o]||(this.callbacks[o]={}),this.callbacks[o][l]||(this.callbacks[o][l]=[]),this.callbacks[o][l].push(c),()=>this.removeCallback(o,l,c)}removeCallback(o,l,c){var x,O,B;const p=(B=(O=(x=this.callbacks)==null?void 0:x[o])==null?void 0:O[l])==null?void 0:B.indexOf(c);p!==-1&&Ci(this.callbacks[o][l],p)}}class Pi{constructor(o,l){this.currentRefId=0,this.setState(o),this.context=l||new ke(o.constructor)}setState(o){this.state=o,this.root=new Of,this.root.addRef(0,o)}decode(o,l={offset:0},c=this.state){var k,H,J;const p=[],x=this.root,O=o.byteLength;let B=c.constructor[f];for(this.currentRefId=0;l.offset<O;){if(o[l.offset]==255){l.offset++,this.currentRefId=Ne.number(o,l);const Z=x.refs.get(this.currentRefId);if(!Z)throw new Error(`"refId" not found: ${this.currentRefId}`);(k=c[E])==null||k.call(c),c=Z,B=c.constructor[f];continue}if(B(this,o,l,c,p)===se){console.warn("@colyseus/schema: definition mismatch");const Z={offset:l.offset};for(;l.offset<O&&!(o[l.offset]===255&&(Z.offset=l.offset+1,x.refs.has(Ne.number(o,Z))));)l.offset++;continue}}return(H=c[E])==null||H.call(c),(J=this.triggerChanges)==null||J.call(this,p),x.garbageCollectDeletedRefs(),p}getInstanceType(o,l,c){let p;if(o[l.offset]===213){l.offset++;const x=Ne.number(o,l);p=this.context.get(x)}return p||c}createInstanceOfType(o){return new o}removeChildRefs(o,l){const c=typeof o[g]!="string",p=this.root.refIds.get(o);o.forEach((x,O)=>{l.push({ref:o,refId:p,op:n.OPERATION.DELETE,field:O,value:void 0,previousValue:x}),c&&this.root.removeRef(this.root.refIds.get(x))})}}class cr extends Ye{}bn([jt("string")],cr.prototype,"name",void 0),bn([jt("string")],cr.prototype,"type",void 0),bn([jt("number")],cr.prototype,"referencedType",void 0);class hr extends Ye{constructor(){super(...arguments),this.fields=new Yt}}bn([jt("number")],hr.prototype,"id",void 0),bn([jt("number")],hr.prototype,"extendsId",void 0),bn([jt([cr])],hr.prototype,"fields",void 0);class fr extends Ye{constructor(){super(...arguments),this.types=new Yt}static encode(o,l={offset:0}){const c=o.context,p=new fr,x=new Rs(p),O=c.schemas.get(o.state.constructor);O>0&&(p.rootType=O);const B=new Set,k={},H=ne=>{if(ne.extendsId===void 0||B.has(ne.extendsId)){B.add(ne.id),p.types.push(ne);const Z=k[ne.id];Z!==void 0&&(delete k[ne.id],Z.forEach(ce=>H(ce)))}else k[ne.extendsId]===void 0&&(k[ne.extendsId]=[]),k[ne.extendsId].push(ne)};c.schemas.forEach((ne,Z)=>{const ce=new hr;ce.id=Number(ne);const ge=Object.getPrototypeOf(Z);ge!==Ye&&(ce.extendsId=c.schemas.get(ge));const ae=Z[Symbol.metadata];if(ae!==ge[Symbol.metadata])for(const X in ae){const de=Number(X),Me=ae[de].name;if(!Object.prototype.hasOwnProperty.call(ae,Me))continue;const Ve=new cr;Ve.name=Me;let yt;const wt=ae[de];if(typeof wt.type=="string")yt=wt.type;else{let qt;Ye.is(wt.type)?(yt="ref",qt=wt.type):(yt=Object.keys(wt.type)[0],typeof wt.type[yt]=="string"?yt+=":"+wt.type[yt]:qt=wt.type[yt]),Ve.referencedType=qt?c.getTypeId(qt):-1}Ve.type=yt,ce.fields.push(Ve)}H(ce)});for(const ne in k)k[ne].forEach(Z=>p.types.push(Z));const J=x.encodeAll(l);return Buffer.from(J,0,l.offset)}static decode(o,l){const c=new fr;new Pi(c).decode(o,l);const x=new ke;c.types.forEach(k=>{const H=x.get(k.extendsId)??Ye,J=class extends H{};ke.register(J),x.add(J,k.id)},{});const O=(k,H,J)=>{H.fields.forEach((ne,Z)=>{const ce=J+Z;if(ne.referencedType!==void 0){let ge=ne.type,ae=x.get(ne.referencedType);if(!ae){const X=ne.type.split(":");ge=X[0],ae=X[1]}ge==="ref"?je.addField(k,ce,ne.name,ae):je.addField(k,ce,ne.name,{[ge]:ae})}else je.addField(k,ce,ne.name,ne.type)})};c.types.forEach(k=>{const H=x.get(k.id),J=je.initialize(H),ne=[];let Z=k;do ne.push(Z),Z=c.types.find(ge=>ge.id===Z.extendsId);while(Z);let ce=0;ne.reverse().forEach(ge=>{O(J,ge,ce),ce+=ge.fields.length})});const B=new(x.get(c.rootType||0));return new Pi(B,x)}}bn([jt([hr])],fr.prototype,"types",void 0),bn([jt("number")],fr.prototype,"rootType",void 0);function Rf(w){const o=w.root,l=o.callbacks,c=new WeakMap;let p;w.triggerChanges=function(B){var H;const k=new Set;for(let J=0,ne=B.length;J<ne;J++){const Z=B[J],ce=Z.refId,ge=Z.ref,ae=l[ce];if(ae){if((Z.op&n.OPERATION.DELETE)===n.OPERATION.DELETE&&Z.previousValue instanceof Ye){const X=(H=l[o.refIds.get(Z.previousValue)])==null?void 0:H[n.OPERATION.DELETE];for(let de=(X==null?void 0:X.length)-1;de>=0;de--)X[de]()}if(ge instanceof Ye){if(!k.has(ce)){const X=ae==null?void 0:ae[n.OPERATION.REPLACE];for(let de=(X==null?void 0:X.length)-1;de>=0;de--)X[de]()}if(ae.hasOwnProperty(Z.field)){const X=ae[Z.field];for(let de=(X==null?void 0:X.length)-1;de>=0;de--)X[de](Z.value,Z.previousValue)}}else{if((Z.op&n.OPERATION.DELETE)===n.OPERATION.DELETE){if(Z.previousValue!==void 0){const X=ae[n.OPERATION.DELETE];for(let de=(X==null?void 0:X.length)-1;de>=0;de--)X[de](Z.previousValue,Z.dynamicIndex??Z.field)}if((Z.op&n.OPERATION.ADD)===n.OPERATION.ADD){const X=ae[n.OPERATION.ADD];for(let de=(X==null?void 0:X.length)-1;de>=0;de--)X[de](Z.value,Z.dynamicIndex??Z.field)}}else if((Z.op&n.OPERATION.ADD)===n.OPERATION.ADD&&Z.previousValue===void 0){const X=ae[n.OPERATION.ADD];for(let de=(X==null?void 0:X.length)-1;de>=0;de--)X[de](Z.value,Z.dynamicIndex??Z.field)}if(Z.value!==Z.previousValue&&(Z.value!==void 0||Z.previousValue!==void 0)){const X=ae[n.OPERATION.REPLACE];for(let de=(X==null?void 0:X.length)-1;de>=0;de--)X[de](Z.value,Z.dynamicIndex??Z.field)}}k.add(ce)}}};function x(B,k){var ne;let H=((ne=k.instance)==null?void 0:ne.constructor[Symbol.metadata])||B,J=k.instance&&typeof k.instance.forEach=="function"||B&&typeof B[Symbol.metadata]>"u";if(H&&!J){const Z=function(ce,ge,ae,X){return X&&k.instance[ge]!==void 0&&!c.has(p)&&ae(k.instance[ge],void 0),o.addCallback(o.refIds.get(ce),ge,ae)};return new Proxy({listen:function(ge,ae,X=!0){if(k.instance)return Z(k.instance,ge,ae,X);{let de=()=>{};return k.onInstanceAvailable((Me,Ve)=>{de=Z(Me,ge,ae,X&&Ve&&!c.has(p))}),()=>de()}},onChange:function(ge){return o.addCallback(o.refIds.get(k.instance),n.OPERATION.REPLACE,ge)},bindTo:function(ge,ae){return ae||(ae=Object.keys(H).map(X=>H[X].name)),o.addCallback(o.refIds.get(k.instance),n.OPERATION.REPLACE,()=>{ae.forEach(X=>ge[X]=k.instance[X])})}},{get(ce,ge){var X;const ae=H[H[ge]];if(ae){const de=(X=k.instance)==null?void 0:X[ge],Me=Ve=>{const yt=O(k.instance).listen(ge,(wt,qt)=>{Ve(wt,!1),yt==null||yt()},!1);o.refIds.get(de)!==void 0&&Ve(de,!0)};return x(ae.type,{instance:o.refIds.get(de)&&de,parentInstance:k.instance,onInstanceAvailable:Me})}else return ce[ge]},has(ce,ge){return H[ge]!==void 0},set(ce,ge,ae){throw new Error("not allowed")},deleteProperty(ce,ge){throw new Error("not allowed")}})}else{const Z=function(ae,X,de){return de&&ae.forEach((Me,Ve)=>X(Me,Ve)),o.addCallback(o.refIds.get(ae),n.OPERATION.ADD,(Me,Ve)=>{c.set(X,!0),p=X,X(Me,Ve),c.delete(X),p=void 0})},ce=function(ae,X){return o.addCallback(o.refIds.get(ae),n.OPERATION.DELETE,X)},ge=function(ae,X){return o.addCallback(o.refIds.get(ae),n.OPERATION.REPLACE,X)};return new Proxy({onAdd:function(ae,X=!0){if(k.instance)return Z(k.instance,ae,X&&!c.has(p));if(k.onInstanceAvailable){let de=()=>{};return k.onInstanceAvailable((Me,Ve)=>{de=Z(Me,ae,X&&Ve&&!c.has(p))}),()=>de()}},onRemove:function(ae){if(k.instance)return ce(k.instance,ae);if(k.onInstanceAvailable){let X=()=>{};return k.onInstanceAvailable(de=>{X=ce(de,ae)}),()=>X()}},onChange:function(ae){if(k.instance)return ge(k.instance,ae);if(k.onInstanceAvailable){let X=()=>{};return k.onInstanceAvailable(de=>{X=ge(de,ae)}),()=>X()}}},{get(ae,X){if(!ae[X])throw new Error(`Can't access '${X}' through callback proxy. access the instance directly.`);return ae[X]},has(ae,X){return ae[X]!==void 0},set(ae,X,de){throw new Error("not allowed")},deleteProperty(ae,X){throw new Error("not allowed")}})}}function O(B){return x(void 0,{instance:B})}return O}function Mf(w,o){w.triggerChanges=o}class Tf{constructor(o=!1){this.iterable=o,this.visible=new WeakSet,this.invisible=new WeakSet,this.changes=new Map,o&&(this.items=[])}add(o,l=ln,c=!0){var B,k;const p=o==null?void 0:o[y];if(p){if(!p.parent&&p.refId!==0)throw new Error(`Cannot add a detached instance to the StateView. Make sure to assign the "${p.ref.constructor.name}" instance to the state before calling view.add()`)}else return console.warn("StateView#add(), invalid object:",o),this;const x=o.constructor[Symbol.metadata];this.visible.add(p),this.iterable&&c&&this.items.push(o),c&&p.parent&&this.addParentOf(p,l);let O=this.changes.get(p.refId);if(O===void 0&&(O={},this.changes.set(p.refId,O)),l!==ln){this.tags||(this.tags=new WeakMap);let H;this.tags.has(p)?H=this.tags.get(p):(H=new Set,this.tags.set(p,H)),H.add(l),(k=(B=x==null?void 0:x[W])==null?void 0:B[l])==null||k.forEach(J=>{p.getChange(J)!==n.OPERATION.DELETE&&(O[J]=n.OPERATION.ADD)})}else{const H=this.invisible.has(p),J=p.filteredChanges!==void 0?p.allFilteredChanges:p.allChanges;for(let ne=0,Z=J.operations.length;ne<Z;ne++){const ce=J.operations[ne];if(ce===void 0)continue;const ge=p.indexedOperations[ce]??n.OPERATION.ADD,ae=x==null?void 0:x[ce].tag;!p.isNew&&(H||ae===void 0||ae===l)&&ge!==n.OPERATION.DELETE&&(O[ce]=ge)}}return p.forEachChild((H,J)=>{x&&x[J].tag!==void 0&&x[J].tag!==l||this.add(H.ref,l,!1)}),this}addParentOf(o,l){var x;const c=o.parent[y],p=o.parentIndex;if(!this.visible.has(c)){this.visible.add(c);const O=(x=c.parent)==null?void 0:x[y];O&&O.filteredChanges!==void 0&&this.addParentOf(c,l)}if(c.getChange(p)!==n.OPERATION.DELETE){let O=this.changes.get(c.refId);O===void 0&&(O={},this.changes.set(c.refId,O)),this.tags||(this.tags=new WeakMap);let B;this.tags.has(c)?B=this.tags.get(c):(B=new Set,this.tags.set(c,B)),B.add(l),O[p]=n.OPERATION.ADD}}remove(o,l=ln,c=!1){const p=o[y];if(!p)return console.warn("StateView#remove(), invalid object:",o),this;this.visible.delete(p),this.iterable&&!c&&Ci(this.items,this.items.indexOf(o));const O=p.ref.constructor[Symbol.metadata];let B=this.changes.get(p.refId);if(B===void 0&&(B={},this.changes.set(p.refId,B)),l===ln){const k=p.parent;if(je.isValidInstance(k))O==null||O[j].forEach(H=>B[H]=n.OPERATION.DELETE);else{const H=k[y];let J=this.changes.get(H.refId);J===void 0&&(J={},this.changes.set(H.refId,J)),J[p.parentIndex]=n.OPERATION.DELETE}}else O==null||O[W][l].forEach(k=>B[k]=n.OPERATION.DELETE);if(this.tags&&this.tags.has(p)){const k=this.tags.get(p);l===void 0?this.tags.delete(p):(k.delete(l),k.size===0&&this.tags.delete(p))}return this}has(o){return this.visible.has(o[y])}hasTag(o,l=ln){var p;const c=(p=this.tags)==null?void 0:p.get(o[y]);return(c==null?void 0:c.has(l))??!1}clear(){if(!this.iterable)throw new Error("StateView#clear() is only available for iterable StateView's. Use StateView(iterable: true) constructor.");for(let o=0,l=this.items.length;o<l;o++)this.remove(this.items[o],ln,!0);this.items.length=0}}dt("map",{constructor:xn}),dt("array",{constructor:Yt}),dt("set",{constructor:Zr}),dt("collection",{constructor:Qr}),n.$changes=y,n.$childType=g,n.$decoder=f,n.$deleteByIndex=A,n.$encoder=a,n.$filter=d,n.$getByIndex=h,n.$track=i,n.ArraySchema=Yt,n.ChangeTree=an,n.CollectionSchema=Qr,n.Decoder=Pi,n.Encoder=Rs,n.MapSchema=xn,n.Metadata=je,n.Reflection=fr,n.ReflectionField=cr,n.ReflectionType=hr,n.Schema=Ye,n.SetSchema=Zr,n.StateView=Tf,n.TypeContext=ke,n.decode=Ne,n.decodeKeyValueOperation=Ke,n.decodeSchemaOperation=Pe,n.defineCustomTypes=Is,n.defineTypes=Ef,n.deprecated=vf,n.dumpChanges=Sf,n.encode=Qe,n.encodeArray=G,n.encodeKeyValueOperation=U,n.encodeSchemaOperation=I,n.entity=bf,n.getDecoderStateCallbacks=Rf,n.getRawChangesCallback=Mf,n.registerType=dt,n.schema=Oa,n.type=jt,n.view=Sa})})(Qi,Qi.exports);var ca=Qi.exports,ja=vi,Kn=ca;class Qd{constructor(e){this.events=e,this.isOpen=!1,this.lengthPrefixBuffer=new Uint8Array(9)}connect(e,n={}){const r=n.fingerprint&&{serverCertificateHashes:[{algorithm:"sha-256",value:new Uint8Array(n.fingerprint).buffer}]}||void 0;this.wt=new WebTransport(e,r),this.wt.ready.then(s=>{console.log("WebTransport ready!",s),this.isOpen=!0,this.unreliableReader=this.wt.datagrams.readable.getReader(),this.unreliableWriter=this.wt.datagrams.writable.getWriter(),this.wt.incomingBidirectionalStreams.getReader().read().then(a=>{this.reader=a.value.readable.getReader(),this.writer=a.value.writable.getWriter(),this.sendSeatReservation(n.room.roomId,n.sessionId,n.reconnectionToken),this.readIncomingData(),this.readIncomingUnreliableData()}).catch(a=>{console.error("failed to read incoming stream",a),console.error("TODO: close the connection")})}).catch(s=>{console.log("WebTransport not ready!",s),this._close()}),this.wt.closed.then(s=>{console.log("WebTransport closed w/ success",s),this.events.onclose({code:s.closeCode,reason:s.reason})}).catch(s=>{console.log("WebTransport closed w/ error",s),this.events.onerror(s),this.events.onclose({code:s.closeCode,reason:s.reason})}).finally(()=>{this._close()})}send(e){const n=Kn.encode.number(this.lengthPrefixBuffer,e.length,{offset:0}),r=new Uint8Array(n+e.length);r.set(this.lengthPrefixBuffer.subarray(0,n),0),r.set(e,n),this.writer.write(r)}sendUnreliable(e){const n=Kn.encode.number(this.lengthPrefixBuffer,e.length,{offset:0}),r=new Uint8Array(n+e.length);r.set(this.lengthPrefixBuffer.subarray(0,n),0),r.set(e,n),this.unreliableWriter.write(r)}close(e,n){try{this.wt.close({closeCode:e,reason:n})}catch(r){console.error(r)}}readIncomingData(){return ja.__awaiter(this,void 0,void 0,function*(){let e;for(;this.isOpen;){try{e=yield this.reader.read();const n=e.value,r={offset:0};do{const s=Kn.decode.number(n,r);this.events.onmessage({data:n.subarray(r.offset,r.offset+s)}),r.offset+=s}while(r.offset<n.length)}catch(n){n.message.indexOf("session is closed")===-1&&console.error("H3Transport: failed to read incoming data",n);break}if(e.done)break}})}readIncomingUnreliableData(){return ja.__awaiter(this,void 0,void 0,function*(){let e;for(;this.isOpen;){try{e=yield this.unreliableReader.read();const n=e.value,r={offset:0};do{const s=Kn.decode.number(n,r);this.events.onmessage({data:n.subarray(r.offset,r.offset+s)}),r.offset+=s}while(r.offset<n.length)}catch(n){n.message.indexOf("session is closed")===-1&&console.error("H3Transport: failed to read incoming data",n);break}if(e.done)break}})}sendSeatReservation(e,n,r){const s={offset:0},i=[];Kn.encode.string(i,e,s),Kn.encode.string(i,n,s),r&&Kn.encode.string(i,r,s),this.writer.write(new Uint8Array(i).buffer)}_close(){this.isOpen=!1}}Wh.H3TransportTransport=Qd;var Yh={},Zd=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},eg=Zd;const Bi=globalThis.WebSocket||eg;let tg=class{constructor(e){this.events=e}send(e){this.ws.send(e)}sendUnreliable(e){console.warn("colyseus.js: The WebSocket transport does not support unreliable messages")}connect(e,n){try{this.ws=new Bi(e,{headers:n,protocols:this.protocols})}catch{this.ws=new Bi(e,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(e,n){this.ws.close(e,n)}get isOpen(){return this.ws.readyState===Bi.OPEN}};Yh.WebSocketTransport=tg;var ng=Wh,rg=Yh;let sg=class{constructor(e){switch(this.events={},e){case"h3":this.transport=new ng.H3TransportTransport(this.events);break;default:this.transport=new rg.WebSocketTransport(this.events);break}}connect(e,n){this.transport.connect.call(this.transport,e,n)}send(e){this.transport.send(e)}sendUnreliable(e){this.transport.sendUnreliable(e)}close(e,n){this.transport.close(e,n)}get isOpen(){return this.transport.isOpen}};Gh.Connection=sg;var ha={};(function(t){t.Protocol=void 0,function(e){e[e.HANDSHAKE=9]="HANDSHAKE",e[e.JOIN_ROOM=10]="JOIN_ROOM",e[e.ERROR=11]="ERROR",e[e.LEAVE_ROOM=12]="LEAVE_ROOM",e[e.ROOM_DATA=13]="ROOM_DATA",e[e.ROOM_STATE=14]="ROOM_STATE",e[e.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",e[e.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",e[e.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(t.Protocol||(t.Protocol={})),t.ErrorCode=void 0,function(e){e[e.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",e[e.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",e[e.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",e[e.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",e[e.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",e[e.AUTH_FAILED=4215]="AUTH_FAILED",e[e.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(t.ErrorCode||(t.ErrorCode={}))})(ha);var Ei={};const Xh={};function ig(t,e){Xh[t]=e}function og(t){const e=Xh[t];if(!e)throw new Error("missing serializer: "+t);return e}Ei.getSerializer=og;Ei.registerSerializer=ig;var fa={};const ag=()=>({emit(t,...e){let n=this.events[t]||[];for(let r=0,s=n.length;r<s;r++)n[r](...e)},events:{},on(t,e){var n;return!((n=this.events[t])===null||n===void 0)&&n.push(e)||(this.events[t]=[e]),()=>{var r;this.events[t]=(r=this.events[t])===null||r===void 0?void 0:r.filter(s=>e!==s)}}});fa.createNanoEvents=ag;var da={};class Jh{constructor(){this.handlers=[]}register(e,n=!1){return this.handlers.push(e),this}invoke(...e){this.handlers.forEach(n=>n.apply(this,e))}invokeAsync(...e){return Promise.all(this.handlers.map(n=>n.apply(this,e)))}remove(e){const n=this.handlers.indexOf(e);this.handlers[n]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}function lg(){const t=new Jh;function e(n){return t.register(n,this===null)}return e.once=n=>{const r=function(...s){n.apply(this,s),t.remove(r)};t.register(r)},e.remove=n=>t.remove(n),e.invoke=(...n)=>t.invoke(...n),e.invokeAsync=(...n)=>t.invokeAsync(...n),e.clear=()=>t.clear(),e}da.EventEmitter=Jh;da.createSignal=lg;var Si={},Ls=ca;function ug(t){try{return Ls.getDecoderStateCallbacks(t.serializer.decoder)}catch{return}}let cg=class{setState(e,n){this.decoder.decode(e,n)}getState(){return this.state}patch(e,n){return this.decoder.decode(e,n)}teardown(){this.decoder.root.clearRefs()}handshake(e,n){this.state?(Ls.Reflection.decode(e,n),this.decoder=new Ls.Decoder(this.state)):(this.decoder=Ls.Reflection.decode(e,n),this.state=this.decoder.state)}};Si.SchemaSerializer=cg;Si.getStateCallbacks=ug;var Zi;try{Zi=new TextDecoder}catch{}var ue,rn,T=0,Be={},Se,In,Lt=0,Qt=0,rt,dn,at=[],be,$a={useRecords:!1,mapsAsObjects:!0};class Qh{}const ga=new Qh;ga.name="MessagePack 0xC1";var Mn=!1,Zh=2,hg;try{new Function("")}catch{Zh=1/0}class Un{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,n){if(ue)return of(()=>(ri(),this?this.unpack(e,n):Un.prototype.unpack.call($a,e,n)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof Buffer<"u"?Buffer.from(e):new Uint8Array(e)),typeof n=="object"?(rn=n.end||e.length,T=n.start||0):(T=0,rn=n>-1?n:e.length),Qt=0,In=null,rt=null,ue=e;try{be=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw ue=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof Un){if(Be=this,this.structures)return Se=this.structures,Ps(n);(!Se||Se.length>0)&&(Se=[])}else Be=$a,(!Se||Se.length>0)&&(Se=[]);return Ps(n)}unpackMultiple(e,n){let r,s=0;try{Mn=!0;let i=e.length,a=this?this.unpack(e,i):Oi.unpack(e,i);if(n){if(n(a,s,T)===!1)return;for(;T<i;)if(s=T,n(Ps(),s,T)===!1)return}else{for(r=[a];T<i;)s=T,r.push(Ps());return r}}catch(i){throw i.lastPosition=s,i.values=r,i}finally{Mn=!1,ri()}}_mergeStructures(e,n){e=e||[],Object.isFrozen(e)&&(e=e.map(r=>r.slice(0)));for(let r=0,s=e.length;r<s;r++){let i=e[r];i&&(i.isShared=!0,r>=32&&(i.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in n||[])if(r>=0){let s=e[r],i=n[r];i&&(s&&((e.restoreStructures||(e.restoreStructures=[]))[r]=s),e[r]=i)}return this.structures=e}decode(e,n){return this.unpack(e,n)}}function Ps(t){try{if(!Be.trusted&&!Mn){let n=Se.sharedLength||0;n<Se.length&&(Se.length=n)}let e;if(Be.randomAccessStructure&&ue[T]<64&&ue[T]>=32&&hg||(e=Ge()),rt&&(T=rt.postBundlePosition,rt=null),Mn&&(Se.restoreStructures=null),T==rn)Se&&Se.restoreStructures&&Va(),Se=null,ue=null,dn&&(dn=null);else{if(T>rn)throw new Error("Unexpected end of MessagePack data");if(!Mn){let n;try{n=JSON.stringify(e,(r,s)=>typeof s=="bigint"?`${s}n`:s).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return e}catch(e){throw Se&&Se.restoreStructures&&Va(),ri(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||T>rn)&&(e.incomplete=!0),e}}function Va(){for(let t in Se.restoreStructures)Se[t]=Se.restoreStructures[t];Se.restoreStructures=null}function Ge(){let t=ue[T++];if(t<160)if(t<128){if(t<64)return t;{let e=Se[t&63]||Be.getStructures&&ef()[t&63];return e?(e.read||(e.read=pa(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,Be.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=nf();r==="__proto__"&&(r="__proto_"),e[r]=Ge()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set(Ge(),Ge());return e}else{t-=144;let e=new Array(t);for(let n=0;n<t;n++)e[n]=Ge();return Be.freezeData?Object.freeze(e):e}else if(t<192){let e=t-160;if(Qt>=T)return In.slice(T-Lt,(T+=e)-Lt);if(Qt==0&&rn<140){let n=e<16?ma(e):tf(e);if(n!=null)return n}return eo(e)}else{let e;switch(t){case 192:return null;case 193:return rt?(e=Ge(),e>0?rt[1].slice(rt.position1,rt.position1+=e):rt[0].slice(rt.position0,rt.position0-=e)):ga;case 194:return!1;case 195:return!0;case 196:if(e=ue[T++],e===void 0)throw new Error("Unexpected end of buffer");return ki(e);case 197:return e=be.getUint16(T),T+=2,ki(e);case 198:return e=be.getUint32(T),T+=4,ki(e);case 199:return Gn(ue[T++]);case 200:return e=be.getUint16(T),T+=2,Gn(e);case 201:return e=be.getUint32(T),T+=4,Gn(e);case 202:if(e=be.getFloat32(T),Be.useFloat32>2){let n=Ii[(ue[T]&127)<<1|ue[T+1]>>7];return T+=4,(n*e+(e>0?.5:-.5)>>0)/n}return T+=4,e;case 203:return e=be.getFloat64(T),T+=8,e;case 204:return ue[T++];case 205:return e=be.getUint16(T),T+=2,e;case 206:return e=be.getUint32(T),T+=4,e;case 207:return Be.int64AsType==="number"?(e=be.getUint32(T)*4294967296,e+=be.getUint32(T+4)):Be.int64AsType==="string"?e=be.getBigUint64(T).toString():Be.int64AsType==="auto"?(e=be.getBigUint64(T),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=be.getBigUint64(T),T+=8,e;case 208:return be.getInt8(T++);case 209:return e=be.getInt16(T),T+=2,e;case 210:return e=be.getInt32(T),T+=4,e;case 211:return Be.int64AsType==="number"?(e=be.getInt32(T)*4294967296,e+=be.getUint32(T+4)):Be.int64AsType==="string"?e=be.getBigInt64(T).toString():Be.int64AsType==="auto"?(e=be.getBigInt64(T),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=be.getBigInt64(T),T+=8,e;case 212:if(e=ue[T++],e==114)return Ya(ue[T++]&63);{let n=at[e];if(n)return n.read?(T++,n.read(Ge())):n.noBuffer?(T++,n()):n(ue.subarray(T,++T));throw new Error("Unknown extension "+e)}case 213:return e=ue[T],e==114?(T++,Ya(ue[T++]&63,ue[T++])):Gn(2);case 214:return Gn(4);case 215:return Gn(8);case 216:return Gn(16);case 217:return e=ue[T++],Qt>=T?In.slice(T-Lt,(T+=e)-Lt):dg(e);case 218:return e=be.getUint16(T),T+=2,Qt>=T?In.slice(T-Lt,(T+=e)-Lt):gg(e);case 219:return e=be.getUint32(T),T+=4,Qt>=T?In.slice(T-Lt,(T+=e)-Lt):pg(e);case 220:return e=be.getUint16(T),T+=2,za(e);case 221:return e=be.getUint32(T),T+=4,za(e);case 222:return e=be.getUint16(T),T+=2,Ka(e);case 223:return e=be.getUint32(T),T+=4,Ka(e);default:if(t>=224)return t-256;if(t===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+t)}}}const fg=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function pa(t,e){function n(){if(n.count++>Zh){let s=t.read=new Function("r","return function(){return "+(Be.freezeData?"Object.freeze":"")+"({"+t.map(i=>i==="__proto__"?"__proto_:r()":fg.test(i)?i+":r()":"["+JSON.stringify(i)+"]:r()").join(",")+"})}")(Ge);return t.highByte===0&&(t.read=Ha(e,t.read)),s()}let r={};for(let s=0,i=t.length;s<i;s++){let a=t[s];a==="__proto__"&&(a="__proto_"),r[a]=Ge()}return Be.freezeData?Object.freeze(r):r}return n.count=0,t.highByte===0?Ha(e,n):n}const Ha=(t,e)=>function(){let n=ue[T++];if(n===0)return e();let r=t<32?-(t+(n<<5)):t+(n<<5),s=Se[r]||ef()[r];if(!s)throw new Error("Record id is not defined for "+r);return s.read||(s.read=pa(s,t)),s.read()};function ef(){let t=of(()=>(ue=null,Be.getStructures()));return Se=Be._mergeStructures(t,Se)}var eo=vs,dg=vs,gg=vs,pg=vs;let mg=!1;function vs(t){let e;if(t<16&&(e=ma(t)))return e;if(t>64&&Zi)return Zi.decode(ue.subarray(T,T+=t));const n=T+t,r=[];for(e="";T<n;){const s=ue[T++];if(!(s&128))r.push(s);else if((s&224)===192){const i=ue[T++]&63;r.push((s&31)<<6|i)}else if((s&240)===224){const i=ue[T++]&63,a=ue[T++]&63;r.push((s&31)<<12|i<<6|a)}else if((s&248)===240){const i=ue[T++]&63,a=ue[T++]&63,f=ue[T++]&63;let d=(s&7)<<18|i<<12|a<<6|f;d>65535&&(d-=65536,r.push(d>>>10&1023|55296),d=56320|d&1023),r.push(d)}else r.push(s);r.length>=4096&&(e+=et.apply(String,r),r.length=0)}return r.length>0&&(e+=et.apply(String,r)),e}function za(t){let e=new Array(t);for(let n=0;n<t;n++)e[n]=Ge();return Be.freezeData?Object.freeze(e):e}function Ka(t){if(Be.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=nf();r==="__proto__"&&(r="__proto_"),e[r]=Ge()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set(Ge(),Ge());return e}}var et=String.fromCharCode;function tf(t){let e=T,n=new Array(t);for(let r=0;r<t;r++){const s=ue[T++];if((s&128)>0){T=e;return}n[r]=s}return et.apply(String,n)}function ma(t){if(t<4)if(t<2){if(t===0)return"";{let e=ue[T++];if((e&128)>1){T-=1;return}return et(e)}}else{let e=ue[T++],n=ue[T++];if((e&128)>0||(n&128)>0){T-=2;return}if(t<3)return et(e,n);let r=ue[T++];if((r&128)>0){T-=3;return}return et(e,n,r)}else{let e=ue[T++],n=ue[T++],r=ue[T++],s=ue[T++];if((e&128)>0||(n&128)>0||(r&128)>0||(s&128)>0){T-=4;return}if(t<6){if(t===4)return et(e,n,r,s);{let i=ue[T++];if((i&128)>0){T-=5;return}return et(e,n,r,s,i)}}else if(t<8){let i=ue[T++],a=ue[T++];if((i&128)>0||(a&128)>0){T-=6;return}if(t<7)return et(e,n,r,s,i,a);let f=ue[T++];if((f&128)>0){T-=7;return}return et(e,n,r,s,i,a,f)}else{let i=ue[T++],a=ue[T++],f=ue[T++],d=ue[T++];if((i&128)>0||(a&128)>0||(f&128)>0||(d&128)>0){T-=8;return}if(t<10){if(t===8)return et(e,n,r,s,i,a,f,d);{let h=ue[T++];if((h&128)>0){T-=9;return}return et(e,n,r,s,i,a,f,d,h)}}else if(t<12){let h=ue[T++],A=ue[T++];if((h&128)>0||(A&128)>0){T-=10;return}if(t<11)return et(e,n,r,s,i,a,f,d,h,A);let y=ue[T++];if((y&128)>0){T-=11;return}return et(e,n,r,s,i,a,f,d,h,A,y)}else{let h=ue[T++],A=ue[T++],y=ue[T++],g=ue[T++];if((h&128)>0||(A&128)>0||(y&128)>0||(g&128)>0){T-=12;return}if(t<14){if(t===12)return et(e,n,r,s,i,a,f,d,h,A,y,g);{let b=ue[T++];if((b&128)>0){T-=13;return}return et(e,n,r,s,i,a,f,d,h,A,y,g,b)}}else{let b=ue[T++],E=ue[T++];if((b&128)>0||(E&128)>0){T-=14;return}if(t<15)return et(e,n,r,s,i,a,f,d,h,A,y,g,b,E);let C=ue[T++];if((C&128)>0){T-=15;return}return et(e,n,r,s,i,a,f,d,h,A,y,g,b,E,C)}}}}}function Ga(){let t=ue[T++],e;if(t<192)e=t-160;else switch(t){case 217:e=ue[T++];break;case 218:e=be.getUint16(T),T+=2;break;case 219:e=be.getUint32(T),T+=4;break;default:throw new Error("Expected string")}return vs(e)}function ki(t){return Be.copyBuffers?Uint8Array.prototype.slice.call(ue,T,T+=t):ue.subarray(T,T+=t)}function Gn(t){let e=ue[T++];if(at[e]){let n;return at[e](ue.subarray(T,n=T+=t),r=>{T=r;try{return Ge()}finally{T=n}})}else throw new Error("Unknown extension type "+e)}var Wa=new Array(4096);function nf(){let t=ue[T++];if(t>=160&&t<192){if(t=t-160,Qt>=T)return In.slice(T-Lt,(T+=t)-Lt);if(!(Qt==0&&rn<180))return eo(t)}else return T--,rf(Ge());let e=(t<<5^(t>1?be.getUint16(T):t>0?ue[T]:0))&4095,n=Wa[e],r=T,s=T+t-3,i,a=0;if(n&&n.bytes==t){for(;r<s;){if(i=be.getUint32(r),i!=n[a++]){r=1879048192;break}r+=4}for(s+=3;r<s;)if(i=ue[r++],i!=n[a++]){r=1879048192;break}if(r===s)return T=r,n.string;s-=3,r=T}for(n=[],Wa[e]=n,n.bytes=t;r<s;)i=be.getUint32(r),n.push(i),r+=4;for(s+=3;r<s;)i=ue[r++],n.push(i);let f=t<16?ma(t):tf(t);return f!=null?n.string=f:n.string=eo(t)}function rf(t){if(typeof t=="string")return t;if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(t==null)return t+"";if(Be.allowArraysInMapKeys&&Array.isArray(t)&&t.flat().every(e=>["string","number","boolean","bigint"].includes(typeof e)))return t.flat().toString();throw new Error(`Invalid property type for record: ${typeof t}`)}const Ya=(t,e)=>{let n=Ge().map(rf),r=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,n.highByte=e);let s=Se[t];return s&&(s.isShared||Mn)&&((Se.restoreStructures||(Se.restoreStructures=[]))[t]=s),Se[t]=n,n.read=pa(n,r),n.read()};at[0]=()=>{};at[0].noBuffer=!0;at[66]=t=>{let e=t.length,n=BigInt(t[0]&128?t[0]-256:t[0]);for(let r=1;r<e;r++)n<<=BigInt(8),n+=BigInt(t[r]);return n};let yg={Error,TypeError,ReferenceError};at[101]=()=>{let t=Ge();return(yg[t[0]]||Error)(t[1],{cause:t[2]})};at[105]=t=>{if(Be.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=be.getUint32(T-4);dn||(dn=new Map);let n=ue[T],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let s={target:r};dn.set(e,s);let i=Ge();return s.used?Object.assign(r,i):(s.target=i,i)};at[112]=t=>{if(Be.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=be.getUint32(T-4),n=dn.get(e);return n.used=!0,n.target};at[115]=()=>new Set(Ge());const sf=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");let wg=typeof globalThis=="object"?globalThis:window;at[116]=t=>{let e=t[0],n=sf[e];if(!n){if(e===16){let r=new ArrayBuffer(t.length-1);return new Uint8Array(r).set(t.subarray(1)),r}throw new Error("Could not find typed array for code "+e)}return new wg[n](Uint8Array.prototype.slice.call(t,1).buffer)};at[120]=()=>{let t=Ge();return new RegExp(t[0],t[1])};const Ag=[];at[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],n=T;return T+=e-t.length,rt=Ag,rt=[Ga(),Ga()],rt.position0=0,rt.position1=0,rt.postBundlePosition=T,T=n,Ge()};at[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function of(t){let e=rn,n=T,r=Lt,s=Qt,i=In,a=dn,f=rt,d=new Uint8Array(ue.slice(0,rn)),h=Se,A=Se.slice(0,Se.length),y=Be,g=Mn,b=t();return rn=e,T=n,Lt=r,Qt=s,In=i,dn=a,rt=f,ue=d,Mn=g,Se=h,Se.splice(0,Se.length,...A),Be=y,be=new DataView(ue.buffer,ue.byteOffset,ue.byteLength),b}function ri(){ue=null,dn=null,Se=null}function xg(t){t.unpack?at[t.type]=t.unpack:at[t.type]=t}const Ii=new Array(147);for(let t=0;t<256;t++)Ii[t]=+("1e"+Math.floor(45.15-t*.30103));const bg=Un;var Oi=new Un({useRecords:!1});const vg=Oi.unpack,Eg=Oi.unpackMultiple,Sg=Oi.unpack,af={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4};let lf=new Float32Array(1),Xa=new Uint8Array(lf.buffer,0,4);function Ig(t){lf[0]=t;let e=Ii[(Xa[3]&127)<<1|Xa[2]>>7];return(e*t+(t>0?.5:-.5)>>0)/e}let Us;try{Us=new TextEncoder}catch{}let si,ya;const Ri=typeof Buffer<"u",Ds=Ri?function(t){return Buffer.allocUnsafeSlow(t)}:Uint8Array,uf=Ri?Buffer:Uint8Array,Ja=Ri?4294967296:2144337920;let F,ts,De,P=0,ut,Le=null,Og;const Rg=21760,Mg=/[\u0080-\uFFFF]/,mr=Symbol("record-id");class Es extends Un{constructor(e){super(e),this.offset=0;let n,r,s,i,a=uf.prototype.utf8Write?function(M,K){return F.utf8Write(M,K,F.byteLength-K)}:Us&&Us.encodeInto?function(M,K){return Us.encodeInto(M,F.subarray(K)).written}:!1,f=this;e||(e={});let d=e&&e.sequential,h=e.structures||e.saveStructures,A=e.maxSharedStructures;if(A==null&&(A=h?32:0),A>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let y=e.maxOwnStructures;y==null&&(y=h?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let g=A>32||y+A>64,b=A+64,E=A+y+64;if(E>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let C=[],v=0,S=0;this.pack=this.encode=function(M,K){if(F||(F=new Ds(8192),De=F.dataView||(F.dataView=new DataView(F.buffer,0,8192)),P=0),ut=F.length-10,ut-P<2048?(F=new Ds(F.length),De=F.dataView||(F.dataView=new DataView(F.buffer,0,F.length)),ut=F.length-10,P=0):P=P+7&2147483640,n=P,K&df&&(P+=K&255),i=f.structuredClone?new Map:null,f.bundleStrings&&typeof M!="string"?(Le=[],Le.size=1/0):Le=null,s=f.structures,s){s.uninitialized&&(s=f._mergeStructures(f.getStructures()));let _=s.sharedLength||0;if(_>A)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+s.sharedLength);if(!s.transitions){s.transitions=Object.create(null);for(let $=0;$<_;$++){let te=s[$];if(!te)continue;let he,oe=s.transitions;for(let ye=0,le=te.length;ye<le;ye++){let Fe=te[ye];he=oe[Fe],he||(he=oe[Fe]=Object.create(null)),oe=he}oe[mr]=$+64}this.lastNamedStructuresLength=_}d||(s.nextId=_+64)}r&&(r=!1);let z;try{f.randomAccessStructure&&M&&M.constructor&&M.constructor===Object?fe(M):ee(M);let _=Le;if(Le&&el(n,ee,0),i&&i.idsToInsert){let $=i.idsToInsert.sort((ye,le)=>ye.offset>le.offset?1:-1),te=$.length,he=-1;for(;_&&te>0;){let ye=$[--te].offset+n;ye<_.stringsPosition+n&&he===-1&&(he=0),ye>_.position+n?he>=0&&(he+=6):(he>=0&&(De.setUint32(_.position+n,De.getUint32(_.position+n)+he),he=-1),_=_.previous,te++)}he>=0&&_&&De.setUint32(_.position+n,De.getUint32(_.position+n)+he),P+=$.length*6,P>ut&&Y(P),f.offset=P;let oe=Cg(F.subarray(n,P),$);return i=null,oe}return f.offset=P,K&hf?(F.start=n,F.end=P,F):F.subarray(n,P)}catch(_){throw z=_,_}finally{if(s&&(j(),r&&f.saveStructures)){let _=s.sharedLength||0,$=F.subarray(n,P),te=Dg(s,f);if(!z)return f.saveStructures(te,te.isCompatible)===!1?f.pack(M,K):(f.lastNamedStructuresLength=_,F.length>1073741824&&(F=null),$)}F.length>1073741824&&(F=null),K&ff&&(P=n)}};const j=()=>{S<10&&S++;let M=s.sharedLength||0;if(s.length>M&&!d&&(s.length=M),v>1e4)s.transitions=null,S=0,v=0,C.length>0&&(C=[]);else if(C.length>0&&!d){for(let K=0,z=C.length;K<z;K++)C[K][mr]=0;C=[]}},W=M=>{var K=M.length;K<16?F[P++]=144|K:K<65536?(F[P++]=220,F[P++]=K>>8,F[P++]=K&255):(F[P++]=221,De.setUint32(P,K),P+=4);for(let z=0;z<K;z++)ee(M[z])},ee=M=>{P>ut&&(F=Y(P));var K=typeof M,z;if(K==="string"){let _=M.length;if(Le&&_>=4&&_<4096){if((Le.size+=_)>Rg){let oe,ye=(Le[0]?Le[0].length*3+Le[1].length:0)+10;P+ye>ut&&(F=Y(P+ye));let le;Le.position?(le=Le,F[P]=200,P+=3,F[P++]=98,oe=P-n,P+=4,el(n,ee,0),De.setUint16(oe+n-3,P-n-oe)):(F[P++]=214,F[P++]=98,oe=P-n,P+=4),Le=["",""],Le.previous=le,Le.size=0,Le.position=oe}let he=Mg.test(M);Le[he?0:1]+=M,F[P++]=193,ee(he?-_:_);return}let $;_<32?$=1:_<256?$=2:_<65536?$=3:$=5;let te=_*3;if(P+te>ut&&(F=Y(P+te)),_<64||!a){let he,oe,ye,le=P+$;for(he=0;he<_;he++)oe=M.charCodeAt(he),oe<128?F[le++]=oe:oe<2048?(F[le++]=oe>>6|192,F[le++]=oe&63|128):(oe&64512)===55296&&((ye=M.charCodeAt(he+1))&64512)===56320?(oe=65536+((oe&1023)<<10)+(ye&1023),he++,F[le++]=oe>>18|240,F[le++]=oe>>12&63|128,F[le++]=oe>>6&63|128,F[le++]=oe&63|128):(F[le++]=oe>>12|224,F[le++]=oe>>6&63|128,F[le++]=oe&63|128);z=le-P-$}else z=a(M,P+$);z<32?F[P++]=160|z:z<256?($<2&&F.copyWithin(P+2,P+1,P+1+z),F[P++]=217,F[P++]=z):z<65536?($<3&&F.copyWithin(P+3,P+2,P+2+z),F[P++]=218,F[P++]=z>>8,F[P++]=z&255):($<5&&F.copyWithin(P+5,P+3,P+3+z),F[P++]=219,De.setUint32(P,z),P+=4),P+=z}else if(K==="number")if(M>>>0===M)M<32||M<128&&this.useRecords===!1||M<64&&!this.randomAccessStructure?F[P++]=M:M<256?(F[P++]=204,F[P++]=M):M<65536?(F[P++]=205,F[P++]=M>>8,F[P++]=M&255):(F[P++]=206,De.setUint32(P,M),P+=4);else if(M>>0===M)M>=-32?F[P++]=256+M:M>=-128?(F[P++]=208,F[P++]=M+256):M>=-32768?(F[P++]=209,De.setInt16(P,M),P+=2):(F[P++]=210,De.setInt32(P,M),P+=4);else{let _;if((_=this.useFloat32)>0&&M<4294967296&&M>=-2147483648){F[P++]=202,De.setFloat32(P,M);let $;if(_<4||($=M*Ii[(F[P]&127)<<1|F[P+1]>>7])>>0===$){P+=4;return}else P--}F[P++]=203,De.setFloat64(P,M),P+=8}else if(K==="object"||K==="function")if(!M)F[P++]=192;else{if(i){let $=i.get(M);if($){if(!$.id){let te=i.idsToInsert||(i.idsToInsert=[]);$.id=te.push($)}F[P++]=214,F[P++]=112,De.setUint32(P,$.id),P+=4;return}else i.set(M,{offset:P-n})}let _=M.constructor;if(_===Object)N(M);else if(_===Array)W(M);else if(_===Map)if(this.mapAsEmptyObject)F[P++]=128;else{z=M.size,z<16?F[P++]=128|z:z<65536?(F[P++]=222,F[P++]=z>>8,F[P++]=z&255):(F[P++]=223,De.setUint32(P,z),P+=4);for(let[$,te]of M)ee($),ee(te)}else{for(let $=0,te=si.length;$<te;$++){let he=ya[$];if(M instanceof he){let oe=si[$];if(oe.write){oe.type&&(F[P++]=212,F[P++]=oe.type,F[P++]=0);let ct=oe.write.call(this,M);ct===M?Array.isArray(M)?W(M):N(M):ee(ct);return}let ye=F,le=De,Fe=P;F=null;let We;try{We=oe.pack.call(this,M,ct=>(F=ye,ye=null,P+=ct,P>ut&&Y(P),{target:F,targetView:De,position:P-ct}),ee)}finally{ye&&(F=ye,De=le,P=Fe,ut=F.length-10)}We&&(We.length+P>ut&&Y(We.length+P),P=Tg(We,F,P,oe.type));return}}if(Array.isArray(M))W(M);else{if(M.toJSON){const $=M.toJSON();if($!==M)return ee($)}if(K==="function")return ee(this.writeFunction&&this.writeFunction(M));N(M)}}}else if(K==="boolean")F[P++]=M?195:194;else if(K==="bigint"){if(M<BigInt(1)<<BigInt(63)&&M>=-(BigInt(1)<<BigInt(63)))F[P++]=211,De.setBigInt64(P,M);else if(M<BigInt(1)<<BigInt(64)&&M>0)F[P++]=207,De.setBigUint64(P,M);else if(this.largeBigIntToFloat)F[P++]=203,De.setFloat64(P,Number(M));else{if(this.largeBigIntToString)return ee(M.toString());if(this.useBigIntExtension&&M<BigInt(2)**BigInt(1023)&&M>-(BigInt(2)**BigInt(1023))){F[P++]=199,P++,F[P++]=66;let _=[],$;do{let te=M&BigInt(255);$=(te&BigInt(128))===(M<BigInt(0)?BigInt(128):BigInt(0)),_.push(te),M>>=BigInt(8)}while(!((M===BigInt(0)||M===BigInt(-1))&&$));F[P-2]=_.length;for(let te=_.length;te>0;)F[P++]=Number(_[--te]);return}else throw new RangeError(M+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}P+=8}else if(K==="undefined")this.encodeUndefinedAsNil?F[P++]=192:(F[P++]=212,F[P++]=0,F[P++]=0);else throw new Error("Unknown type: "+K)},re=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?M=>{let K;if(this.skipValues){K=[];for(let $ in M)(typeof M.hasOwnProperty!="function"||M.hasOwnProperty($))&&!this.skipValues.includes(M[$])&&K.push($)}else K=Object.keys(M);let z=K.length;z<16?F[P++]=128|z:z<65536?(F[P++]=222,F[P++]=z>>8,F[P++]=z&255):(F[P++]=223,De.setUint32(P,z),P+=4);let _;if(this.coercibleKeyAsNumber)for(let $=0;$<z;$++){_=K[$];let te=Number(_);ee(isNaN(te)?_:te),ee(M[_])}else for(let $=0;$<z;$++)ee(_=K[$]),ee(M[_])}:M=>{F[P++]=222;let K=P-n;P+=2;let z=0;for(let _ in M)(typeof M.hasOwnProperty!="function"||M.hasOwnProperty(_))&&(ee(_),ee(M[_]),z++);if(z>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');F[K+++n]=z>>8,F[K+n]=z&255},R=this.useRecords===!1?re:e.progressiveRecords&&!g?M=>{let K,z=s.transitions||(s.transitions=Object.create(null)),_=P++-n,$;for(let te in M)if(typeof M.hasOwnProperty!="function"||M.hasOwnProperty(te)){if(K=z[te],K)z=K;else{let he=Object.keys(M),oe=z;z=s.transitions;let ye=0;for(let le=0,Fe=he.length;le<Fe;le++){let We=he[le];K=z[We],K||(K=z[We]=Object.create(null),ye++),z=K}_+n+1==P?(P--,Q(z,he,ye)):ie(z,he,_,ye),$=!0,z=oe[te]}ee(M[te])}if(!$){let te=z[mr];te?F[_+n]=te:ie(z,Object.keys(M),_,0)}}:M=>{let K,z=s.transitions||(s.transitions=Object.create(null)),_=0;for(let te in M)(typeof M.hasOwnProperty!="function"||M.hasOwnProperty(te))&&(K=z[te],K||(K=z[te]=Object.create(null),_++),z=K);let $=z[mr];$?$>=96&&g?(F[P++]=(($-=96)&31)+96,F[P++]=$>>5):F[P++]=$:Q(z,z.__keys__||Object.keys(M),_);for(let te in M)(typeof M.hasOwnProperty!="function"||M.hasOwnProperty(te))&&ee(M[te])},D=typeof this.useRecords=="function"&&this.useRecords,N=D?M=>{D(M)?R(M):re(M)}:R,Y=M=>{let K;if(M>16777216){if(M-n>Ja)throw new Error("Packed buffer would be larger than maximum buffer size");K=Math.min(Ja,Math.round(Math.max((M-n)*(M>67108864?1.25:2),4194304)/4096)*4096)}else K=(Math.max(M-n<<2,F.length-1)>>12)+1<<12;let z=new Ds(K);return De=z.dataView||(z.dataView=new DataView(z.buffer,0,K)),M=Math.min(M,F.length),F.copy?F.copy(z,0,n,M):z.set(F.slice(n,M)),P-=n,n=0,ut=z.length-10,F=z},Q=(M,K,z)=>{let _=s.nextId;_||(_=64),_<b&&this.shouldShareStructure&&!this.shouldShareStructure(K)?(_=s.nextOwnId,_<E||(_=b),s.nextOwnId=_+1):(_>=E&&(_=b),s.nextId=_+1);let $=K.highByte=_>=96&&g?_-96>>5:-1;M[mr]=_,M.__keys__=K,s[_-64]=K,_<b?(K.isShared=!0,s.sharedLength=_-63,r=!0,$>=0?(F[P++]=(_&31)+96,F[P++]=$):F[P++]=_):($>=0?(F[P++]=213,F[P++]=114,F[P++]=(_&31)+96,F[P++]=$):(F[P++]=212,F[P++]=114,F[P++]=_),z&&(v+=S*z),C.length>=y&&(C.shift()[mr]=0),C.push(M),ee(K))},ie=(M,K,z,_)=>{let $=F,te=P,he=ut,oe=n;F=ts,P=0,n=0,F||(ts=F=new Ds(8192)),ut=F.length-10,Q(M,K,_),ts=F;let ye=P;if(F=$,P=te,ut=he,n=oe,ye>1){let le=P+ye-1;le>ut&&Y(le);let Fe=z+n;F.copyWithin(Fe+ye,Fe+1,P),F.set(ts.slice(0,ye),Fe),P=le}else F[z+n]=ts[0]},fe=M=>{let K=Og(M,F,n,P,s,Y,(z,_,$)=>{if($)return r=!0;P=_;let te=F;return ee(z),j(),te!==F?{position:P,targetView:De,target:F}:P},this);if(K===0)return N(M);P=K}}useBuffer(e){F=e,F.dataView||(F.dataView=new DataView(F.buffer,F.byteOffset,F.byteLength)),P=0}set position(e){P=e}get position(){return P}set buffer(e){F=e}get buffer(){return F}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}ya=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Qh];si=[{pack(t,e,n){let r=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:s,targetView:i,position:a}=e(6);s[a++]=214,s[a++]=255,i.setUint32(a,r)}else if(r>0&&r<4294967296){let{target:s,targetView:i,position:a}=e(10);s[a++]=215,s[a++]=255,i.setUint32(a,t.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),i.setUint32(a+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),n(this.onInvalidDate());let{target:s,targetView:i,position:a}=e(3);s[a++]=212,s[a++]=255,s[a++]=255}else{let{target:s,targetView:i,position:a}=e(15);s[a++]=199,s[a++]=12,s[a++]=255,i.setUint32(a,t.getMilliseconds()*1e6),i.setBigInt64(a+4,BigInt(Math.floor(r)))}}},{pack(t,e,n){if(this.setAsEmptyObject)return e(0),n({});let r=Array.from(t),{target:s,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(s[i++]=212,s[i++]=115,s[i++]=0),n(r)}},{pack(t,e,n){let{target:r,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(r[s++]=212,r[s++]=101,r[s++]=0),n([t.name,t.message,t.cause])}},{pack(t,e,n){let{target:r,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(r[s++]=212,r[s++]=120,r[s++]=0),n([t.source,t.flags])}},{pack(t,e){this.moreTypes?Qa(t,16,e):Za(Ri?Buffer.from(t):new Uint8Array(t),e)}},{pack(t,e){let n=t.constructor;n!==uf&&this.moreTypes?Qa(t,sf.indexOf(n.name),e):Za(t,e)}},{pack(t,e){let{target:n,position:r}=e(1);n[r]=193}}];function Qa(t,e,n,r){let s=t.byteLength;if(s+1<256){var{target:i,position:a}=n(4+s);i[a++]=199,i[a++]=s+1}else if(s+1<65536){var{target:i,position:a}=n(5+s);i[a++]=200,i[a++]=s+1>>8,i[a++]=s+1&255}else{var{target:i,position:a,targetView:f}=n(7+s);i[a++]=201,f.setUint32(a,s+1),a+=4}i[a++]=116,i[a++]=e,t.buffer||(t=new Uint8Array(t)),i.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),a)}function Za(t,e){let n=t.byteLength;var r,s;if(n<256){var{target:r,position:s}=e(n+2);r[s++]=196,r[s++]=n}else if(n<65536){var{target:r,position:s}=e(n+3);r[s++]=197,r[s++]=n>>8,r[s++]=n&255}else{var{target:r,position:s,targetView:i}=e(n+5);r[s++]=198,i.setUint32(s,n),s+=4}r.set(t,s)}function Tg(t,e,n,r){let s=t.length;switch(s){case 1:e[n++]=212;break;case 2:e[n++]=213;break;case 4:e[n++]=214;break;case 8:e[n++]=215;break;case 16:e[n++]=216;break;default:s<256?(e[n++]=199,e[n++]=s):s<65536?(e[n++]=200,e[n++]=s>>8,e[n++]=s&255):(e[n++]=201,e[n++]=s>>24,e[n++]=s>>16&255,e[n++]=s>>8&255,e[n++]=s&255)}return e[n++]=r,e.set(t,n),n+=s,n}function Cg(t,e){let n,r=e.length*6,s=t.length-r;for(;n=e.pop();){let i=n.offset,a=n.id;t.copyWithin(i+r,i,s),r-=6;let f=i+r;t[f++]=214,t[f++]=105,t[f++]=a>>24,t[f++]=a>>16&255,t[f++]=a>>8&255,t[f++]=a&255,s=i}return t}function el(t,e,n){if(Le.length>0){De.setUint32(Le.position+t,P+n-Le.position-t),Le.stringsPosition=P-t;let r=Le;Le=null,e(r[0]),e(r[1])}}function Pg(t){if(t.Class){if(!t.pack&&!t.write)throw new Error("Extension has no pack or write function");if(t.pack&&!t.type)throw new Error("Extension has no type (numeric code to identify the extension)");ya.unshift(t.Class),si.unshift(t)}xg(t)}function Dg(t,e){return t.isCompatible=n=>{let r=!n||(e.lastNamedStructuresLength||0)===n.length;return r||e._mergeStructures(n),r},t}let cf=new Es({useRecords:!1});const Bg=cf.pack,kg=cf.pack,qg=Es,{NEVER:Fg,ALWAYS:Ng,DECIMAL_ROUND:Lg,DECIMAL_FIT:Ug}=af,hf=512,ff=1024,df=2048;function _g(t,e={}){if(!t||typeof t!="object")throw new Error("first argument must be an Iterable, Async Iterable, or a Promise for an Async Iterable");if(typeof t[Symbol.iterator]=="function")return jg(t,e);if(typeof t.then=="function"||typeof t[Symbol.asyncIterator]=="function")return $g(t,e);throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a Promise")}function*jg(t,e){const n=new Es(e);for(const r of t)yield n.pack(r)}async function*$g(t,e){const n=new Es(e);for await(const r of t)yield n.pack(r)}function Vg(t,e={}){if(!t||typeof t!="object")throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a promise");const n=new Un(e);let r;const s=i=>{let a;r&&(i=Buffer.concat([r,i]),r=void 0);try{a=n.unpackMultiple(i)}catch(f){if(f.incomplete)r=i.slice(f.lastPosition),a=f.values;else throw f}return a};if(typeof t[Symbol.iterator]=="function")return function*(){for(const a of t)yield*s(a)}();if(typeof t[Symbol.asyncIterator]=="function")return async function*(){for await(const a of t)yield*s(a)}()}const Hg=Vg,zg=_g,Kg=!1,Gg=!0,Wg=Object.freeze(Object.defineProperty({__proto__:null,ALWAYS:Ng,C1:ga,DECIMAL_FIT:Ug,DECIMAL_ROUND:Lg,Decoder:bg,Encoder:qg,FLOAT32_OPTIONS:af,NEVER:Fg,Packr:Es,RESERVE_START_SPACE:df,RESET_BUFFER_MODE:ff,REUSE_BUFFER_MODE:hf,Unpackr:Un,addExtension:Pg,clearSource:ri,decode:Sg,decodeIter:Hg,encode:kg,encodeIter:zg,isNativeAccelerationEnabled:mg,mapsAsObjects:Gg,pack:Bg,roundFloat32:Ig,unpack:vg,unpackMultiple:Eg,useRecords:Kg},Symbol.toStringTag,{value:"Module"})),Yg=ia(Wg);var Xg=Gh,Nt=ha,tl=Ei,Jg=fa,Bs=da,it=ca,Qg=Si,nl=bs,rl=Yg;let Zg=class gf{constructor(e,n){this.onStateChange=Bs.createSignal(),this.onError=Bs.createSignal(),this.onLeave=Bs.createSignal(),this.onJoin=Bs.createSignal(),this.hasJoined=!1,this.onMessageHandlers=Jg.createNanoEvents(),this.roomId=null,this.name=e,this.packr=new rl.Packr,this.packr.encode(void 0),n&&(this.serializer=new(tl.getSerializer("schema")),this.rootSchema=n,this.serializer.state=new n),this.onError((r,s)=>{var i;return(i=console.warn)===null||i===void 0?void 0:i.call(console,`colyseus.js - onError => (${r}) ${s}`)}),this.onLeave(()=>this.removeAllListeners())}connect(e,n,r=this,s,i){const a=new Xg.Connection(s.protocol);if(r.connection=a,a.events.onmessage=gf.prototype.onMessageCallback.bind(r),a.events.onclose=function(f){var d;if(!r.hasJoined){(d=console.warn)===null||d===void 0||d.call(console,`Room connection was closed unexpectedly (${f.code}): ${f.reason}`),r.onError.invoke(f.code,f.reason);return}f.code===nl.CloseCode.DEVMODE_RESTART&&n?n():(r.onLeave.invoke(f.code,f.reason),r.destroy())},a.events.onerror=function(f){var d;(d=console.warn)===null||d===void 0||d.call(console,`Room, onError (${f.code}): ${f.reason}`),r.onError.invoke(f.code,f.reason)},s.protocol==="h3"){const f=new URL(e);a.connect(f.origin,s)}else a.connect(e,i)}leave(e=!0){return new Promise(n=>{this.onLeave(r=>n(r)),this.connection?e?(this.packr.buffer[0]=Nt.Protocol.LEAVE_ROOM,this.connection.send(this.packr.buffer.subarray(0,1))):this.connection.close():this.onLeave.invoke(nl.CloseCode.CONSENTED)})}onMessage(e,n){return this.onMessageHandlers.on(this.getMessageHandlerKey(e),n)}send(e,n){const r={offset:1};this.packr.buffer[0]=Nt.Protocol.ROOM_DATA,typeof e=="string"?it.encode.string(this.packr.buffer,e,r):it.encode.number(this.packr.buffer,e,r),this.packr.position=0;const s=n!==void 0?this.packr.pack(n,2048+r.offset):this.packr.buffer.subarray(0,r.offset);this.connection.send(s)}sendUnreliable(e,n){const r={offset:1};this.packr.buffer[0]=Nt.Protocol.ROOM_DATA,typeof e=="string"?it.encode.string(this.packr.buffer,e,r):it.encode.number(this.packr.buffer,e,r),this.packr.position=0;const s=n!==void 0?this.packr.pack(n,2048+r.offset):this.packr.buffer.subarray(0,r.offset);this.connection.sendUnreliable(s)}sendBytes(e,n){const r={offset:1};if(this.packr.buffer[0]=Nt.Protocol.ROOM_DATA_BYTES,typeof e=="string"?it.encode.string(this.packr.buffer,e,r):it.encode.number(this.packr.buffer,e,r),n.byteLength+r.offset>this.packr.buffer.byteLength){const s=new Uint8Array(r.offset+n.byteLength);s.set(this.packr.buffer),this.packr.useBuffer(s)}this.packr.buffer.set(n,r.offset),this.connection.send(this.packr.buffer.subarray(0,r.offset+n.byteLength))}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={},this.serializer instanceof Qg.SchemaSerializer&&(this.serializer.decoder.root.callbacks={})}onMessageCallback(e){const n=new Uint8Array(e.data),r={offset:1},s=n[0];if(s===Nt.Protocol.JOIN_ROOM){const i=it.decode.utf8Read(n,r,n[r.offset++]);if(this.serializerId=it.decode.utf8Read(n,r,n[r.offset++]),!this.serializer){const a=tl.getSerializer(this.serializerId);this.serializer=new a}n.byteLength>r.offset&&this.serializer.handshake&&this.serializer.handshake(n,r),this.reconnectionToken=`${this.roomId}:${i}`,this.hasJoined=!0,this.onJoin.invoke(),this.packr.buffer[0]=Nt.Protocol.JOIN_ROOM,this.connection.send(this.packr.buffer.subarray(0,1))}else if(s===Nt.Protocol.ERROR){const i=it.decode.number(n,r),a=it.decode.string(n,r);this.onError.invoke(i,a)}else if(s===Nt.Protocol.LEAVE_ROOM)this.leave();else if(s===Nt.Protocol.ROOM_STATE)this.serializer.setState(n,r),this.onStateChange.invoke(this.serializer.getState());else if(s===Nt.Protocol.ROOM_STATE_PATCH)this.serializer.patch(n,r),this.onStateChange.invoke(this.serializer.getState());else if(s===Nt.Protocol.ROOM_DATA){const i=it.decode.stringCheck(n,r)?it.decode.string(n,r):it.decode.number(n,r),a=n.byteLength>r.offset?rl.unpack(n,{start:r.offset}):void 0;this.dispatchMessage(i,a)}else if(s===Nt.Protocol.ROOM_DATA_BYTES){const i=it.decode.stringCheck(n,r)?it.decode.string(n,r):it.decode.number(n,r);this.dispatchMessage(i,n.subarray(r.offset))}}dispatchMessage(e,n){var r;const s=this.getMessageHandlerKey(e);this.onMessageHandlers.events[s]?this.onMessageHandlers.emit(s,n):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",e,n):(r=console.warn)===null||r===void 0||r.call(console,`colyseus.js: onMessage() not registered for type '${e}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(e){switch(typeof e){case"string":return e;case"number":return`i${e}`;default:throw new Error("invalid message type.")}}};ua.Room=Zg;var pf={};function sl(t,e){e.headers=t.headers||{},e.statusMessage=t.statusText,e.statusCode=t.status,e.data=t.response}function Gt(t,e,n){return new Promise(function(r,s){n=n||{};var i=new XMLHttpRequest,a,f,d,h=n.body,A=n.headers||{};n.timeout&&(i.timeout=n.timeout),i.ontimeout=i.onerror=function(y){y.timeout=y.type=="timeout",s(y)},i.open(t,e.href||e),i.onload=function(){for(d=i.getAllResponseHeaders().trim().split(/[\r\n]+/),sl(i,i);f=d.shift();)f=f.split(": "),i.headers[f.shift().toLowerCase()]=f.join(": ");if(f=i.headers["content-type"],f&&~f.indexOf("application/json"))try{i.data=JSON.parse(i.data,n.reviver)}catch(y){return sl(i,y),s(y)}(i.status>=400?s:r)(i)},typeof FormData<"u"&&h instanceof FormData||h&&typeof h=="object"&&(A["content-type"]="application/json",h=JSON.stringify(h)),i.withCredentials=!!n.withCredentials;for(a in A)i.setRequestHeader(a,A[a]);i.send(h)})}var ep=Gt.bind(Gt,"GET"),tp=Gt.bind(Gt,"POST"),np=Gt.bind(Gt,"PATCH"),rp=Gt.bind(Gt,"DELETE"),sp=Gt.bind(Gt,"PUT");const ip=Object.freeze(Object.defineProperty({__proto__:null,del:rp,get:ep,patch:np,post:tp,put:sp,send:Gt},Symbol.toStringTag,{value:"Module"})),op=ia(ip);var ap=bs,lp=op;function up(t){var e=Object.create(null);return t&&Object.keys(t).forEach(function(n){if(n!=="default"){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}),e.default=t,Object.freeze(e)}var cp=up(lp);let hp=class{constructor(e,n={}){this.client=e,this.headers=n}get(e,n={}){return this.request("get",e,n)}post(e,n={}){return this.request("post",e,n)}del(e,n={}){return this.request("del",e,n)}put(e,n={}){return this.request("put",e,n)}request(e,n,r={}){return cp[e](this.client.getHttpEndpoint(n),this.getOptions(r)).catch(s=>{var i;const a=s.statusCode,f=((i=s.data)===null||i===void 0?void 0:i.error)||s.statusMessage||s.message;throw!a&&!f?s:new ap.ServerError(a,f)})}getOptions(e){return e.headers=Object.assign({},this.headers,e.headers),this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),typeof cc<"u"&&cc.sys&&cc.sys.isNative||(e.withCredentials=!0),e}};pf.HTTP=hp;var wa={},Mi={},il=vi;let Wn;function Aa(){if(!Wn)try{Wn=typeof cc<"u"&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch{}return!Wn&&typeof globalThis.indexedDB<"u"&&(Wn=new pp),Wn||(Wn={cache:{},setItem:function(t,e){this.cache[t]=e},getItem:function(t){this.cache[t]},removeItem:function(t){delete this.cache[t]}}),Wn}function fp(t,e){Aa().setItem(t,e)}function dp(t){Aa().removeItem(t)}function gp(t,e){const n=Aa().getItem(t);typeof Promise>"u"||!(n instanceof Promise)?e(n):n.then(r=>e(r))}class pp{constructor(){this.dbPromise=new Promise(e=>{const n=indexedDB.open("_colyseus_storage",1);n.onupgradeneeded=()=>n.result.createObjectStore("store"),n.onsuccess=()=>e(n.result)})}tx(e,n){return il.__awaiter(this,void 0,void 0,function*(){const s=(yield this.dbPromise).transaction("store",e).objectStore("store");return n(s)})}setItem(e,n){return this.tx("readwrite",r=>r.put(n,e)).then()}getItem(e){return il.__awaiter(this,void 0,void 0,function*(){const n=yield this.tx("readonly",r=>r.get(e));return new Promise(r=>{n.onsuccess=()=>r(n.result)})})}removeItem(e){return this.tx("readwrite",n=>n.delete(e)).then()}}Mi.getItem=gp;Mi.removeItem=dp;Mi.setItem=fp;var Ze=vi,qi=Mi,mp=fa,_s,to,Sn,js;let yp=class{constructor(e){this.http=e,this.settings={path:"/auth",key:"colyseus-auth-token"},_s.set(this,!1),to.set(this,void 0),Sn.set(this,void 0),js.set(this,mp.createNanoEvents()),qi.getItem(this.settings.key,n=>this.token=n)}set token(e){this.http.authToken=e}get token(){return this.http.authToken}onChange(e){const n=Ze.__classPrivateFieldGet(this,js,"f").on("change",e);return Ze.__classPrivateFieldGet(this,_s,"f")||Ze.__classPrivateFieldSet(this,to,new Promise((r,s)=>{this.getUserData().then(i=>{this.emitChange(Object.assign(Object.assign({},i),{token:this.token}))}).catch(i=>{this.emitChange({user:null,token:void 0})}).finally(()=>{r()})}),"f"),Ze.__classPrivateFieldSet(this,_s,!0,"f"),n}getUserData(){return Ze.__awaiter(this,void 0,void 0,function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")})}registerWithEmailAndPassword(e,n,r){return Ze.__awaiter(this,void 0,void 0,function*(){const s=(yield this.http.post(`${this.settings.path}/register`,{body:{email:e,password:n,options:r}})).data;return this.emitChange(s),s})}signInWithEmailAndPassword(e,n){return Ze.__awaiter(this,void 0,void 0,function*(){const r=(yield this.http.post(`${this.settings.path}/login`,{body:{email:e,password:n}})).data;return this.emitChange(r),r})}signInAnonymously(e){return Ze.__awaiter(this,void 0,void 0,function*(){const n=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:e}})).data;return this.emitChange(n),n})}sendPasswordResetEmail(e){return Ze.__awaiter(this,void 0,void 0,function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:e}})).data})}signInWithProvider(e){return Ze.__awaiter(this,arguments,void 0,function*(n,r={}){return new Promise((s,i)=>{const a=r.width||480,f=r.height||768,d=this.token?`?token=${this.token}`:"",h=`Login with ${n[0].toUpperCase()+n.substring(1)}`,A=this.http.client.getHttpEndpoint(`${r.prefix||`${this.settings.path}/provider`}/${n}${d}`),y=screen.width/2-a/2,g=screen.height/2-f/2;Ze.__classPrivateFieldSet(this,Sn,window.open(A,h,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+a+", height="+f+", top="+g+", left="+y),"f");const b=C=>{C.data.user===void 0&&C.data.token===void 0||(clearInterval(E),Ze.__classPrivateFieldGet(this,Sn,"f").close(),Ze.__classPrivateFieldSet(this,Sn,void 0,"f"),window.removeEventListener("message",b),C.data.error!==void 0?i(C.data.error):(s(C.data),this.emitChange(C.data)))},E=setInterval(()=>{(!Ze.__classPrivateFieldGet(this,Sn,"f")||Ze.__classPrivateFieldGet(this,Sn,"f").closed)&&(Ze.__classPrivateFieldSet(this,Sn,void 0,"f"),i("cancelled"),window.removeEventListener("message",b))},200);window.addEventListener("message",b)})})}signOut(){return Ze.__awaiter(this,void 0,void 0,function*(){this.emitChange({user:null,token:null})})}emitChange(e){e.token!==void 0&&(this.token=e.token,e.token===null?qi.removeItem(this.settings.key):qi.setItem(this.settings.key,e.token)),Ze.__classPrivateFieldGet(this,js,"f").emit("change",e)}};_s=new WeakMap,to=new WeakMap,Sn=new WeakMap,js=new WeakMap;wa.Auth=yp;var mf={};function wp(t){var e;const n=((e=window==null?void 0:window.location)===null||e===void 0?void 0:e.hostname)||"localhost",r=t.hostname.split("."),s=!t.hostname.includes("trycloudflare.com")&&!t.hostname.includes("discordsays.com")&&r.length>2?`/${r[0]}`:"";return t.pathname.startsWith("/.proxy")?`${t.protocol}//${n}${s}${t.pathname}${t.search}`:`${t.protocol}//${n}/.proxy/colyseus${s}${t.pathname}${t.search}`}mf.discordURLBuilder=wp;var un=vi,Ap=bs,xp=ua,bp=pf,vp=wa,Ep=mf,Fi;class Ti extends Error{constructor(e,n){super(e),this.code=n,this.name="MatchMakeError",Object.setPrototypeOf(this,Ti.prototype)}}const ol=typeof window<"u"&&typeof((Fi=window==null?void 0:window.location)===null||Fi===void 0?void 0:Fi.hostname)<"u"?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";class yf{constructor(e=ol,n){var r,s;if(typeof e=="string"){const i=e.startsWith("/")?new URL(e,ol):new URL(e),a=i.protocol==="https:"||i.protocol==="wss:",f=Number(i.port||(a?443:80));this.settings={hostname:i.hostname,pathname:i.pathname,port:f,secure:a}}else e.port===void 0&&(e.port=e.secure?443:80),e.pathname===void 0&&(e.pathname=""),this.settings=e;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new bp.HTTP(this,(n==null?void 0:n.headers)||{}),this.auth=new vp.Auth(this.http),this.urlBuilder=n==null?void 0:n.urlBuilder,!this.urlBuilder&&typeof window<"u"&&(!((s=(r=window==null?void 0:window.location)===null||r===void 0?void 0:r.hostname)===null||s===void 0)&&s.includes("discordsays.com"))&&(this.urlBuilder=Ep.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(e){return un.__awaiter(this,arguments,void 0,function*(n,r={},s){return yield this.createMatchMakeRequest("joinOrCreate",n,r,s)})}create(e){return un.__awaiter(this,arguments,void 0,function*(n,r={},s){return yield this.createMatchMakeRequest("create",n,r,s)})}join(e){return un.__awaiter(this,arguments,void 0,function*(n,r={},s){return yield this.createMatchMakeRequest("join",n,r,s)})}joinById(e){return un.__awaiter(this,arguments,void 0,function*(n,r={},s){return yield this.createMatchMakeRequest("joinById",n,r,s)})}reconnect(e,n){return un.__awaiter(this,void 0,void 0,function*(){if(typeof e=="string"&&typeof n=="string")throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[r,s]=e.split(":");if(!r||!s)throw new Error(`Invalid reconnection token format.
The format should be roomId:reconnectionToken`);return yield this.createMatchMakeRequest("reconnect",r,{reconnectionToken:s},n)})}consumeSeatReservation(e,n,r){return un.__awaiter(this,void 0,void 0,function*(){const s=this.createRoom(e.room.name,n);s.roomId=e.room.roomId,s.sessionId=e.sessionId;const i={sessionId:s.sessionId};e.reconnectionToken&&(i.reconnectionToken=e.reconnectionToken);const a=r||s;return s.connect(this.buildEndpoint(e.room,i,e.protocol),e.devMode&&(()=>un.__awaiter(this,void 0,void 0,function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${s.roomId}'...`);let f=0,d=8;const h=()=>un.__awaiter(this,void 0,void 0,function*(){f++;try{yield this.consumeSeatReservation(e,n,a),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${s.roomId}'`)}catch{f<d?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${f} out of ${d})`),setTimeout(h,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}});setTimeout(h,2e3)})),a,e,this.http.headers),new Promise((f,d)=>{const h=(A,y)=>d(new Ap.ServerError(A,y));a.onError.once(h),a.onJoin.once(()=>{a.onError.remove(h),f(a)})})})}createMatchMakeRequest(e,n){return un.__awaiter(this,arguments,void 0,function*(r,s,i={},a,f){const d=(yield this.http.post(`matchmake/${r}/${s}`,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(i)})).data;if(d.error)throw new Ti(d.error,d.code);return r==="reconnect"&&(d.reconnectionToken=i.reconnectionToken),yield this.consumeSeatReservation(d,a,f)})}createRoom(e,n){return new xp.Room(e,n)}buildEndpoint(e,n={},r="ws"){const s=[];for(const f in n)n.hasOwnProperty(f)&&s.push(`${f}=${n[f]}`);r==="h3"&&(r="http");let i=this.settings.secure?`${r}s://`:`${r}://`;e.publicAddress?i+=`${e.publicAddress}`:i+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const a=`${i}/${e.processId}/${e.roomId}?${s.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(a)):a}getHttpEndpoint(e=""){const n=e.startsWith("/")?e:`/${e}`,r=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${n}`;return this.urlBuilder?this.urlBuilder(new URL(r)):r}getEndpointPort(){return this.settings.port!==80&&this.settings.port!==443?`:${this.settings.port}`:""}}yf.VERSION="0.16.15";aa.Client=yf;aa.MatchMakeError=Ti;var wf={};class Sp{setState(e){}getState(){return null}patch(e){}teardown(){}handshake(e){}}wf.NoneSerializer=Sp;(function(t){var e=aa,n=ha,r=ua,s=wa,i=bs,a=Si,f=wf,d=Ei;d.registerSerializer("schema",a.SchemaSerializer),d.registerSerializer("none",f.NoneSerializer),t.Client=e.Client,t.MatchMakeError=e.MatchMakeError,Object.defineProperty(t,"ErrorCode",{enumerable:!0,get:function(){return n.ErrorCode}}),Object.defineProperty(t,"Protocol",{enumerable:!0,get:function(){return n.Protocol}}),t.Room=r.Room,t.Auth=s.Auth,t.ServerError=i.ServerError,t.SchemaSerializer=a.SchemaSerializer,t.getStateCallbacks=a.getStateCallbacks,t.registerSerializer=d.registerSerializer})(oa);const Af=new oa.Client(`${location.protocol}//${location.host}/colyseus`);function is(t,e,n){const r=t.add([t.text(e.text,{size:e.size}),t.pos(e.x,e.y),t.anchor(e.anchor??"center"),t.color(t.Color.fromHex(e.textColor??"#ffffff")),t.z(102)]),s=t.add([t.rect(r.width+40,e.size+26,{radius:e.radius??8}),t.pos(e.x,e.y),t.anchor(e.anchor??"center"),t.color(t.Color.fromHex(e.background??"#8b5cf6")),t.outline(3,t.Color.fromHex(e.outlineColor??"#a855f7")),t.area(),t.opacity(1),t.z(101),"startButton"]);return s.onUpdate(()=>{s.opacity=t.wave(.6,1,t.time()*2)}),s.onClick(n),s}function Ip(){me.scene("lobby",t=>{const e=oa.getStateCallbacks(t);is(me,{text:"Leave room",x:70,y:40,size:14,textColor:"#ffffff",background:"#e61a1a",outlineColor:"#9e1414"},()=>{console.log("Leaving room"),t.leave(!0),location.replace(`${location.protocol}//${location.hostname}:${location.port}/`)}),e(t.state).players.onChange(()=>{Op(Array.from(t.state.players.values())),Mp()});const n={};e(t.state).players.onAdd((r,s)=>{console.log("player added:",s,r.name)}),e(t.state).players.onRemove((r,s)=>{me.destroy(n[s])}),me.onClick(()=>{t.send("move",me.mousePos())})})}function Op(t){me.setBackground(new me.Color(26,26,26));for(let e=0;e<8;e++){const n=e/8*Math.PI*2-Math.PI/2,r=me.width()/2,s=me.height()/2,i=Math.min(me.width(),me.height())/3+50,a=r+Math.cos(n)*i,f=s+Math.sin(n)*i;me.add([me.rect(140,100),me.pos(a,f),me.anchor("center"),me.color(e===0?"#3768c4":"#0b2d6b"),me.outline(4,new me.Color(99,149,237)),me.opacity(.8),me.z(0)]),e<=t.length-1&&Rp(t[e],a,f)}}function Rp(t,e,n){const r=`${t.name}icon`;me.loadSprite(r,t.summonerIconUrl),me.add([me.sprite(r,{width:40,height:40}),me.pos(e,n-10),me.anchor("center"),me.z(1)]),me.add([me.text(t.name,{size:12}),me.pos(e,n+25),me.anchor("center"),me.z(1)])}function Mp(t=0){const e=me.width()/2,n=me.height()/2;me.add([me.color(me.WHITE),me.text(`Lobby ${t}/8`,{size:32}),me.pos(e,n-30),me.anchor("center"),me.z(1)]),is(me,{text:"Ready Up",x:e,y:n+20,size:24,textColor:"#ffffff",background:"#4caf50",outlineColor:"#388e3c"},()=>{console.log("Ready up clicked")})}const me=Gd({width:1600,height:1e3,stretch:!0,crisp:!1,pixelDensity:2,letterbox:!0,background:"20252e"});Ip();function Tp(){let t;do t=prompt("Enter your LoL name and tag (i.e. Hide on bush#KR1)");while(t===null||t.length<3);return t}async function al(t,e,n){try{const r=await Af.joinById(e,n);t.go("lobby",r)}catch(r){console.error("Failed to join room:",r),location.replace(location.href.split("?")[0])}}async function Cp(t,e){try{const n=await Af.create("my_room",e),r=new URL(location.href);r.searchParams.set("room_id",n.roomId),console.log("Writing",r,"to history"),history.pushState({},"",r),t.go("lobby",n)}catch(n){console.error("Failed to create room:",n)}}async function Pp(){let t=localStorage.getItem("name");t===null&&(t=Tp(),localStorage.setItem("name",t)),me.add([me.pos(me.center().x,me.center().y-40),me.anchor("center"),me.text(`Welcome ${t}`)]),is(me,{text:"Logout",x:60,y:40,size:14,textColor:"#000000",background:"#ffffff",outlineColor:"#ffffff"},()=>{console.log("logged out"),localStorage.removeItem("name"),location.replace(location.href.split("?")[0])});let e;const n=new URLSearchParams(location.search);n.has("room_id")&&(e=n.get("room_id"),await al(me,e,r())),is(me,{text:"Join lobby by ID",x:me.center().x,y:me.center().y+20,size:14,textColor:"#000000",background:"#ffffff",outlineColor:"#ffffff"},()=>{e=prompt("Enter the room ID"),al(me,e,r())}),is(me,{text:"Create new",x:me.center().x,y:me.center().y+80,size:14,textColor:"#ffffff",background:"#e61a1a",outlineColor:"#9e1414"},()=>{Cp(me,r())});function r(){return{nameTag:t,name:(t==null?void 0:t.split("#")[0])||"Anonymous"}}}Pp();
